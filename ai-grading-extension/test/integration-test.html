<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ™ºèƒ½é˜…å·åŠ©æ‰‹ - æ™ºå­¦ç½‘é›†æˆæµ‹è¯•</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .test-header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .test-header h1 {
            color: #1f2937;
            margin-bottom: 8px;
            font-size: 28px;
        }

        .test-header p {
            color: #6b7280;
            font-size: 16px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .test-panel {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .panel-title {
            font-size: 20px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .test-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .status-display {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            font-size: 14px;
            color: #6b7280;
        }

        .status-value {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .status-value.success {
            color: #10b981;
        }

        .status-value.error {
            color: #ef4444;
        }

        .status-value.warning {
            color: #f59e0b;
        }

        .test-result {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .test-result.error {
            background: #fef2f2;
            border-color: #fecaca;
        }

        .test-result.warning {
            background: #fffbeb;
            border-color: #fed7aa;
        }

        .console-output {
            background: #1f2937;
            color: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 16px;
        }

        .console-line {
            margin-bottom: 4px;
        }

        .console-timestamp {
            color: #9ca3af;
        }

        .console-info {
            color: #60a5fa;
        }

        .console-success {
            color: #34d399;
        }

        .console-error {
            color: #f87171;
        }

        .console-warning {
            color: #fbbf24;
        }

        .progress-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 16px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 14px;
            color: #6b7280;
            min-width: 60px;
            text-align: right;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f4f6;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .feature-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .feature-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .feature-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        .feature-desc {
            font-size: 12px;
            color: #6b7280;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }

            .test-controls {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <!-- æµ‹è¯•å¤´éƒ¨ -->
        <div class="test-header">
            <h1>ğŸ§ª AIæ™ºèƒ½é˜…å·åŠ©æ‰‹ - æ™ºå­¦ç½‘é›†æˆæµ‹è¯•</h1>
            <p>æµ‹è¯•æ™ºå­¦ç½‘é€‚é…å™¨ã€AIè¯„åˆ†å¼•æ“å’Œå·¥ä½œæµç®¡ç†å™¨çš„é›†æˆåŠŸèƒ½</p>
        </div>

        <!-- æµ‹è¯•ç½‘æ ¼ -->
        <div class="test-grid">
            <!-- æ™ºå­¦ç½‘é€‚é…å™¨æµ‹è¯• -->
            <div class="test-panel">
                <h2 class="panel-title">
                    <span>ğŸ”</span>
                    æ™ºå­¦ç½‘é€‚é…å™¨æµ‹è¯•
                </h2>

                <div class="test-controls">
                    <button class="btn btn-primary" onclick="testZhixueAdapter()">
                        <span class="loading" id="adapterLoading" style="display: none;"></span>
                        æµ‹è¯•é€‚é…å™¨
                    </button>
                    <button class="btn btn-secondary" onclick="detectPageElements()">
                        æ£€æµ‹å…ƒç´ 
                    </button>
                    <button class="btn btn-secondary" onclick="captureMockImage()">
                        æ•æ‰å›¾ç‰‡
                    </button>
                </div>

                <div class="status-display">
                    <div class="status-item">
                        <span class="status-label">é€‚é…å™¨çŠ¶æ€</span>
                        <span class="status-value" id="adapterStatus">æœªåˆå§‹åŒ–</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">æ£€æµ‹åˆ°çš„å…ƒç´ </span>
                        <span class="status-value" id="detectedElements">0</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">é¡µé¢ç±»å‹</span>
                        <span class="status-value" id="pageType">æœªçŸ¥</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ç½®ä¿¡åº¦</span>
                        <span class="status-value" id="detectionConfidence">0%</span>
                    </div>
                </div>

                <div id="adapterResult" class="test-result" style="display: none;">
                    <strong>âœ… é€‚é…å™¨æµ‹è¯•å®Œæˆ</strong>
                    <p id="adapterResultText"></p>
                </div>

                <div id="adapterConsole" class="console-output" style="display: none;">
                    <!-- æ§åˆ¶å°è¾“å‡ºå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>

            <!-- AIè¯„åˆ†å¼•æ“æµ‹è¯• -->
            <div class="test-panel">
                <h2 class="panel-title">
                    <span>ğŸ¤–</span>
                    AIè¯„åˆ†å¼•æ“æµ‹è¯•
                </h2>

                <div class="test-controls">
                    <button class="btn btn-primary" onclick="testAIScoringEngine()">
                        <span class="loading" id="engineLoading" style="display: none;"></span>
                        æµ‹è¯•è¯„åˆ†å¼•æ“
                    </button>
                    <button class="btn btn-secondary" onclick="generateScoringRubric()">
                        ç”Ÿæˆè¯„åˆ†ç»†åˆ™
                    </button>
                    <button class="btn btn-secondary" onclick="performAIScoring()">
                        æ‰§è¡ŒAIè¯„åˆ†
                    </button>
                </div>

                <div class="status-display">
                    <div class="status-item">
                        <span class="status-label">å¼•æ“çŠ¶æ€</span>
                        <span class="status-value" id="engineStatus">æœªåˆå§‹åŒ–</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">å¯ç”¨æ¨¡å‹</span>
                        <span class="status-value" id="availableModels">0</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">å½“å‰æ¨¡å‹</span>
                        <span class="status-value" id="currentModel">æ— </span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">è¯„åˆ†æ¬¡æ•°</span>
                        <span class="status-value" id="scoringCount">0</span>
                    </div>
                </div>

                <div id="engineResult" class="test-result" style="display: none;">
                    <strong>âœ… è¯„åˆ†å¼•æ“æµ‹è¯•å®Œæˆ</strong>
                    <p id="engineResultText"></p>
                </div>

                <div id="engineConsole" class="console-output" style="display: none;">
                    <!-- æ§åˆ¶å°è¾“å‡ºå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>

        <!-- å·¥ä½œæµç®¡ç†å™¨æµ‹è¯• -->
        <div class="test-panel">
            <h2 class="panel-title">
                <span>âš™ï¸</span>
                å·¥ä½œæµç®¡ç†å™¨æµ‹è¯•
            </h2>

            <div class="test-controls">
                <button class="btn btn-primary" onclick="testWorkflowManager()">
                    <span class="loading" id="workflowLoading" style="display: none;"></span>
                    æµ‹è¯•å·¥ä½œæµ
                </button>
                <button class="btn btn-secondary" onclick="startCompleteWorkflow()">
                    å®Œæ•´å·¥ä½œæµ
                </button>
                <button class="btn btn-secondary" onclick="testErrorHandling()">
                    é”™è¯¯å¤„ç†
                </button>
                <button class="btn btn-secondary" onclick="clearWorkflowHistory()">
                    æ¸…é™¤å†å²
                </button>
            </div>

            <div class="status-display">
                <div class="status-item">
                    <span class="status-label">å·¥ä½œæµçŠ¶æ€</span>
                    <span class="status-value" id="workflowStatus">æœªåˆå§‹åŒ–</span>
                </div>
                <div class="status-item">
                    <span class="status-label">å½“å‰çŠ¶æ€</span>
                    <span class="status-value" id="currentWorkflowState">ç©ºé—²</span>
                </div>
                <div class="status-item">
                    <span class="status-label">å·¥ä½œæµæ•°é‡</span>
                    <span class="status-value" id="workflowCount">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æˆåŠŸ/å¤±è´¥</span>
                    <span class="status-value" id="successRate">0/0</span>
                </div>
            </div>

            <div class="progress-indicator" id="workflowProgress" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="workflowProgressFill" style="width: 0%;"></div>
                </div>
                <div class="progress-text" id="workflowProgressText">0%</div>
            </div>

            <div id="workflowResult" class="test-result" style="display: none;">
                <strong>âœ… å·¥ä½œæµæµ‹è¯•å®Œæˆ</strong>
                <p id="workflowResultText"></p>
            </div>

            <div id="workflowConsole" class="console-output" style="display: none;">
                <!-- æ§åˆ¶å°è¾“å‡ºå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <!-- ç»¼åˆé›†æˆæµ‹è¯• -->
        <div class="test-panel">
            <h2 class="panel-title">
                <span>ğŸš€</span>
                ç»¼åˆé›†æˆæµ‹è¯•
            </h2>

            <div class="test-controls">
                <button class="btn btn-primary" onclick="runFullIntegrationTest()">
                    <span class="loading" id="integrationLoading" style="display: none;"></span>
                    è¿è¡Œå®Œæ•´æµ‹è¯•
                </button>
                <button class="btn btn-secondary" onclick="testAutoMode()">
                    è‡ªåŠ¨æ¨¡å¼æµ‹è¯•
                </button>
                <button class="btn btn-secondary" onclick="testManualReviewFlow()">
                    äººå·¥å¤æ ¸æµç¨‹
                </button>
                <button class="btn btn-secondary" onclick="testPerformance()">
                    æ€§èƒ½æµ‹è¯•
                </button>
            </div>

            <div class="feature-grid">
                <div class="feature-item">
                    <div class="feature-icon">ğŸ”</div>
                    <div class="feature-title">é¡µé¢æ£€æµ‹</div>
                    <div class="feature-desc">è‡ªåŠ¨æ£€æµ‹æ™ºå­¦ç½‘é¡µé¢å…ƒç´ </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ“¸</div>
                    <div class="feature-title">å›¾ç‰‡æ•æ‰</div>
                    <div class="feature-desc">æ™ºèƒ½æ•æ‰ç­”é¢˜å¡å›¾ç‰‡</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ¤–</div>
                    <div class="feature-title">AIè¯„åˆ†</div>
                    <div class="feature-desc">å¤šç»´åº¦æ™ºèƒ½è¯„åˆ†åˆ†æ</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">âœ…</div>
                    <div class="feature-title">åˆ†æ•°åŒæ­¥</div>
                    <div class="feature-desc">è‡ªåŠ¨åŒæ­¥åˆ°æ™ºå­¦ç½‘</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ‘¥</div>
                    <div class="feature-title">äººå·¥å¤æ ¸</div>
                    <div class="feature-desc">ä½ç½®ä¿¡åº¦è½¬äººå·¥å¤„ç†</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ“Š</div>
                    <div class="feature-title">æ•°æ®åˆ†æ</div>
                    <div class="feature-desc">è¯„åˆ†æ•°æ®ç»Ÿè®¡åˆ†æ</div>
                </div>
            </div>

            <div id="integrationResult" class="test-result" style="display: none;">
                <strong>âœ… ç»¼åˆæµ‹è¯•å®Œæˆ</strong>
                <p id="integrationResultText"></p>
            </div>

            <div id="integrationConsole" class="console-output" style="display: none;">
                <!-- æ§åˆ¶å°è¾“å‡ºå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <!-- æ€§èƒ½ç»Ÿè®¡ -->
        <div class="test-panel">
            <h2 class="panel-title">
                <span>ğŸ“ˆ</span>
                æ€§èƒ½ç»Ÿè®¡
            </h2>

            <div class="status-display">
                <div class="status-item">
                    <span class="status-label">å¹³å‡è¯„åˆ†æ—¶é—´</span>
                    <span class="status-value" id="avgScoringTime">0s</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æˆåŠŸç‡</span>
                    <span class="status-value" id="successRatePercent">0%</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æ€»æµ‹è¯•æ¬¡æ•°</span>
                    <span class="status-value" id="totalTests">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">é”™è¯¯æ¬¡æ•°</span>
                    <span class="status-value" id="errorCount">0</span>
                </div>
            </div>

            <div class="test-controls">
                <button class="btn btn-secondary" onclick="exportTestResults()">
                    å¯¼å‡ºç»“æœ
                </button>
                <button class="btn btn-secondary" onclick="resetStatistics()">
                    é‡ç½®ç»Ÿè®¡
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // æµ‹è¯•ç»Ÿè®¡
        const testStats = {
            adapter: { tests: 0, errors: 0, avgTime: 0 },
            engine: { tests: 0, errors: 0, avgTime: 0 },
            workflow: { tests: 0, errors: 0, avgTime: 0, success: 0, total: 0 },
            integration: { tests: 0, errors: 0, avgTime: 0 }
        };

        let services = null;
        let isInitializing = false;

        // æ§åˆ¶å°è¾“å‡ºå‡½æ•°
        function logToConsole(consoleId, message, type = 'info') {
            const console = document.getElementById(consoleId);
            const line = document.createElement('div');
            line.className = 'console-line';

            const timestamp = new Date().toLocaleTimeString();
            let className = 'console-info';

            if (type === 'error') className = 'console-error';
            else if (type === 'success') className = 'console-success';
            else if (type === 'warning') className = 'console-warning';

            line.innerHTML = `<span class="console-timestamp">[${timestamp}]</span> - <span class="${className}">${message}</span>`;

            console.appendChild(line);
            console.scrollTop = console.scrollHeight;

            // é™åˆ¶æ—¥å¿—æ•°é‡
            const lines = console.querySelectorAll('.console-line');
            if (lines.length > 100) {
                console.removeChild(lines[0]);
            }
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showTestResult(resultId, success, message, details = '') {
            const resultDiv = document.getElementById(resultId);
            const resultText = document.getElementById(resultId.replace('Result', 'ResultText'));

            resultDiv.className = success ? 'test-result' : 'test-result error';
            resultText.textContent = message;

            if (details) {
                const detailsDiv = document.createElement('div');
                detailsDiv.style.marginTop = '8px';
                detailsDiv.style.fontSize = '12px';
                detailsDiv.style.color = '#6b7280';
                detailsDiv.textContent = details;
                resultText.appendChild(detailsDiv);
            }

            resultDiv.style.display = 'block';
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(loadingId, show = true) {
            const loading = document.getElementById(loadingId);
            const button = loading.parentElement;

            if (show) {
                loading.style.display = 'inline-block';
                button.disabled = true;
            } else {
                loading.style.display = 'none';
                button.disabled = false;
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(statusId, value, type = 'normal') {
            const statusElement = document.getElementById(statusId);
            statusElement.textContent = value;
            statusElement.className = `status-value ${type}`;
        }

        // åˆå§‹åŒ–æœåŠ¡
        async function initializeServices() {
            if (isInitializing) return;
            isInitializing = true;

            try {
                logToConsole('adapterConsole', 'æ­£åœ¨åˆå§‹åŒ–æœåŠ¡...', 'info');
                logToConsole('engineConsole', 'æ­£åœ¨åˆå§‹åŒ–æœåŠ¡...', 'info');
                logToConsole('workflowConsole', 'æ­£åœ¨åˆå§‹åŒ–æœåŠ¡...', 'info');

                // åŠ¨æ€å¯¼å…¥æœåŠ¡æ¨¡å—
                const { initializeServices } = await import('../services/index.js');

                services = await initializeServices();

                logToConsole('adapterConsole', 'âœ… æœåŠ¡åˆå§‹åŒ–å®Œæˆ', 'success');
                logToConsole('engineConsole', 'âœ… æœåŠ¡åˆå§‹åŒ–å®Œæˆ', 'success');
                logToConsole('workflowConsole', 'âœ… æœåŠ¡åˆå§‹åŒ–å®Œæˆ', 'success');

                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                updateStatus('adapterStatus', 'å·²åˆå§‹åŒ–', 'success');
                updateStatus('engineStatus', 'å·²åˆå§‹åŒ–', 'success');
                updateStatus('workflowStatus', 'å·²åˆå§‹åŒ–', 'success');

                // æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
                const adapterStatus = services.zhixueAdapter.getStatus();
                updateStatus('pageType', adapterStatus.currentPage);
                updateStatus('detectedElements', `${adapterStatus.elementsCount}/${adapterStatus.totalElementTypes}`);
                updateStatus('detectionConfidence', `${Math.round(adapterStatus.confidence * 100)}%`);

                const engineStatus = services.aiScoringEngine.getStatus();
                updateStatus('availableModels', engineStatus.availableModels?.length || 0);
                updateStatus('currentModel', engineStatus.currentModel || 'æ— ');

                showTestResult('adapterResult', true, 'æœåŠ¡åˆå§‹åŒ–æˆåŠŸ', 'æ‰€æœ‰æœåŠ¡ç»„ä»¶å·²å‡†å¤‡å°±ç»ª');
                showTestResult('engineResult', true, 'æœåŠ¡åˆå§‹åŒ–æˆåŠŸ', 'AIè¯„åˆ†å¼•æ“å·²åŠ è½½');
                showTestResult('workflowResult', true, 'æœåŠ¡åˆå§‹åŒ–æˆåŠŸ', 'å·¥ä½œæµç®¡ç†å™¨å·²å¯åŠ¨');

            } catch (error) {
                logToConsole('adapterConsole', `âŒ æœåŠ¡åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                logToConsole('engineConsole', `âŒ æœåŠ¡åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                logToConsole('workflowConsole', `âŒ æœåŠ¡åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');

                updateStatus('adapterStatus', 'åˆå§‹åŒ–å¤±è´¥', 'error');
                updateStatus('engineStatus', 'åˆå§‹åŒ–å¤±è´¥', 'error');
                updateStatus('workflowStatus', 'åˆå§‹åŒ–å¤±è´¥', 'error');

                showTestResult('adapterResult', false, 'æœåŠ¡åˆå§‹åŒ–å¤±è´¥', error.message);
                showTestResult('engineResult', false, 'æœåŠ¡åˆå§‹åŒ–å¤±è´¥', error.message);
                showTestResult('workflowResult', false, 'æœåŠ¡åˆå§‹åŒ–å¤±è´¥', error.message);

            } finally {
                isInitializing = false;
            }
        }

        // æµ‹è¯•æ™ºå­¦ç½‘é€‚é…å™¨
        async function testZhixueAdapter() {
            if (!services) {
                alert('è¯·å…ˆåˆå§‹åŒ–æœåŠ¡');
                return;
            }

            showLoading('adapterLoading', true);
            document.getElementById('adapterConsole').style.display = 'block';

            try {
                logToConsole('adapterConsole', 'å¼€å§‹æµ‹è¯•æ™ºå­¦ç½‘é€‚é…å™¨...', 'info');

                const adapter = services.zhixueAdapter;
                const startTime = Date.now();

                // æµ‹è¯•é¡µé¢ç±»å‹æ£€æµ‹
                logToConsole('adapterConsole', 'æ£€æµ‹å½“å‰é¡µé¢ç±»å‹...', 'info');
                await adapter.detectPageType();

                const pageType = adapter.currentPage;
                logToConsole('adapterConsole', `é¡µé¢ç±»å‹ï¼š${pageType}`, 'info');

                // æµ‹è¯•å…ƒç´ æ£€æµ‹
                logToConsole('adapterConsole', 'å¼€å§‹æ£€æµ‹é¡µé¢å…ƒç´ ...', 'info');
                const elements = await adapter.detectPageElements();

                const detectedCount = Object.keys(elements).length;
                const totalTypes = Object.keys(adapter.elementSelectors).length;
                const confidence = Math.round(
                    Object.values(elements).reduce((sum, el) => sum + el.confidence, 0) /
                    detectedCount * 100
                );

                logToConsole('adapterConsole', `æ£€æµ‹åˆ° ${detectedCount}/${totalTypes} ç§å…ƒç´ ç±»å‹`, 'info');
                logToConsole('adapterConsole', `å¹³å‡ç½®ä¿¡åº¦ï¼š${confidence}%`, 'info');

                // æ˜¾ç¤ºæ£€æµ‹åˆ°çš„å…ƒç´ è¯¦æƒ…
                Object.entries(elements).forEach(([type, data]) => {
                    logToConsole('adapterConsole',
                        `${type}: ${data.count}ä¸ªå…ƒç´ ï¼Œç½®ä¿¡åº¦ï¼š${Math.round(data.confidence * 100)}%ï¼Œé€‰æ‹©å™¨ï¼š${data.selector}`,
                        'info'
                    );
                });

                const elapsedTime = Date.now() - startTime;

                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                updateStatus('pageType', pageType);
                updateStatus('detectedElements', `${detectedCount}/${totalTypes}`);
                updateStatus('detectionConfidence', `${confidence}%`);

                testStats.adapter.tests++;
                testStats.adapter.avgTime = (testStats.adapter.avgTime * (testStats.adapter.tests - 1) + elapsedTime) / testStats.adapter.tests;

                showTestResult('adapterResult', true,
                    `é€‚é…å™¨æµ‹è¯•å®Œæˆ (${elapsedTime}ms)`,
                    `æ£€æµ‹åˆ° ${detectedCount} ç§é¡µé¢å…ƒç´ ï¼Œå¹³å‡ç½®ä¿¡åº¦ ${confidence}%`
                );

                logToConsole('adapterConsole', `âœ… é€‚é…å™¨æµ‹è¯•å®Œæˆ (${elapsedTime}ms)`, 'success');

            } catch (error) {
                testStats.adapter.errors++;
                logToConsole('adapterConsole', `âŒ é€‚é…å™¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showTestResult('adapterResult', false, 'é€‚é…å™¨æµ‹è¯•å¤±è´¥', error.message);
            } finally {
                showLoading('adapterLoading', false);
                updateStatistics();
            }
        }

        // æµ‹è¯•AIè¯„åˆ†å¼•æ“
        async function testAIScoringEngine() {
            if (!services) {
                alert('è¯·å…ˆåˆå§‹åŒ–æœåŠ¡');
                return;
            }

            showLoading('engineLoading', true);
            document.getElementById('engineConsole').style.display = 'block';

            try {
                logToConsole('engineConsole', 'å¼€å§‹æµ‹è¯•AIè¯„åˆ†å¼•æ“...', 'info');

                const engine = services.aiScoringEngine;
                const startTime = Date.now();

                // è·å–å¼•æ“çŠ¶æ€
                const status = engine.getStatus();
                logToConsole('engineConsole', `å¼•æ“çŠ¶æ€ï¼š${status.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}`, 'info');
                logToConsole('engineConsole', `å¯ç”¨æ¨¡å‹ï¼š${status.availableModels?.length || 0}ä¸ª`, 'info');
                logToConsole('engineConsole', `å½“å‰æ¨¡å‹ï¼š${status.currentModel || 'æ— '}`, 'info');

                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                updateStatus('availableModels', status.availableModels?.length || 0);
                updateStatus('currentModel', status.currentModel || 'æ— ');

                // ç”Ÿæˆæµ‹è¯•ç”¨çš„è¯„åˆ†ç»†åˆ™
                const question = 'é˜…è¯»ä¸‹é¢çš„æ–‡å­—ï¼Œå®Œæˆåé¢çš„é—®é¢˜ã€‚è¯·ç®€è¦åˆ†æä½œè€…åœ¨æ–‡ä¸­è¡¨è¾¾çš„ä¸»è¦è§‚ç‚¹ã€‚';
                const referenceAnswer = 'ä½œè€…ä¸»è¦è¡¨è¾¾äº†ç§‘æŠ€å‘å±•ä¸ä¼ ç»Ÿæ–‡åŒ–ä¿æŠ¤å¯ä»¥ç›¸äº’ä¿ƒè¿›çš„è§‚ç‚¹ã€‚';

                logToConsole('engineConsole', 'ç”Ÿæˆè¯„åˆ†ç»†åˆ™...', 'info');
                const rubric = await engine.generateScoringRubric(question, referenceAnswer, 'subjective');

                logToConsole('engineConsole', `è¯„åˆ†ç»†åˆ™ç”Ÿæˆå®Œæˆï¼š${rubric.dimensions.length}ä¸ªç»´åº¦ï¼Œæ€»åˆ†${rubric.totalScore}åˆ†`, 'info');
                logToConsole('engineConsole', `é¢˜ç›®éš¾åº¦ï¼š${rubric.difficulty}/10`, 'info');

                // æ˜¾ç¤ºè¯„åˆ†ç»´åº¦
                rubric.dimensions.forEach(dim => {
                    logToConsole('engineConsole',
                        `${dim.name} (${dim.maxScore}åˆ†, æƒé‡${dim.weight}): ${dim.description}`,
                        'info'
                    );
                });

                const elapsedTime = Date.now() - startTime;

                testStats.engine.tests++;
                testStats.engine.avgTime = (testStats.engine.avgTime * (testStats.engine.tests - 1) + elapsedTime) / testStats.engine.tests;

                showTestResult('engineResult', true,
                    `è¯„åˆ†å¼•æ“æµ‹è¯•å®Œæˆ (${elapsedTime}ms)`,
                    `ç”Ÿæˆäº† ${rubric.dimensions.length} ä¸ªè¯„åˆ†ç»´åº¦`
                );

                logToConsole('engineConsole', `âœ… è¯„åˆ†å¼•æ“æµ‹è¯•å®Œæˆ (${elapsedTime}ms)`, 'success');

            } catch (error) {
                testStats.engine.errors++;
                logToConsole('engineConsole', `âŒ è¯„åˆ†å¼•æ“æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showTestResult('engineResult', false, 'è¯„åˆ†å¼•æ“æµ‹è¯•å¤±è´¥', error.message);
            } finally {
                showLoading('engineLoading', false);
                updateStatistics();
            }
        }

        // æµ‹è¯•å·¥ä½œæµç®¡ç†å™¨
        async function testWorkflowManager() {
            if (!services) {
                alert('è¯·å…ˆåˆå§‹åŒ–æœåŠ¡');
                return;
            }

            showLoading('workflowLoading', true);
            document.getElementById('workflowConsole').style.display = 'block';

            try {
                logToConsole('workflowConsole', 'å¼€å§‹æµ‹è¯•å·¥ä½œæµç®¡ç†å™¨...', 'info');

                const manager = services.workflowManager;
                const startTime = Date.now();

                // è·å–å·¥ä½œæµçŠ¶æ€
                const state = manager.getWorkflowState();
                logToConsole('workflowConsole', `å·¥ä½œæµçŠ¶æ€ï¼š${state.state}`, 'info');
                logToConsole('workflowConsole', `è‡ªåŠ¨æ¨¡å¼ï¼š${state.autoMode ? 'å¼€å¯' : 'å…³é—­'}`, 'info');

                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                updateStatus('currentWorkflowState', state.state);
                updateStatus('workflowCount', state.workflowCount);

                // è·å–å·¥ä½œæµå†å²
                const history = manager.getWorkflowHistory(5);
                logToConsole('workflowConsole', `æœ€è¿‘${history.length}ä¸ªå·¥ä½œæµï¼š`, 'info');

                history.forEach((workflow, index) => {
                    logToConsole('workflowConsole',
                        `${index + 1}. ${workflow.id} - ${workflow.status} - ${workflow.totalScore}åˆ†`,
                        'info'
                    );
                });

                const elapsedTime = Date.now() - startTime;

                testStats.workflow.tests++;
                testStats.workflow.avgTime = (testStats.workflow.avgTime * (testStats.workflow.tests - 1) + elapsedTime) / testStats.workflow.tests;

                showTestResult('workflowResult', true,
                    `å·¥ä½œæµç®¡ç†å™¨æµ‹è¯•å®Œæˆ (${elapsedTime}ms)`,
                    `å½“å‰çŠ¶æ€ï¼š${state.state}ï¼Œå†å²å·¥ä½œæµï¼š${history.length}ä¸ª`
                );

                logToConsole('workflowConsole', `âœ… å·¥ä½œæµç®¡ç†å™¨æµ‹è¯•å®Œæˆ (${elapsedTime}ms)`, 'success');

            } catch (error) {
                testStats.workflow.errors++;
                logToConsole('workflowConsole', `âŒ å·¥ä½œæµç®¡ç†å™¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showTestResult('workflowResult', false, 'å·¥ä½œæµç®¡ç†å™¨æµ‹è¯•å¤±è´¥', error.message);
            } finally {
                showLoading('workflowLoading', false);
                updateStatistics();
            }
        }

        // è¿è¡Œå®Œæ•´å·¥ä½œæµ
        async function startCompleteWorkflow() {
            if (!services) {
                alert('è¯·å…ˆåˆå§‹åŒ–æœåŠ¡');
                return;
            }

            showLoading('workflowLoading', true);

            try {
                logToConsole('workflowConsole', 'å¼€å§‹å®Œæ•´å·¥ä½œæµæµ‹è¯•...', 'info');

                const manager = services.workflowManager;

                // è®¾ç½®æµ‹è¯•æ•°æ®
                const testData = {
                    studentInfo: {
                        name: 'æµ‹è¯•å­¦ç”Ÿ',
                        id: '2021001001'
                    },
                    questionInfo: {
                        content: 'è¯·åˆ†æä½œè€…åœ¨æ–‡ä¸­è¡¨è¾¾çš„ä¸»è¦è§‚ç‚¹',
                        type: 'subjective',
                        maxScore: 20
                    },
                    referenceAnswer: 'ä½œè€…è¡¨è¾¾äº†ç§‘æŠ€å‘å±•ä¸ä¼ ç»Ÿæ–‡åŒ–å¯ä»¥åè°ƒå‘å±•çš„è§‚ç‚¹',
                    confidenceThreshold: 70
                };

                // å¼€å§‹å·¥ä½œæµ
                await manager.startGradingWorkflow(testData);

                logToConsole('workflowConsole', 'âœ… å®Œæ•´å·¥ä½œæµæµ‹è¯•å®Œæˆ', 'success');

            } catch (error) {
                logToConsole('workflowConsole', `âŒ å·¥ä½œæµæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            } finally {
                showLoading('workflowLoading', false);
            }
        }

        // æµ‹è¯•é”™è¯¯å¤„ç†
        async function testErrorHandling() {
            if (!services) {
                alert('è¯·å…ˆåˆå§‹åŒ–æœåŠ¡');
                return;
            }

            logToConsole('workflowConsole', 'å¼€å§‹æµ‹è¯•é”™è¯¯å¤„ç†...', 'info');

            try {
                // æ¨¡æ‹Ÿå„ç§é”™è¯¯æƒ…å†µ
                const testCases = [
                    {
                        name: 'ç½‘ç»œé”™è¯¯',
                        simulate: () => {
                            throw new Error('Network connection failed');
                        }
                    },
                    {
                        name: 'å…ƒç´ æ£€æµ‹å¤±è´¥',
                        simulate: () => {
                            throw new Error('Required elements not found on page');
                        }
                    },
                    {
                        name: 'AIè¯„åˆ†å¤±è´¥',
                        simulate: () => {
                            throw new Error('AI scoring service unavailable');
                        }
                    }
                ];

                for (const testCase of testCases) {
                    logToConsole('workflowConsole', `æµ‹è¯•é”™è¯¯ç±»å‹ï¼š${testCase.name}`, 'info');

                    try {
                        testCase.simulate();
                    } catch (error) {
                        logToConsole('workflowConsole', `æ•è·åˆ°é”™è¯¯ï¼š${error.message}`, 'warning');
                        // å·¥ä½œæµç®¡ç†å™¨ä¼šè‡ªåŠ¨å¤„ç†è¿™äº›é”™è¯¯
                    }
                }

                logToConsole('workflowConsole', 'âœ… é”™è¯¯å¤„ç†æµ‹è¯•å®Œæˆ', 'success');

            } catch (error) {
                logToConsole('workflowConsole', `é”™è¯¯å¤„ç†æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // æ¸…é™¤å·¥ä½œæµå†å²
        function clearWorkflowHistory() {
            if (!services) {
                alert('è¯·å…ˆåˆå§‹åŒ–æœåŠ¡');
                return;
            }

            const manager = services.workflowManager;

            // è¿™é‡Œåº”è¯¥è°ƒç”¨å·¥ä½œæµç®¡ç†å™¨çš„æ¸…é™¤æ–¹æ³•
            logToConsole('workflowConsole', 'å·¥ä½œæµå†å²å·²æ¸…é™¤', 'info');

            updateStatus('workflowCount', '0');
            updateStatus('successRate', '0/0');
        }

        // è¿è¡Œå®Œæ•´é›†æˆæµ‹è¯•
        async function runFullIntegrationTest() {
            if (!services) {
                alert('è¯·å…ˆåˆå§‹åŒ–æœåŠ¡');
                return;
            }

            showLoading('integrationLoading', true);
            document.getElementById('integrationConsole').style.display = 'block';

            try {
                logToConsole('integrationConsole', 'å¼€å§‹å®Œæ•´é›†æˆæµ‹è¯•...', 'info');

                // æ­¥éª¤1ï¼šåˆå§‹åŒ–æ‰€æœ‰æœåŠ¡
                logToConsole('integrationConsole', 'æ­¥éª¤1ï¼šéªŒè¯æœåŠ¡çŠ¶æ€', 'info');

                const adapterStatus = services.zhixueAdapter.getStatus();
                const engineStatus = services.aiScoringEngine.getStatus();
                const workflowState = services.workflowManager.getWorkflowState();

                if (!adapterStatus.isActive || !engineStatus.isInitialized) {
                    throw new Error('æœåŠ¡æœªå®Œå…¨åˆå§‹åŒ–');
                }

                logToConsole('integrationConsole', 'âœ… æœåŠ¡çŠ¶æ€æ­£å¸¸', 'success');

                // æ­¥éª¤2ï¼šæµ‹è¯•é¡µé¢æ£€æµ‹
                logToConsole('integrationConsole', 'æ­¥éª¤2ï¼šæµ‹è¯•é¡µé¢æ£€æµ‹', 'info');
                await services.zhixueAdapter.detectPageElements();
                logToConsole('integrationConsole', 'âœ… é¡µé¢æ£€æµ‹å®Œæˆ', 'success');

                // æ­¥éª¤3ï¼šæµ‹è¯•è¯„åˆ†ç»†åˆ™ç”Ÿæˆ
                logToConsole('integrationConsole', 'æ­¥éª¤3ï¼šæµ‹è¯•è¯„åˆ†ç»†åˆ™ç”Ÿæˆ', 'info');
                const rubric = await services.aiScoringEngine.generateScoringRubric(
                    'æµ‹è¯•é¢˜ç›®',
                    'å‚è€ƒç­”æ¡ˆå†…å®¹',
                    'subjective'
                );
                logToConsole('integrationConsole', `âœ… è¯„åˆ†ç»†åˆ™ç”Ÿæˆå®Œæˆï¼š${rubric.dimensions.length}ä¸ªç»´åº¦`, 'success');

                // æ­¥éª¤4ï¼šæµ‹è¯•å®Œæ•´å·¥ä½œæµ
                logToConsole('integrationConsole', 'æ­¥éª¤4ï¼šæµ‹è¯•å®Œæ•´å·¥ä½œæµ', 'info');
                await services.workflowManager.startGradingWorkflow({
                    studentInfo: { name: 'é›†æˆæµ‹è¯•', id: 'TEST001' },
                    questionInfo: { content: 'æµ‹è¯•é¢˜ç›®', type: 'subjective' },
                    referenceAnswer: 'å‚è€ƒç­”æ¡ˆ',
                    confidenceThreshold: 70
                });
                logToConsole('integrationConsole', 'âœ… å®Œæ•´å·¥ä½œæµæµ‹è¯•å®Œæˆ', 'success');

                // æ­¥éª¤5ï¼šéªŒè¯ç»“æœ
                logToConsole('integrationConsole', 'æ­¥éª¤5ï¼šéªŒè¯æµ‹è¯•ç»“æœ', 'info');

                const finalState = services.workflowManager.getWorkflowState();
                const history = services.workflowManager.getWorkflowHistory(1);

                if (history.length > 0 && finalState.isProcessing === false) {
                    logToConsole('integrationConsole', 'âœ… æµ‹è¯•ç»“æœéªŒè¯é€šè¿‡', 'success');

                    const lastWorkflow = history[0];
                    logToConsole('integrationConsole',
                        `æœ€è¿‘å·¥ä½œæµï¼š${lastWorkflow.status}ï¼Œåˆ†æ•°ï¼š${lastWorkflow.totalScore}åˆ†ï¼Œç½®ä¿¡åº¦ï¼š${lastWorkflow.confidence}%`,
                        'info'
                    );
                } else {
                    throw new Error('æµ‹è¯•ç»“æœéªŒè¯å¤±è´¥');
                }

                testStats.integration.tests++;

                showTestResult('integrationResult', true,
                    'âœ… ç»¼åˆé›†æˆæµ‹è¯•å®Œæˆ',
                    'æ‰€æœ‰ç»„ä»¶é›†æˆæ­£å¸¸ï¼Œå·¥ä½œæµè¿è¡ŒæˆåŠŸ'
                );

                logToConsole('integrationConsole', 'ğŸ‰ ç»¼åˆé›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼', 'success');

            } catch (error) {
                testStats.integration.errors++;
                logToConsole('integrationConsole', `âŒ é›†æˆæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showTestResult('integrationResult', false, 'é›†æˆæµ‹è¯•å¤±è´¥', error.message);
            } finally {
                showLoading('integrationLoading', false);
                updateStatistics();
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStatistics() {
            // è®¡ç®—å¹³å‡è¯„åˆ†æ—¶é—´
            const avgTimes = [
                testStats.adapter.avgTime / 1000,
                testStats.engine.avgTime / 1000,
                testStats.workflow.avgTime / 1000,
                testStats.integration.avgTime / 1000
            ].filter(time => time > 0);

            const overallAvgTime = avgTimes.reduce((a, b) => a + b, 0) / avgTimes.length;
            document.getElementById('avgScoringTime').textContent = `${overallAvgTime.toFixed(1)}s`;

            // è®¡ç®—æˆåŠŸç‡
            const totalTests = testStats.adapter.tests + testStats.engine.tests + testStats.workflow.tests + testStats.integration.tests;
            const totalErrors = testStats.adapter.errors + testStats.engine.errors + testStats.workflow.errors + testStats.integration.errors;
            const successRate = totalTests > 0 ? ((totalTests - totalErrors) / totalTests * 100).toFixed(1) : 0;

            document.getElementById('successRatePercent').textContent = `${successRate}%`;
            document.getElementById('totalTests').textContent = totalTests;
            document.getElementById('errorCount').textContent = totalErrors;

            // æ›´æ–°å·¥ä½œæµç»Ÿè®¡
            if (services) {
                const state = services.workflowManager.getWorkflowState();
                updateStatus('workflowCount', state.workflowCount);
                updateStatus('successRate', `${state.success}/${state.total}`);
            }
        }

        // å¯¼å‡ºæµ‹è¯•ç»“æœ
        function exportTestResults() {
            const results = {
                timestamp: new Date().toISOString(),
                statistics: testStats,
                summary: {
                    totalTests: testStats.adapter.tests + testStats.engine.tests + testStats.workflow.tests + testStats.integration.tests,
                    totalErrors: testStats.adapter.errors + testStats.engine.errors + testStats.workflow.errors + testStats.integration.errors,
                    overallSuccessRate: testStats.adapter.tests + testStats.engine.tests + testStats.workflow.tests + testStats.integration.tests > 0
                        ? ((testStats.adapter.tests + testStats.engine.tests + testStats.workflow.tests + testStats.integration.tests -
                           (testStats.adapter.errors + testStats.engine.errors + testStats.workflow.errors + testStats.integration.errors)) /
                           (testStats.adapter.tests + testStats.engine.tests + testStats.workflow.tests + testStats.integration.tests) * 100).toFixed(1)
                        : 0
                },
                services: services ? services.workflowManager.getWorkflowHistory() : []
            };

            const dataStr = JSON.stringify(results, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-results-${new Date().toISOString()}.json`;
            a.click();
            URL.revokeObjectURL(url);

            logToConsole('integrationConsole', 'æµ‹è¯•ç»“æœå·²å¯¼å‡º', 'info');
        }

        // é‡ç½®ç»Ÿè®¡
        function resetStatistics() {
            Object.keys(testStats).forEach(key => {
                testStats[key] = { tests: 0, errors: 0, avgTime: 0 };
                if (key === 'workflow') {
                    testStats[key].success = 0;
                    testStats[key].total = 0;
                }
            });

            updateStatistics();
            logToConsole('integrationConsole', 'ç»Ÿè®¡ä¿¡æ¯å·²é‡ç½®', 'info');
        }

        // è¾…åŠ©æµ‹è¯•å‡½æ•°
        async function testAutoMode() {
            if (!services) {
                alert('è¯·å…ˆåˆå§‹åŒ–æœåŠ¡');
                return;
            }

            logToConsole('integrationConsole', 'æµ‹è¯•è‡ªåŠ¨æ¨¡å¼...', 'info');
            services.workflowManager.setAutoMode(true);
            logToConsole('integrationConsole', 'è‡ªåŠ¨æ¨¡å¼å·²å¼€å¯', 'info');
        }

        async function testManualReviewFlow() {
            if (!services) {
                alert('è¯·å…ˆåˆå§‹åŒ–æœåŠ¡');
                return;
            }

            logToConsole('integrationConsole', 'æµ‹è¯•äººå·¥å¤æ ¸æµç¨‹...', 'info');

            // æ¨¡æ‹Ÿä½ç½®ä¿¡åº¦è¯„åˆ†ç»“æœ
            const mockLowConfidenceResult = {
                totalScore: 12,
                confidence: 45,
                breakdown: [],
                feedback: 'è¯„åˆ†ç½®ä¿¡åº¦è¾ƒä½ï¼Œå»ºè®®äººå·¥å¤æ ¸'
            };

            services.workflowManager.emit('manual-review-required', {
                result: mockLowConfidenceResult,
                reason: 'ç½®ä¿¡åº¦ä½äºé˜ˆå€¼'
            });

            logToConsole('integrationConsole', 'âœ… äººå·¥å¤æ ¸æµç¨‹æµ‹è¯•å®Œæˆ', 'success');
        }

        async function testPerformance() {
            if (!services) {
                alert('è¯·å…ˆåˆå§‹åŒ–æœåŠ¡');
                return;
            }

            logToConsole('integrationConsole', 'å¼€å§‹æ€§èƒ½æµ‹è¯•...', 'info');

            const iterations = 10;
            const results = [];

            for (let i = 0; i < iterations; i++) {
                const startTime = performance.now();

                try {
                    // æ‰§è¡Œå¿«é€Ÿæµ‹è¯•
                    await services.zhixueAdapter.detectPageType();
                    const endTime = performance.now();
                    results.push(endTime - startTime);

                    logToConsole('integrationConsole', `ç¬¬${i + 1}æ¬¡æµ‹è¯•ï¼š${(endTime - startTime).toFixed(2)}ms`, 'info');
                } catch (error) {
                    logToConsole('integrationConsole', `ç¬¬${i + 1}æ¬¡æµ‹è¯•å¤±è´¥`, 'error');
                }
            }

            const avgTime = results.reduce((a, b) => a + b, 0) / results.length;
            const minTime = Math.min(...results);
            const maxTime = Math.max(...results);

            logToConsole('integrationConsole', `æ€§èƒ½æµ‹è¯•å®Œæˆï¼š`, 'success');
            logToConsole('integrationConsole', `å¹³å‡å“åº”æ—¶é—´ï¼š${avgTime.toFixed(2)}ms`, 'info');
            logToConsole('integrationConsole', `æœ€å¿«å“åº”æ—¶é—´ï¼š${minTime.toFixed(2)}ms`, 'info');
            logToConsole('integrationConsole', `æœ€æ…¢å“åº”æ—¶é—´ï¼š${maxTime.toFixed(2)}ms`, 'info');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ”§ AIæ™ºèƒ½é˜…å·åŠ©æ‰‹é›†æˆæµ‹è¯•ç³»ç»Ÿå·²åŠ è½½');
            console.log('ğŸ“‹ å¯ç”¨æµ‹è¯•åŠŸèƒ½ï¼š');
            console.log('  1. æ™ºå­¦ç½‘é€‚é…å™¨æµ‹è¯• - æ£€æµ‹é¡µé¢å…ƒç´ å’Œæ•æ‰åŠŸèƒ½');
            console.log('  2. AIè¯„åˆ†å¼•æ“æµ‹è¯• - æµ‹è¯•è¯„åˆ†ç»†åˆ™ç”Ÿæˆå’ŒAIè¯„åˆ†');
            console.log('  3. å·¥ä½œæµç®¡ç†å™¨æµ‹è¯• - æµ‹è¯•å®Œæ•´å·¥ä½œæµåè°ƒ');
            console.log('  4. ç»¼åˆé›†æˆæµ‹è¯• - æµ‹è¯•æ‰€æœ‰ç»„ä»¶çš„é›†æˆ');
            console.log('  5. æ€§èƒ½æµ‹è¯• - æµ‹è¯•ç³»ç»Ÿå“åº”æ€§èƒ½');

            // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
            setTimeout(() => {
                if (confirm('æ˜¯å¦ç«‹å³åˆå§‹åŒ–æœåŠ¡å¹¶å¼€å§‹æµ‹è¯•ï¼Ÿ')) {
                    initializeServices();
                }
            }, 1000);
        });
    </script>
</body>
</html>
