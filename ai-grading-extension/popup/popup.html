<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êô∫Â≠¶ÁΩëAIÊô∫ËÉΩÈòÖÂç∑Âä©Êâã</title>

    <!-- ÂºïÂÖ•Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ÂºïÂÖ•LucideÂõæÊ†áÂ∫ì -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <!-- ÂºïÂÖ•Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- ÂºïÂÖ•jsPDFÂ∫ìÁî®‰∫éPDFÁîüÊàê -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- ÂºïÂÖ•PDF.jsÁî®‰∫éPDFËß£Êûê -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <!-- ÂºïÂÖ•Tesseract.jsÁî®‰∫éOCRÂõæÁâáÊñáÂ≠óËØÜÂà´ -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

    <!-- ÂºïÂÖ•InterÂ≠ó‰Ωì -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- ÂºïÂÖ•‰∏ªÊ†∑ÂºèÊñá‰ª∂ -->
    <link rel="stylesheet" href="../ui/styles/main.css">

    <style>
        /* Chrome Êâ©Â±ï Popup ÁâπÂÆöÊ†∑Âºè */
        body {
            width: 400px;
            min-height: 500px;
            max-height: 600px;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        html {
            width: 400px;
            min-height: 500px;
            max-height: 600px;
            margin: 0;
            padding: 0;
        }

        .popup-container {
            width: 100%;
            min-height: 500px;
            max-height: 600px;
            display: flex;
            flex-direction: column;
        }

        .popup-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 10;
            flex-shrink: 0;
        }

        .popup-body {
            padding: 12px;
            flex: 1;
            overflow-y: auto;
            max-height: 520px;
        }

        .popup-footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 8px 16px;
            position: sticky;
            bottom: 0;
            z-index: 10;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <!-- ‰∏ªÂÆπÂô® -->
    <div class="popup-container">
        <!-- Â§¥ÈÉ® -->
        <header class="popup-header">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="brain-circuit" class="w-5 h-5 text-blue-600"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-semibold text-gray-900">AIÈòÖÂç∑Âä©Êâã</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="rubric-config-button" class="p-2 hover:bg-gray-100 rounded-lg" title="ËØÑÂàÜÊ†áÂáÜÈÖçÁΩÆ">
                        <i data-lucide="clipboard-list" class="w-4 h-4 text-gray-600"></i>
                    </button>
                    <button id="settings-button" class="p-2 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="settings" class="w-4 h-4 text-gray-600"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Áä∂ÊÄÅÊ†è (ÁÆÄÂåñÁâà) -->
        <div class="bg-white border-b border-gray-200 px-4 py-2">
            <div class="flex items-center justify-between">
                <!-- ÂõæÁâáÂÆö‰ΩçÁä∂ÊÄÅ -->
                <div class="flex items-center space-x-1">
                    <div class="w-2 h-2 bg-green-500 rounded-full" title="Áä∂ÊÄÅÊ≠£Â∏∏"></div>
                    <i data-lucide="target" class="w-3 h-3 text-gray-600"></i>
                </div>

                <!-- ÂàÜÈöîÁ∫ø -->
                <div class="w-px h-3 bg-gray-300"></div>

                <!-- AIÈìæÊé•Áä∂ÊÄÅ -->
                <div class="flex items-center space-x-1">
                    <div class="w-2 h-2 bg-green-500 rounded-full" title="Áä∂ÊÄÅÊ≠£Â∏∏"></div>
                    <i data-lucide="link" class="w-3 h-3 text-gray-600"></i>
                </div>

                <!-- ÂàÜÈöîÁ∫ø -->
                <div class="w-px h-3 bg-gray-300"></div>

                <!-- ËØÑÂàÜËÆæÁΩÆÁä∂ÊÄÅ -->
                <div id="status-rubric-config" class="flex items-center space-x-1 cursor-pointer hover:bg-gray-50 transition-colors py-1 px-2 rounded">
                    <div class="w-2 h-2 bg-green-500 rounded-full" title="Áä∂ÊÄÅÊ≠£Â∏∏"></div>
                    <i data-lucide="clipboard-list" class="w-3 h-3 text-gray-600"></i>
                </div>
            </div>
        </div>

        <!-- Tab ÂàáÊç¢ÊåâÈíÆ -->
        <div class="bg-gray-50 px-4 py-2">
            <div class="flex bg-white p-1 rounded-lg space-x-1">
                <button data-tab="grading" class="tab-button active flex-1 text-center py-2 px-2 rounded-md text-xs font-medium transition-all flex items-center justify-center space-x-1 bg-blue-600 text-white shadow-sm">
                    <i data-lucide="sparkles" class="w-3 h-3"></i>
                    <span>ÈòÖÂç∑</span>
                </button>
                <button data-tab="review" class="tab-button flex-1 text-center py-2 px-2 rounded-md text-xs font-medium transition-all flex items-center justify-center space-x-1 text-gray-700 hover:bg-gray-50 border border-transparent">
                    <i data-lucide="user-check" class="w-3 h-3"></i>
                    <span>Â§çÊ†∏</span>
                </button>
                <button data-tab="analysis" class="tab-button flex-1 text-center py-2 px-2 rounded-md text-xs font-medium transition-all flex items-center justify-center space-x-1 text-gray-700 hover:bg-gray-50 border border-transparent">
                    <i data-lucide="bar-chart-3" class="w-3 h-3"></i>
                    <span>ÂàÜÊûê</span>
                </button>
            </div>
        </div>

        <!-- Tab ÂÜÖÂÆπÂå∫Âüü -->
        <main class="popup-body">
            <!-- Êô∫ËÉΩÈòÖÂç∑Ê®°Âùó (ÈªòËÆ§ÊòæÁ§∫) -->
            <div id="tab-content-grading" class="tab-content scale-in space-y-3">
                <!-- ÂÆûÊó∂ÁªüËÆ° -->
                <div class="bg-white rounded-lg p-3 border border-gray-200">
                    <div class="flex items-center space-x-2">
                        <i data-lucide="target" class="w-4 h-4 text-gray-800"></i>
                        <h3 class="text-sm font-semibold text-gray-800">ÂÆûÊó∂ÁªüËÆ°</h3>
                    </div>
                    <!-- Ê∞¥Âπ≥Á¥ßÂáëÂ∏ÉÂ±Ä - ËäÇÁúÅ40%Á©∫Èó¥ -->
                    <div class="flex items-center justify-between mt-3 px-2">
                        <div class="flex flex-col items-center">
                            <div class="text-base font-bold text-gray-800">156</div>
                            <div class="text-[10px] text-gray-500 whitespace-nowrap">‰ªäÊó•Â∑≤ÈòÖ</div>
                        </div>
                        <div class="h-8 w-px bg-gray-200"></div>
                        <div class="flex flex-col items-center">
                            <div class="text-base font-bold text-gray-800">32Áßí</div>
                            <div class="text-[10px] text-gray-500 whitespace-nowrap">Âπ≥ÂùáÁî®Êó∂</div>
                        </div>
                        <div class="h-8 w-px bg-gray-200"></div>
                        <div class="flex flex-col items-center">
                            <div class="text-base font-bold text-green-600">98%</div>
                            <div class="text-[10px] text-gray-500 whitespace-nowrap">ÂáÜÁ°ÆÁéá</div>
                        </div>
                        <div class="h-8 w-px bg-gray-200"></div>
                        <div class="flex flex-col items-center">
                            <div class="text-base font-bold text-blue-600">92%</div>
                            <div class="text-[10px] text-gray-500 whitespace-nowrap">ÁΩÆ‰ø°Â∫¶</div>
                        </div>
                    </div>
                </div>

                <!-- ÈòÖÂç∑Êìç‰Ωú -->
                <div class="bg-white rounded-lg p-3 border border-gray-200">
                    <div class="flex items-center space-x-2 mb-2">
                        <i data-lucide="radio-button" class="w-4 h-4 text-gray-800"></i>
                        <h3 class="text-sm font-semibold text-gray-800">ÈòÖÂç∑Êìç‰Ωú</h3>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <button id="aiTrialBtn" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded-lg font-medium transition-colors flex items-center justify-center space-x-1">
                            <i data-lucide="search" class="w-3 h-3"></i>
                            <span class="text-xs">AIËØïÈòÖ</span>
                        </button>
                        <button id="aiAutoBtn" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded-lg font-medium transition-colors flex items-center justify-center space-x-1">
                            <i data-lucide="zap" class="w-3 h-3"></i>
                            <span class="text-xs">AIËá™Âä®</span>
                        </button>
                        <button id="pauseBtn" class="bg-orange-500 hover:bg-orange-600 text-white py-2 px-3 rounded-lg font-medium transition-colors flex items-center justify-center space-x-1">
                            <i data-lucide="pause" class="w-3 h-3"></i>
                            <span class="text-xs">ÊöÇÂÅú</span>
                        </button>
                    </div>
                </div>

                <!-- ËØÑÂàÜÁªìÊûú -->
                <div class="bg-white rounded-lg p-3 border border-gray-200">
                    <div class="flex items-center space-x-2 mb-2">
                        <i data-lucide="check-circle" class="w-4 h-4 text-gray-800"></i>
                        <h3 class="text-sm font-semibold text-gray-800">ËØÑÂàÜÁªìÊûú</h3>
                    </div>
                    <div class="p-3 bg-blue-50 rounded-lg">
                        <div class="text-center py-2">
                            <div class="text-2xl font-bold text-blue-800" id="total-score">85<span class="text-lg text-blue-600">/100</span></div>
                            <div class="text-xs text-blue-600 mt-1">ÊÄªÂàÜ</div>
                        </div>

                        <!-- ÂàÜÈ°πÂæóÂàÜ -->
                        <div class="space-y-1 mt-2" id="dimension-scores">
                            <div class="flex justify-between text-xs">
                                <span class="text-blue-700">ËßÇÁÇπÊòéÁ°Æ:</span>
                                <span class="font-medium">28/30</span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span class="text-green-700">Âè≤ÂÆûÂáÜÁ°Æ:</span>
                                <span class="font-medium">25/30</span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span class="text-purple-700">ËÆ∫Ëø∞ÂÖÖÂàÜ:</span>
                                <span class="font-medium">22/25</span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span class="text-orange-700">ËØ≠Ë®ÄË°®Ëææ:</span>
                                <span class="font-medium">10/15</span>
                            </div>
                        </div>
                    </div>

                    <!-- ËØÑÂàÜÁêÜÁî± -->
                    <div class="mt-2 p-2 bg-gray-50 rounded-lg">
                        <h4 class="text-xs font-medium text-gray-700 mb-1">üí° ËØÑÂàÜÁêÜÁî±</h4>
                        <div id="scoring-reasons" class="text-xs text-gray-600 space-y-1">
                            <div class="flex items-start space-x-2">
                                <span class="font-medium text-blue-600 min-w-[60px]">ËßÇÁÇπÊòéÁ°Æ:</span>
                                <span>ËÆ∫ÁÇπÊ∏ÖÊô∞ÔºåÁ´ãÂú∫ÊòéÁ°Æ</span>
                            </div>
                            <div class="flex items-start space-x-2">
                                <span class="font-medium text-green-600 min-w-[60px]">Âè≤ÂÆûÂáÜÁ°Æ:</span>
                                <span>ÂéÜÂè≤‰∫ãÂÆûÂáÜÁ°ÆÊó†ËØØ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ËØÑÂàÜËÆ∞ÂΩïÊü•Áúã -->
                <div class="bg-white rounded-lg p-3 border border-gray-200">
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="clipboard-list" class="w-4 h-4 text-gray-800"></i>
                            <h3 class="text-sm font-semibold text-gray-800">ËØÑÂàÜËÆ∞ÂΩï</h3>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button id="refreshRecordsBtn" class="text-xs text-blue-600 hover:text-blue-700 flex items-center">
                                <i data-lucide="refresh-ccw" class="w-3 h-3 mr-1"></i>
                                Âà∑Êñ∞
                            </button>
                        </div>
                    </div>

                    <!-- ËÆ∞ÂΩïÂàóË°® -->
                    <div class="max-h-40 overflow-y-auto custom-scrollbar">
                        <div class="space-y-2" id="reviewRecordsList">
                            <div class="text-center py-4 text-gray-500 text-xs">
                                Ê≠£Âú®Âä†ËΩΩËØÑÂàÜËÆ∞ÂΩï...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‰∫∫Â∑•Â§çÊ†∏Ê®°Âùó (ÈªòËÆ§ÈöêËóè) -->
            <div id="tab-content-review" class="tab-content hidden space-y-3">
                <!-- Â§çÊ†∏ËØïÂç∑ËøõÂ∫¶ -->
                <div class="bg-white rounded-lg p-3 border border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="bar-chart-3" class="w-4 h-4 text-gray-800"></i>
                            <h3 class="text-sm font-semibold text-gray-800">Â§çÊ†∏ËøõÂ∫¶</h3>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-blue-600" id="reviewProgressText">0/15</div>
                        </div>
                    </div>

                    <!-- ‰∏ªË¶ÅËøõÂ∫¶Êù° -->
                    <div class="mb-3">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="text-gray-600">ÊÄª‰ΩìËøõÂ∫¶</span>
                            <span class="text-blue-600 font-medium" id="reviewProgressPercentage">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full transition-all duration-700 ease-out flex items-center justify-end pr-1" style="width: 0%" id="reviewProgressBar">
                                <i data-lucide="check" class="w-2 h-2 text-white"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Â§çÊ†∏Áä∂ÊÄÅ‰ø°ÊÅØ -->
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <div class="bg-green-50 rounded-lg p-2 text-center">
                            <div class="text-xs text-green-600 mb-1">ÂΩìÂâçÂæóÂàÜ</div>
                            <div class="text-sm font-bold text-green-700" id="current-score">0ÂàÜ</div>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-2 text-center">
                            <div class="text-xs text-blue-600 mb-1">AIÂª∫ËÆÆ</div>
                            <div class="text-sm font-bold text-blue-700" id="ai-suggestion">0ÂàÜ</div>
                        </div>
                    </div>

                    <!-- ÊâìÂàÜÂå∫Âüü -->
                    <div class="mb-3 p-2 bg-gray-50 rounded-lg">
                        <div class="flex items-center justify-center space-x-2">
                            <label class="text-xs font-medium text-gray-700">ÂæóÂàÜÔºö</label>
                            <input type="number" id="score-input" class="w-16 text-sm font-bold text-center border-none focus:ring-0 focus:outline-none" value="0" min="0" max="100">
                            <span class="text-xs text-gray-500">/ 100</span>
                        </div>
                    </div>

                    <!-- Â§çÊ†∏Êìç‰ΩúÊåâÈíÆ -->
                    <div class="grid grid-cols-2 gap-2">
                        <button id="skip-review" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-3 rounded-lg font-medium transition-all flex items-center justify-center space-x-1">
                            <i data-lucide="skip-forward" class="w-3 h-3"></i>
                            <span class="text-xs">Ë∑≥Ëøá</span>
                        </button>
                        <button id="save-review" class="bg-green-500 hover:bg-green-600 text-white py-2 px-3 rounded-lg font-medium transition-all flex items-center justify-center space-x-1">
                            <i data-lucide="save" class="w-3 h-3"></i>
                            <span class="text-xs">‰øùÂ≠ò</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Êï∞ÊçÆÂàÜÊûê (ÈªòËÆ§ÈöêËóè) -->
            <div id="tab-content-analysis" class="tab-content hidden space-y-3">
                <!-- ËØÑÈòÖÊï∞ÊçÆÂàÜÊûê -->
                <div class="bg-white rounded-lg p-3 border border-gray-200">
                    <div class="flex items-center space-x-2 mb-2">
                        <i data-lucide="clipboard-list" class="w-4 h-4 text-gray-800"></i>
                        <h3 class="text-sm font-semibold text-gray-800">ËØÑÈòÖÊï∞ÊçÆ</h3>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <div class="text-center py-2 border border-gray-200 rounded">
                            <i data-lucide="file-text" class="w-4 h-4 text-blue-600 mx-auto mb-1"></i>
                            <div class="text-lg font-bold text-gray-800" id="totalPapers">892</div>
                            <div class="text-xs text-gray-500">ËØÑÈòÖ‰ªΩÊï∞</div>
                        </div>
                        <div class="text-center py-2 border border-gray-200 rounded">
                            <i data-lucide="trending-up" class="w-4 h-4 text-green-600 mx-auto mb-1"></i>
                            <div class="text-lg font-bold text-gray-800" id="averageScore">85.6</div>
                            <div class="text-xs text-gray-500">Âπ≥ÂùáÂàÜ</div>
                        </div>
                        <div class="text-center py-2 border border-gray-200 rounded">
                            <i data-lucide="percent" class="w-4 h-4 text-purple-600 mx-auto mb-1"></i>
                            <div class="text-lg font-bold text-gray-800" id="scoreRate">85.6%</div>
                            <div class="text-xs text-gray-500">ÂæóÂàÜÁéá</div>
                        </div>
                    </div>
                </div>

                <!-- ÂàÜÊï∞ÂàÜÂ∏ÉÂõæË°® -->
                <div class="bg-white rounded-lg p-3 border border-gray-200">
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="trending-up" class="w-4 h-4 text-gray-800"></i>
                            <h3 class="text-sm font-semibold text-gray-800">ÂàÜÂ∏ÉÂõæË°®</h3>
                        </div>
                        <select id="chartTypeSelect" class="text-xs border border-gray-300 rounded px-2 py-1">
                            <option value="bar">Êü±Áä∂Âõæ</option>
                            <option value="line">ÊäòÁ∫øÂõæ</option>
                            <option value="pie">È•ºÂõæ</option>
                        </select>
                    </div>
                    <div class="h-32">
                        <canvas id="scoreDistributionChart"></canvas>
                    </div>
                </div>

                <!-- ËØ¶ÁªÜÁªüËÆ° -->
                <div class="bg-white rounded-lg p-3 border border-gray-200">
                    <div class="flex items-center space-x-2 mb-2">
                        <i data-lucide="bar-chart-3" class="w-4 h-4 text-gray-800"></i>
                        <h3 class="text-sm font-semibold text-gray-800">ËØ¶ÁªÜÁªüËÆ°</h3>
                    </div>
                    <div class="space-y-1" id="detailedStats">
                        <div class="flex justify-between items-center py-1 border-b border-gray-100">
                            <span class="text-xs text-gray-700">ÊúÄÈ´òÂàÜ</span>
                            <span class="font-medium text-gray-900 text-xs" id="maxScore">98ÂàÜ</span>
                        </div>
                        <div class="flex justify-between items-center py-1 border-b border-gray-100">
                            <span class="text-xs text-gray-700">ÊúÄ‰ΩéÂàÜ</span>
                            <span class="font-medium text-gray-900 text-xs" id="minScore">62ÂàÜ</span>
                        </div>
                        <div class="flex justify-between items-center py-1 border-b border-gray-100">
                            <span class="text-xs text-gray-700">‰∏≠‰ΩçÊï∞</span>
                            <span class="font-medium text-gray-900 text-xs" id="medianScore">87ÂàÜ</span>
                        </div>
                        <div class="flex justify-between items-center py-1">
                            <span class="text-xs text-gray-700">Ê†áÂáÜÂ∑Æ</span>
                            <span class="font-medium text-gray-900 text-xs" id="stdDev">8.3</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- È°µËÑö -->
        <footer class="popup-footer">
            <div class="text-center">
                <span class="text-xs text-gray-500">Êô∫Â≠¶ÁΩëAIÊô∫ËÉΩÈòÖÂç∑Âä©Êâã v5.0</span>
            </div>
        </footer>
    </div>

    <!-- Ê®°ÊÄÅÊ°ÜÂÆπÂô® (ÈöêËóèÁä∂ÊÄÅ) -->
    <div id="modal-container" class="hidden">
        <!-- ÂàÜÊï∞Ë∞ÉÊï¥Ê®°ÊÄÅÊ°Ü -->
        <div id="scoreAdjustmentModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-2xl p-4 w-full max-w-md transform transition-all scale-95 opacity-0" id="scoreModalContent">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Ë∞ÉÊï¥ÂàÜÈ°πÂæóÂàÜ</h3>
                        <button id="closeScoreModalBtn" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div id="scoreAdjustmentList" class="space-y-3 mb-4 max-h-60 overflow-y-auto custom-scrollbar">
                        <!-- ÂàÜÈ°πÂæóÂàÜË∞ÉÊï¥È°πÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
                    </div>
                    <div class="mb-3">
                        <label class="block text-xs font-medium text-gray-700 mb-1">‰øÆÊîπÁêÜÁî±</label>
                        <textarea id="scoreModifyReason" class="w-full p-2 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-orange-500 focus:border-transparent" rows="2" placeholder="ËØ∑ËØ¥Êòé‰øÆÊîπÂàÜÊï∞ÁöÑÁêÜÁî±..."></textarea>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3 mb-4">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-medium text-gray-700">ÊÄªÂàÜ:</span>
                            <span class="text-xl font-bold text-orange-600" id="adjustedTotalScore">0</span>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button id="cancelScoreAdjustBtn" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-colors text-xs">ÂèñÊ∂à</button>
                        <button id="confirmScoreAdjustBtn" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors text-xs">Á°ÆËÆ§‰øÆÊîπ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Á°ÆËÆ§ÂØπËØùÊ°Ü -->
        <div id="reviewConfirmDialog" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-2xl p-4 w-full max-w-sm transform transition-all scale-95 opacity-0" id="confirmDialogContent">
                    <div class="flex items-start space-x-3">
                        <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-600"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-base font-bold text-gray-800 mb-2" id="confirmDialogTitle">Á°ÆËÆ§Êìç‰Ωú</h3>
                            <p class="text-xs text-gray-600 mb-3" id="confirmDialogMessage">ÊÇ®Á°ÆÂÆöË¶ÅÊâßË°åÊ≠§Êìç‰ΩúÂêóÔºü</p>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2 mt-4">
                        <button id="cancelConfirmBtn" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-colors text-xs">ÂèñÊ∂à</button>
                        <button id="okConfirmBtn" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors text-xs">Á°ÆËÆ§</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ËØÑÂàÜÊ†áÂáÜÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü -->
        <div id="rubricConfigModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-2xl p-4 w-full max-w-2xl transform transition-all scale-95 opacity-0" id="rubricModalContent">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">ËØÑÂàÜÊ†áÂáÜÈÖçÁΩÆ</h3>
                        <button id="closeRubricModalBtn" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>

                    <div class="space-y-4 mb-6 max-h-96 overflow-y-auto custom-scrollbar">
                        <!-- ËØÑÂàÜÁª¥Â∫¶ÁÆ°ÁêÜ -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-3">ËØÑÂàÜÁª¥Â∫¶</h4>
                            <div id="rubricDimensions" class="space-y-3">
                                <!-- Âä®ÊÄÅÁîüÊàêÁöÑÁª¥Â∫¶È°π -->
                            </div>
                            <button id="addDimensionBtn" class="mt-3 px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs transition-colors">
                                <i data-lucide="plus" class="w-3 h-3 inline mr-1"></i>Ê∑ªÂä†Áª¥Â∫¶
                            </button>
                        </div>

                        <!-- ËØÑÂàÜÊ†áÂáÜÊ®°Êùø -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-3">Ê†áÂáÜÊ®°Êùø</h4>
                            <div class="grid grid-cols-1 gap-3">
                                <div class="flex items-center justify-between p-3 bg-white rounded-lg border cursor-pointer hover:border-blue-500 transition-colors template-item" data-template="essay">
                                    <div>
                                        <h5 class="font-medium text-gray-800">‰ΩúÊñáËØÑÂàÜ</h5>
                                        <p class="text-xs text-gray-600">ÂÜÖÂÆπ„ÄÅÁªìÊûÑ„ÄÅËØ≠Ë®Ä„ÄÅ‰π¶ÂÜô</p>
                                    </div>
                                    <i data-lucide="check" class="w-4 h-4 text-green-600 hidden selected-icon"></i>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-white rounded-lg border cursor-pointer hover:border-blue-500 transition-colors template-item" data-template="objective">
                                    <div>
                                        <h5 class="font-medium text-gray-800">ÂÆ¢ËßÇÈ¢òËØÑÂàÜ</h5>
                                        <p class="text-xs text-gray-600">Á≠îÊ°àÊ≠£Á°ÆÊÄß</p>
                                    </div>
                                    <i data-lucide="check" class="w-4 h-4 text-green-600 hidden selected-icon"></i>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-white rounded-lg border cursor-pointer hover:border-blue-500 transition-colors template-item" data-template="subjective">
                                    <div>
                                        <h5 class="font-medium text-gray-800">‰∏ªËßÇÈ¢òËØÑÂàÜ</h5>
                                        <p class="text-xs text-gray-600">Áü•ËØÜÁÇπ„ÄÅÈÄªËæë„ÄÅË°®Ëææ</p>
                                    </div>
                                    <i data-lucide="check" class="w-4 h-4 text-green-600 hidden selected-icon"></i>
                                </div>
                            </div>
                        </div>

                        <!-- ÊÄªÂàÜËÆæÁΩÆ -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-3">ÊÄªÂàÜËÆæÁΩÆ</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">ÊÄªÂàÜ</label>
                                    <input type="number" id="totalScoreInput" class="w-full p-2 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent" value="100" min="1" max="1000">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">ÂèäÊ†ºÂàÜ</label>
                                    <input type="number" id="passScoreInput" class="w-full p-2 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent" value="60" min="1" max="1000">
                                </div>
                            </div>
                        </div>

                        <!-- ËØÑÂàÜÂèØËßÜÂåñ -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-3">ËØÑÂàÜÂàÜÂ∏ÉÈ¢ÑËßà</h4>
                            <canvas id="rubricChart" class="w-full h-32"></canvas>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-2">
                        <button id="cancelRubricConfigBtn" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-colors text-xs">ÂèñÊ∂à</button>
                        <button id="saveRubricConfigBtn" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors text-xs">‰øùÂ≠òÈÖçÁΩÆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-2xl p-4 w-full max-w-2xl transform transition-all scale-95 opacity-0" id="settingsModalContent">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Á≥ªÁªüËÆæÁΩÆ</h3>
                        <button id="closeSettingsModalBtn" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>

                    <div class="space-y-6 mb-6 max-h-96 overflow-y-auto custom-scrollbar">
                        <!-- APIÈÖçÁΩÆ -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-3">APIÈÖçÁΩÆ</h4>
                            <div class="space-y-3">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">APIÁ±ªÂûã</label>
                                        <select id="apiTypeSelect" class="w-full p-2 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                            <option value="openai">OpenAI GPT-4o</option>
                                            <option value="gemini">Google Gemini</option>
                                            <option value="claude">Anthropic Claude</option>
                                            <option value="custom">Ëá™ÂÆö‰πâAPI</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">APIÂØÜÈí•</label>
                                        <div class="flex space-x-2">
                                            <input type="password" id="apiKeyInput" class="flex-1 p-2 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ËæìÂÖ•APIÂØÜÈí•">
                                            <button id="testApiBtn" class="px-3 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-xs transition-colors">ÊµãËØï</button>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">APIÁ´ØÁÇπ</label>
                                    <input type="url" id="apiEndpointInput" class="w-full p-2 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="https://api.openai.com/v1/chat/completions">
                                </div>
                            </div>
                        </div>

                        <!-- Ê®°ÂûãÂèÇÊï∞ -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-3">Ê®°ÂûãÂèÇÊï∞</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Ê∏©Â∫¶ (0-2)</label>
                                    <input type="range" id="temperatureRange" class="w-full" min="0" max="2" step="0.1" value="0.7">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>0</span>
                                        <span id="temperatureValue">0.7</span>
                                        <span>2</span>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">ÊúÄÂ§ßToken</label>
                                    <input type="number" id="maxTokensInput" class="w-full p-2 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent" value="2048" min="100" max="8192">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Top-P (0-1)</label>
                                    <input type="range" id="topPRange" class="w-full" min="0" max="1" step="0.1" value="1">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>0</span>
                                        <span id="topPValue">1</span>
                                        <span>1</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ËØÑÂàÜÁ≠ñÁï• -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-3">ËØÑÂàÜÁ≠ñÁï•</h4>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="font-medium text-gray-800 text-xs">‰∏•Ê†ºÊ®°Âºè</label>
                                        <p class="text-xs text-gray-600">Êâ£ÂàÜÊõ¥‰∏•Ê†ºÔºåÈÄÇÂêàÊ≠£ÂºèËÄÉËØï</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="strictModeToggle" class="sr-only peer" checked>
                                        <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="font-medium text-gray-800 text-xs">ÂèåÊ®°ÂûãÈ™åËØÅ</label>
                                        <p class="text-xs text-gray-600">‰ΩøÁî®‰∏§‰∏™Ê®°ÂûãËØÑÂàÜÂèñÂπ≥ÂùáÂÄº</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="dualModelToggle" class="sr-only peer">
                                        <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">ËØÑÂàÜÊ®°Âºè</label>
                                    <select id="gradingModeSelect" class="w-full p-2 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="auto">Ëá™Âä®ËØÑÂàÜ</option>
                                        <option value="assist">ËæÖÂä©ËØÑÂàÜ</option>
                                        <option value="manual">ÊâãÂä®ËØÑÂàÜ</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- È´òÁ∫ßËÆæÁΩÆ -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-3">È´òÁ∫ßËÆæÁΩÆ</h4>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="font-medium text-gray-800 text-xs">Ëá™Âä®‰øùÂ≠ò</label>
                                        <p class="text-xs text-gray-600">ÊØè30ÁßíËá™Âä®‰øùÂ≠òËØÑÂàÜËÆ∞ÂΩï</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="autoSaveToggle" class="sr-only peer" checked>
                                        <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="font-medium text-gray-800 text-xs">Ë∞ÉËØïÊ®°Âºè</label>
                                        <p class="text-xs text-gray-600">ÊòæÁ§∫ËØ¶ÁªÜÁöÑË∞ÉËØï‰ø°ÊÅØ</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="debugModeToggle" class="sr-only peer">
                                        <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">ÈòÖÂç∑ÈÄüÂ∫¶</label>
                                    <select id="gradingSpeedSelect" class="w-full p-2 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="slow">ÊÖ¢ÈÄü (Ë¥®Èáè‰ºòÂÖà)</option>
                                        <option value="normal" selected>Ê≠£Â∏∏</option>
                                        <option value="fast">Âø´ÈÄü (ÈÄüÂ∫¶‰ºòÂÖà)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-2">
                        <button id="cancelSettingsBtn" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-colors text-xs">ÂèñÊ∂à</button>
                        <button id="saveSettingsBtn" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors text-xs">‰øùÂ≠òËÆæÁΩÆ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂºïÂÖ•SheetJSÂ∫ìÔºåÁî®‰∫éExcelÊñá‰ª∂Ëß£Êûê -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- ÂºïÂÖ•jsPDFÂ∫ìÔºåÁî®‰∫éPDFÂØºÂá∫ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- ÂºïÂÖ•LucideÂõæÊ†áÂ∫ì -->
    <script>
        // ÂàùÂßãÂåñLucideÂõæÊ†á
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });
    </script>

    <!-- ÂºïÂÖ•Popup‰∏ªËÑöÊú¨ -->
    <script src="popup.js"></script>
</body>
</html>
