<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ™ºèƒ½é˜…å·åŠ©æ‰‹ - æç®€é£æ ¼ç‰ˆ</title>
    <!-- å¼•å…¥Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥Lucideå›¾æ ‡åº“ -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <!-- å¼•å…¥Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- å¼•å…¥jsPDFåº“ç”¨äºPDFç”Ÿæˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- å¼•å…¥PDF.jsç”¨äºPDFè§£æ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- å¼•å…¥Tesseract.jsç”¨äºOCRå›¾ç‰‡æ–‡å­—è¯†åˆ« -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
    <!-- å¼•å…¥Interå­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Minimalist Color Palette */
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --accent-blue: #3b82f6;
            --accent-blue-light: #dbeafe;
            --accent-green: #10b981;
            --accent-green-light: #d1fae5;
            --accent-purple: #8b5cf6;
            --accent-purple-light: #ede9fe;
            --accent-orange: #f59e0b;
            --accent-orange-light: #fef3c7;
        }

        /* å…¨å±€ç„¦ç‚¹æ ·å¼ - æå‡å¯è®¿é—®æ€§ */
        button:focus,
        [role="button"]:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
        }

        [data-lucide] {
            width: 1.25rem;
            height: 1.25rem;
        }

        /* Minimalist Transitions */
        @keyframes slide-in {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scale-in {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .slide-in {
            animation: slide-in 0.3s ease-out;
        }

        .fade-in {
            animation: fade-in 0.2s ease-out;
        }

        .scale-in {
            animation: scale-in 0.2s ease-out;
        }

        /* Minimalist Card Styles */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            transition: box-shadow 0.2s ease;
        }

        .card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        /* Tab Styles */
        .tab-indicator {
            transition: left 0.2s ease;
        }

        .tab-button {
            position: relative;
            z-index: 10;
            outline: none;
        }
        .tab-button:focus {
            ring: 2px;
            ring-color: rgb(59 130 246 / 0.5);
            ring-offset: 2px;
        }

        /* Progress Bar */
        .progress-fill {
            transition: width 0.3s ease;
        }

        /* Buttons */
        .btn {
            font-size: 0.875rem;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        /* Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* Tab Content Visibility */
        .tab-content {
            display: block;
        }

        .tab-content.hidden {
            display: none !important;
        }

        /* Custom Range Slider */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
            width: 100%;
            height: 20px;
        }

        /* Slider Track */
        input[type="range"]::-webkit-slider-track {
            background: linear-gradient(to right,
                var(--slider-color, #3b82f6) 0%,
                var(--slider-color, #3b82f6) var(--progress, 0%),
                #e5e7eb var(--progress, 0%),
                #e5e7eb 100%);
            height: 8px;
            border-radius: 4px;
            border: 1px solid #d1d5db;
            transition: background 0.3s ease;
        }

        input[type="range"]::-moz-range-track {
            background: linear-gradient(to right,
                var(--slider-color, #3b82f6) 0%,
                var(--slider-color, #3b82f6) var(--progress, 0%),
                #e5e7eb var(--progress, 0%),
                #e5e7eb 100%);
            height: 8px;
            border-radius: 4px;
            border: 1px solid #d1d5db;
            transition: background 0.3s ease;
        }

        /* Slider Thumb */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            height: 20px;
            width: 20px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
            transition: all 0.15s ease;
            margin-top: -6px;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
        }

        input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(0.95);
        }

        input[type="range"]::-moz-range-thumb {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            height: 20px;
            width: 20px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
        }

        /* Progress fill for range input */
        input[type="range"]::-webkit-slider-runnable-track {
            background: linear-gradient(to right, #3b82f6 0%, #3b82f6 var(--value, 0%), #e5e7eb var(--value, 0%), #e5e7eb 100%);
        }

        /* Focus State */
        input[type="range"]:focus {
            outline: none;
        }

        input[type="range"]:focus::-webkit-slider-thumb {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3), 0 2px 4px rgba(59, 130, 246, 0.3);
        }

        input[type="range"]:focus::-moz-range-thumb {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3), 0 2px 4px rgba(59, 130, 246, 0.3);
        }

        /* File Drop Zone */
        .file-drop-zone {
            border: 2px dashed var(--border-color);
            transition: all 0.2s ease;
        }

        .file-drop-zone.dragover {
            border-color: var(--accent-blue);
            background: var(--accent-blue-light);
        }

        /* å¼€å…³æŒ‰é’®åŠ¨ç”» */
        .loading {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* æ¨¡æ¿é¢„è§ˆæ ·å¼ */
        .template-preview {
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            line-height: 1.4;
        }

        /* æ ‡ç­¾æ ·å¼ */
        .tag {
            transition: all 0.2s ease;
        }

        .tag:hover {
            transform: scale(1.05);
        }

        /* ä¸»é¢˜åˆ‡æ¢åŠ¨ç”» */
        .theme-transition {
            transition: all 0.3s ease;
        }

        /* æš—é»‘æ¨¡å¼æ ·å¼ */
        .dark-mode {
            background: linear-gradient(135deg, #1a1c2e 0%, #2d3561 100%);
        }

        .dark-mode .glass {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dark-mode .text-gray-800 { color: #e5e7eb; }
        .dark-mode .text-gray-600 { color: #9ca3af; }
        .dark-mode .text-gray-700 { color: #d1d5db; }
        .dark-mode .bg-white { background: rgba(0, 0, 0, 0.3); }
        .dark-mode .border-gray-200 { border-color: rgba(255, 255, 255, 0.1); }
        .dark-mode .file-drop-zone {
            border-color: rgba(230, 126, 34, 0.3);
        }
        .dark-mode .file-drop-zone.dragover {
            border-color: rgba(230, 126, 34, 0.8);
            background: rgba(230, 126, 34, 0.1);
        }

        /* æ ·é¢˜è¯•é˜…æ¨¡å—æ ·å¼ */
        .sample-exam-card {
            transition: all 0.3s ease;
        }

        .sample-exam-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(230, 126, 34, 0.15);
        }

        .dual-model-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .score-highlight {
            background: linear-gradient(135deg, #E67E22 0%, #D66545 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* äººå·¥å¤æ ¸æ¨¡å—æ ·å¼ */
        .kbd {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 0.75rem;
            font-family: monospace;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(230, 126, 34, 0.3);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(230, 126, 34, 0.5);
        }

        /* è¿›åº¦æ¡åŠ¨ç”» */
        .progress-bar {
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- æç®€é£æ ¼ä¸»ç•Œé¢å®¹å™¨ -->
    <div class="max-w-7xl mx-auto">

        <!-- 1. æç®€æ ‡é¢˜æ  -->
        <header class="bg-white border-b border-gray-200 px-6 py-4">
            <div class="max-w-7xl mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="brain-circuit" class="w-6 h-6 text-blue-600"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold text-gray-900">AIæ™ºèƒ½é˜…å·åŠ©æ‰‹</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="notification-btn" class="p-2 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="bell" class="w-5 h-5 text-gray-600"></i>
                    </button>
                    <button id="rubric-config-button" class="p-2 hover:bg-gray-100 rounded-lg" title="è¯„åˆ†æ ‡å‡†é…ç½®">
                        <i data-lucide="clipboard-list" class="w-5 h-5 text-gray-600"></i>
                    </button>
                    <button id="settings-button" class="p-2 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="settings" class="w-5 h-5 text-gray-600"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- çŠ¶æ€æ  -->
        <div class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3">
                <div class="flex items-center justify-between">
                    <!-- å›¾ç‰‡å®šä½çŠ¶æ€ -->
                    <div class="flex items-center space-x-2 flex-1 justify-center">
                        <div class="flex items-center space-x-1">
                            <span class="w-2 h-2 bg-green-500 rounded-full" title="çŠ¶æ€æ­£å¸¸"></span>
                            <i data-lucide="target" class="w-4 h-4 text-gray-600"></i>
                        </div>
                        <span class="text-sm text-gray-700">å›¾ç‰‡å®šä½</span>
                    </div>

                    <!-- åˆ†éš”çº¿ -->
                    <div class="w-px h-4 bg-gray-300"></div>

                    <!-- AIé“¾æ¥çŠ¶æ€ -->
                    <div class="flex items-center space-x-2 flex-1 justify-center">
                        <div class="flex items-center space-x-1">
                            <span class="w-2 h-2 bg-green-500 rounded-full" title="çŠ¶æ€æ­£å¸¸"></span>
                            <i data-lucide="link" class="w-4 h-4 text-gray-600"></i>
                        </div>
                        <span class="text-sm text-gray-700">AIé“¾æ¥</span>
                    </div>

                    <!-- åˆ†éš”çº¿ -->
                    <div class="w-px h-4 bg-gray-300"></div>

                    <!-- è¯„åˆ†è®¾ç½®çŠ¶æ€ -->
                    <div id="status-rubric-config" class="flex items-center space-x-2 flex-1 justify-center cursor-pointer hover:bg-gray-50 transition-colors py-1 px-2 rounded">
                        <div class="flex items-center space-x-1">
                            <span class="w-2 h-2 bg-green-500 rounded-full" title="çŠ¶æ€æ­£å¸¸"></span>
                            <i data-lucide="clipboard-list" class="w-4 h-4 text-gray-600"></i>
                        </div>
                        <span class="text-sm text-gray-700">è¯„åˆ†è®¾ç½®</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½åŒº -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6">
            <!-- Tab åˆ‡æ¢æŒ‰é’® -->
            <div class="relative">
                <div class="flex bg-gray-50 p-1 rounded-lg space-x-1">
                    <button data-tab="grading" class="tab-button active flex-1 text-center py-3 px-2 sm:px-4 rounded-md text-xs sm:text-sm font-medium transition-all flex items-center justify-center space-x-1 sm:space-x-2 bg-white text-blue-600 shadow-sm border border-blue-200">
                        <i data-lucide="sparkles" class="w-4 h-4"></i>
                        <span class="hidden sm:inline">æ™ºèƒ½é˜…å·</span>
                        <span class="sm:hidden">é˜…å·</span>
                    </button>
                    <button data-tab="review" class="tab-button flex-1 text-center py-3 px-2 sm:px-4 rounded-md text-xs sm:text-sm font-medium transition-all flex items-center justify-center space-x-1 sm:space-x-2 text-gray-700 hover:bg-white hover:border-gray-200 border border-transparent">
                        <i data-lucide="user-check" class="w-4 h-4"></i>
                        <span class="hidden sm:inline">äººå·¥å¤æ ¸</span>
                        <span class="sm:hidden">å¤æ ¸</span>
                    </button>
                    <button data-tab="analysis" class="tab-button flex-1 text-center py-3 px-2 sm:px-4 rounded-md text-xs sm:text-sm font-medium transition-all flex items-center justify-center space-x-1 sm:space-x-2 text-gray-700 hover:bg-white hover:border-gray-200 border border-transparent">
                        <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
                        <span>æ•°æ®åˆ†æ</span>
                    </button>
                </div>
            </div>

            <!-- Tab å†…å®¹åŒºåŸŸ -->
            <main class="mt-6 min-h-[400px]">
                <!-- æ™ºèƒ½é˜…å·æ¨¡å— (é»˜è®¤æ˜¾ç¤º) - ç›´æ¥è¿›å…¥æ­£å¼é˜…å· -->
                <div id="tab-content-grading" class="tab-content scale-in space-y-4">
                    <!-- æ­£å¼é˜…å·é˜¶æ®µ (ç›´æ¥æ˜¾ç¤º) -->
                    <div id="gradingPhase" class="grading-phase">

                    </div>

                    <!-- å®æ—¶ç»Ÿè®¡ -->
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <div class="flex items-center space-x-2 mb-3">
                            <i data-lucide="target" class="w-5 h-5 text-gray-800"></i>
                            <h3 class="text-base font-semibold text-gray-800">å®æ—¶ç»Ÿè®¡</h3>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            <div class="text-center py-2">
                                <div class="text-xl font-bold text-gray-800">156</div>
                                <div class="text-xs text-gray-500">ä»Šæ—¥å·²é˜…</div>
                            </div>
                            <div class="text-center py-2">
                                <div class="text-xl font-bold text-gray-800">32ç§’</div>
                                <div class="text-xs text-gray-500">å¹³å‡ç”¨æ—¶</div>
                            </div>
                            <div class="text-center py-2">
                                <div class="text-xl font-bold text-gray-800">98%</div>
                                <div class="text-xs text-gray-500">å‡†ç¡®ç‡</div>
                            </div>
                            <div class="text-center py-2">
                                <div class="text-xl font-bold text-gray-800">92%</div>
                                <div class="text-xs text-gray-500">ç½®ä¿¡åº¦</div>
                            </div>
                        </div>
                    </div>

                    <!-- é˜…å·æ“ä½œ -->
                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center space-x-2 mb-3">
                            <i data-lucide="radio-button" class="w-5 h-5 text-gray-800"></i>
                            <h3 class="text-base font-semibold text-gray-800">é˜…å·æ“ä½œ</h3>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                            <button id="aiTrialBtn" class="bg-blue-500 hover:bg-blue-600 text-white py-2.5 px-4 rounded-lg font-medium transition-colors flex items-center justify-center space-x-1">
                                <i data-lucide="search" class="w-4 h-4"></i>
                                <span class="text-sm">AIè¯•é˜…</span>
                            </button>
                            <button id="aiAutoBtn" class="bg-blue-500 hover:bg-blue-600 text-white py-2.5 px-4 rounded-lg font-medium transition-colors flex items-center justify-center space-x-1">
                                <i data-lucide="zap" class="w-4 h-4"></i>
                                <span class="text-sm">AIè‡ªåŠ¨</span>
                            </button>
                            <button id="pauseBtn" class="bg-white border border-gray-300 text-gray-700 py-2.5 px-4 rounded-lg font-medium hover:bg-gray-50 transition-colors flex items-center justify-center space-x-1">
                                <i data-lucide="pause" class="w-4 h-4"></i>
                                <span class="text-sm">æš‚åœ</span>
                            </button>
                        </div>
                    </div>

                    <!-- è¯„åˆ†ç»“æœ -->
                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center space-x-2 mb-3">
                            <i data-lucide="check-circle" class="w-5 h-5 text-gray-800"></i>
                            <h3 class="text-base font-semibold text-gray-800">è¯„åˆ†ç»“æœ</h3>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-lg">
                            <div class="flex items-center justify-between pb-2 border-b border-blue-100">
                                <span class="text-sm text-blue-700">å­¦ç”Ÿï¼šå¼ ä¸‰</span>
                                <span class="text-xs text-blue-600">ç­”é¢˜æ—¶é—´ï¼š14:30</span>
                            </div>
                            <div class="text-center py-3">
                                <div class="text-3xl font-bold text-blue-800" id="total-score">85<span class="text-xl text-blue-600">/100</span></div>
                                <div class="text-xs text-blue-600 mt-1">æ€»åˆ†</div>
                            </div>

                            <!-- åˆ†é¡¹å¾—åˆ† -->
                            <div class="space-y-2 mt-3" id="dimension-scores">
                                <!-- åŠ¨æ€åŠ è½½è¯„åˆ†ç»†åˆ™çš„åˆ†é¡¹å¾—åˆ† -->
                            </div>
                        </div>

                        <!-- è¯„åˆ†ç†ç”± -->
                        <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                            <h4 class="text-sm font-medium text-gray-700 mb-2">ğŸ’¡ è¯„åˆ†ç†ç”±</h4>
                            <div id="scoring-reasons" class="text-sm text-gray-600 space-y-2">
                                <div class="flex items-start space-x-2">
                                    <span class="font-medium text-blue-600 min-w-[80px]">è§‚ç‚¹æ˜ç¡®:</span>
                                    <span>è®ºç‚¹æ¸…æ™°ï¼Œç«‹åœºæ˜ç¡®ï¼Œèƒ½å¤Ÿå‡†ç¡®æŠŠæ¡é¢˜ç›®è¦æ±‚</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="font-medium text-green-600 min-w-[80px]">å²å®å‡†ç¡®:</span>
                                    <span>å†å²äº‹å®å‡†ç¡®æ— è¯¯ï¼Œå¼•ç”¨ææ–™æ°å½“</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="font-medium text-purple-600 min-w-[80px]">è®ºè¿°å……åˆ†:</span>
                                    <span>è®ºæ®å……å®ï¼Œé€»è¾‘ä¸¥å¯†ï¼Œè®ºè¯æœ‰åŠ›</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="font-medium text-orange-600 min-w-[80px]">è¯­è¨€è¡¨è¾¾:</span>
                                    <span>è¡¨è¾¾æµç•…ï¼Œä¹¦å†™è§„èŒƒï¼Œæ¡ç†æ¸…æ™°</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è¯„åˆ†è®°å½•æŸ¥çœ‹ -->
                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-center mb-3">
                            <div class="flex items-center space-x-2">
                                <i data-lucide="clipboard-list" class="w-5 h-5 text-gray-800"></i>
                                <h3 class="text-base font-semibold text-gray-800">è¯„åˆ†è®°å½•</h3>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="refreshRecordsBtn" class="text-xs text-blue-600 hover:text-blue-700 flex items-center">
                                    <i data-lucide="refresh-ccw" class="w-3 h-3 mr-1"></i>
                                    åˆ·æ–°
                                </button>
                                <button id="exportRecordsBtn" class="text-xs text-blue-600 hover:text-blue-700 flex items-center">
                                    <i data-lucide="download" class="w-3 h-3 mr-1"></i>
                                    å¯¼å‡º
                                </button>
                            </div>
                        </div>

                        <!-- è®°å½•åˆ—è¡¨ -->
                        <div class="max-h-96 overflow-y-auto custom-scrollbar">
                            <div class="space-y-2" id="reviewRecordsList">
                                <!-- åŠ¨æ€åŠ è½½è®°å½•åˆ—è¡¨ -->
                                <div class="text-center py-8 text-gray-500 text-sm">
                                    æ­£åœ¨åŠ è½½è¯„åˆ†è®°å½•...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- äººå·¥å¤æ ¸æ¨¡å— (é»˜è®¤éšè—) - è¿›åº¦æ¦‚è§ˆè®¾è®¡ -->
                <div id="tab-content-review" class="tab-content hidden space-y-4">
                    <!-- å¤æ ¸ä¸»ä½“å†…å®¹ -->
                    <div class="space-y-4">
                        <!-- å¤æ ¸è¯•å·è¿›åº¦ - åˆå¹¶å¡ç‰‡è®¾è®¡ -->
                        <div class="bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-2">
                                    <i data-lucide="bar-chart-3" class="w-5 h-5 text-gray-800"></i>
                                    <h3 class="text-base font-semibold text-gray-800">å¤æ ¸è¿›åº¦</h3>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-blue-600" id="reviewProgressText">0/15</div>
                                </div>
                            </div>

                            <!-- ä¸»è¦è¿›åº¦æ¡ -->
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="text-gray-600">æ€»ä½“è¿›åº¦</span>
                                    <span class="text-blue-600 font-medium" id="reviewProgressPercentage">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-4 rounded-full transition-all duration-700 ease-out flex items-center justify-end pr-2" style="width: 0%" id="reviewProgressBar">
                                        <i data-lucide="check" class="w-3 h-3 text-white"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- å¤æ ¸çŠ¶æ€ä¿¡æ¯ -->
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div class="bg-green-50 rounded-lg p-3 text-center">
                                    <div class="text-xs text-green-600 mb-1">å½“å‰å¾—åˆ†</div>
                                    <div class="text-lg font-bold text-green-700" id="current-score">0åˆ†</div>
                                </div>
                                <div class="bg-blue-50 rounded-lg p-3 text-center">
                                    <div class="text-xs text-blue-600 mb-1">AIå»ºè®®</div>
                                    <div class="text-lg font-bold text-blue-700" id="ai-suggestion">0åˆ†</div>
                                </div>
                            </div>

                            <!-- å¯¼èˆªä¸æ‰“åˆ†åŒºåŸŸ -->
                            <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                                <!-- ç§»åŠ¨ç«¯ï¼šå‚ç›´å¸ƒå±€ -->
                                <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-3 space-y-2 sm:space-y-0">
                                    <!-- ä¸Šä¸€ä»½æŒ‰é’® -->
                                    <button id="prev-question" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-3 rounded-lg font-medium transition-all flex items-center justify-center space-x-1 w-full sm:w-auto">
                                        <i data-lucide="chevron-left" class="w-4 h-4"></i>
                                        <span class="text-sm">ä¸Šä¸€ä»½</span>
                                    </button>

                                    <!-- æ‰“åˆ†æ¡† -->
                                    <div class="flex-1 flex items-center justify-center order-first sm:order-none">
                                        <div class="bg-white border-2 border-gray-300 rounded-lg px-4 py-3 flex items-center space-x-3 shadow-sm w-full sm:w-auto">
                                            <label class="text-sm font-medium text-gray-700">å¾—åˆ†ï¼š</label>
                                            <input type="number" id="score-input" class="w-20 text-xl font-bold text-center border-none focus:ring-0 focus:outline-none" value="0" min="0" max="100">
                                            <span class="text-sm text-gray-500">/ 100</span>
                                        </div>
                                    </div>

                                    <!-- ä¸‹ä¸€ä»½æŒ‰é’® -->
                                    <button id="next-question" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-3 rounded-lg font-medium transition-all flex items-center justify-center space-x-1 w-full sm:w-auto">
                                        <span class="text-sm">ä¸‹ä¸€ä»½</span>
                                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- å¤æ ¸æ“ä½œæŒ‰é’® -->
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <button id="skip-review" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-medium transition-all flex items-center justify-center space-x-2">
                                    <i data-lucide="skip-forward" class="w-4 h-4"></i>
                                    <span>è·³è¿‡å¤æ ¸</span>
                                </button>
                                <button id="save-review" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg font-medium transition-all flex items-center justify-center space-x-2">
                                    <i data-lucide="save" class="w-4 h-4"></i>
                                    <span>ä¿å­˜è®°å½•</span>
                                </button>
                            </div>

                            <!-- æ“ä½œåŒº -->
                            <div class="flex items-center justify-between pt-3 border-t border-gray-100">
                                <div class="flex items-center space-x-2">
                                    <span id="review-count" class="text-xs text-gray-500">0æ¬¡</span>
                                </div>
                                <button id="refresh-question" class="text-xs text-blue-600 hover:text-blue-700 flex items-center">
                                    <i data-lucide="refresh-ccw" class="w-3 h-3 mr-1"></i>
                                    åˆ·æ–°
                                </button>
                            </div>
                        </div>

                        <!-- å¤æ ¸è®°å½• - æœ¬åœ°å­˜å‚¨ -->
                        <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center space-x-2">
                                    <i data-lucide="clipboard-list" class="w-5 h-5 text-gray-800"></i>
                                    <h3 class="text-base font-semibold text-gray-800">å¤æ ¸è®°å½•</h3>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span id="review-count" class="text-xs text-gray-500">0æ¬¡</span>
                                    <button id="export-review" class="text-xs text-blue-600 hover:text-blue-700 flex items-center">
                                        <i data-lucide="download" class="w-3 h-3 mr-1"></i>
                                        å¯¼å‡º
                                    </button>
                                </div>
                            </div>
                            <ul id="review-list" class="space-y-2">
                                <li class="text-sm text-gray-500 text-center py-4">æš‚æ— å¤æ ¸è®°å½•</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- åˆ†æ•°è°ƒæ•´æ¨¡æ€æ¡† -->
                <div id="scoreAdjustmentModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen p-4">
                        <div class="bg-white rounded-2xl p-6 w-full max-w-2xl transform transition-all scale-95 opacity-0" id="scoreModalContent">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-bold text-gray-800">è°ƒæ•´åˆ†é¡¹å¾—åˆ†</h3>
                                <button id="closeScoreModalBtn" class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <i data-lucide="x" class="w-6 h-6"></i>
                                </button>
                            </div>
                            <div id="scoreAdjustmentList" class="space-y-4 mb-6 max-h-80 overflow-y-auto custom-scrollbar">
                                <!-- åˆ†é¡¹å¾—åˆ†è°ƒæ•´é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">ä¿®æ”¹ç†ç”±</label>
                                <textarea id="scoreModifyReason" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" rows="3" placeholder="è¯·è¯´æ˜ä¿®æ”¹åˆ†æ•°çš„ç†ç”±..."></textarea>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700 font-medium">æ€»åˆ†:</span>
                                    <span class="text-2xl font-bold text-orange-600" id="adjustedTotalScore">0</span>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3">
                                <button id="cancelScoreAdjustBtn" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-colors">å–æ¶ˆ</button>
                                <button id="confirmScoreAdjustBtn" class="px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors">ç¡®è®¤ä¿®æ”¹</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç¡®è®¤å¯¹è¯æ¡† -->
                <div id="reviewConfirmDialog" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen p-4">
                        <div class="bg-white rounded-2xl p-6 w-full max-w-md transform transition-all scale-95 opacity-0" id="confirmDialogContent">
                            <div class="flex items-start space-x-4">
                                <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <i data-lucide="alert-triangle" class="w-6 h-6 text-orange-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold text-gray-800 mb-2" id="confirmDialogTitle">ç¡®è®¤æ“ä½œ</h3>
                                    <p class="text-sm text-gray-600 mb-4" id="confirmDialogMessage">æ‚¨ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</p>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3 mt-6">
                                <button id="cancelConfirmBtn" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-colors">å–æ¶ˆ</button>
                                <button id="okConfirmBtn" class="px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors">ç¡®è®¤</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ•°æ®åˆ†æ (é»˜è®¤éšè—) -->
                <div id="tab-content-analysis" class="tab-content hidden space-y-4">

                    <!-- è¯„é˜…æ•°æ®åˆ†æ -->
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <div class="flex items-center space-x-2 mb-3">
                            <i data-lucide="clipboard-list" class="w-5 h-5 text-gray-800"></i>
                            <h3 class="text-base font-semibold text-gray-800">è¯„é˜…æ•°æ®</h3>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                            <!-- è¯„é˜…ä»½æ•° -->
                            <div class="text-center py-3 border border-gray-200 rounded">
                                <i data-lucide="file-text" class="w-5 h-5 text-blue-600 mx-auto mb-1"></i>
                                <div class="text-2xl font-bold text-gray-800" id="totalPapers">892</div>
                                <div class="text-xs text-gray-500">è¯„é˜…ä»½æ•°</div>
                                <div class="text-xs text-gray-400 mt-1">ä»Šæ—¥æ–°å¢: <span id="todayPapers">23</span> ä»½</div>
                            </div>

                            <!-- å¹³å‡åˆ† -->
                            <div class="text-center py-3 border border-gray-200 rounded">
                                <i data-lucide="trending-up" class="w-5 h-5 text-green-600 mx-auto mb-1"></i>
                                <div class="text-2xl font-bold text-gray-800" id="averageScore">85.6</div>
                                <div class="text-xs text-gray-500">å¹³å‡åˆ†</div>
                                <div class="text-xs text-gray-400 mt-1">æ»¡åˆ†: 100åˆ†</div>
                            </div>

                            <!-- å¾—åˆ†ç‡ -->
                            <div class="text-center py-3 border border-gray-200 rounded">
                                <i data-lucide="percent" class="w-5 h-5 text-purple-600 mx-auto mb-1"></i>
                                <div class="text-2xl font-bold text-gray-800" id="scoreRate">85.6%</div>
                                <div class="text-xs text-gray-500">å¾—åˆ†ç‡</div>
                                <div class="text-xs text-gray-400 mt-1">åŠæ ¼ç‡: <span id="passRate">90.2%</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- åˆ†æ•°åˆ†å¸ƒå›¾è¡¨ -->
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <div class="flex justify-between items-center mb-3">
                            <div class="flex items-center space-x-2">
                                <i data-lucide="trending-up" class="w-5 h-5 text-gray-800"></i>
                                <h3 class="text-base font-semibold text-gray-800 mb-0">åˆ†å¸ƒå›¾è¡¨</h3>
                            </div>
                            <select id="chartTypeSelect" class="text-sm border border-gray-300 rounded px-2 py-1">
                                <option value="bar">æŸ±çŠ¶å›¾</option>
                                <option value="line">æŠ˜çº¿å›¾</option>
                                <option value="pie">é¥¼å›¾</option>
                            </select>
                        </div>
                        <div class="h-64">
                            <canvas id="scoreDistributionChart"></canvas>
                        </div>
                    </div>

                    <!-- è¯¦ç»†ç»Ÿè®¡ -->
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <div class="flex items-center space-x-2 mb-3">
                            <i data-lucide="bar-chart-3" class="w-5 h-5 text-gray-800"></i>
                            <h3 class="text-base font-semibold text-gray-800">è¯¦ç»†ç»Ÿè®¡</h3>
                        </div>
                        <div class="space-y-2" id="detailedStats">
                            <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                <span class="text-sm text-gray-700">æœ€é«˜åˆ†</span>
                                <span class="font-medium text-gray-900 text-sm" id="maxScore">98åˆ†</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                <span class="text-sm text-gray-700">æœ€ä½åˆ†</span>
                                <span class="font-medium text-gray-900 text-sm" id="minScore">62åˆ†</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                <span class="text-sm text-gray-700">ä¸­ä½æ•°</span>
                                <span class="font-medium text-gray-900 text-sm" id="medianScore">87åˆ†</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                <span class="text-sm text-gray-700">æ ‡å‡†å·®</span>
                                <span class="font-medium text-gray-900 text-sm" id="stdDev">8.3</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                <span class="text-sm text-gray-700">ä¼˜ç§€ç‡</span>
                                <span class="font-medium text-gray-900 text-sm" id="excellentRate">42.5%</span>
                            </div>
                            <div class="flex justify-between items-center py-2">
                                <span class="text-sm text-gray-700">åŠæ ¼ç‡</span>
                                <span class="font-medium text-gray-900 text-sm" id="passRateDetail">95.3%</span>
                            </div>
                        </div>
                    </div>

                    <!-- å¯¼å‡ºåŠŸèƒ½ -->
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <div class="flex items-center space-x-2 mb-3">
                            <i data-lucide="database" class="w-5 h-5 text-gray-800"></i>
                            <h3 class="text-base font-semibold text-gray-800">å¯¼å‡ºæ•°æ®</h3>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                            <!-- å¯¼å‡ºJSON -->
                            <button id="exportJsonBtn" class="bg-blue-500 hover:bg-blue-600 text-white rounded-lg py-3 px-4 transition-colors flex flex-col items-center space-y-1">
                                <i data-lucide="file-json" class="w-6 h-6"></i>
                                <div class="text-center">
                                    <div class="font-medium text-sm">å¯¼å‡ºJSON</div>
                                </div>
                            </button>

                            <!-- å¯¼å‡ºCSV -->
                            <button id="exportCsvBtn" class="bg-green-500 hover:bg-green-600 text-white rounded-lg py-3 px-4 transition-colors flex flex-col items-center space-y-1">
                                <i data-lucide="file-spreadsheet" class="w-6 h-6"></i>
                                <div class="text-center">
                                    <div class="font-medium text-sm">å¯¼å‡ºCSV</div>
                                </div>
                            </button>

                            <!-- ç”ŸæˆPDF -->
                            <button id="exportPdfBtn" class="bg-red-500 hover:bg-red-600 text-white rounded-lg py-3 px-4 transition-colors flex flex-col items-center space-y-1">
                                <i data-lucide="file-text" class="w-6 h-6"></i>
                                <div class="text-center">
                                    <div class="font-medium text-sm">ç”ŸæˆPDF</div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- å¯¼å…¥è¯„åˆ†ç»†åˆ™ Modal -->
    <div id="import-modal" class="fixed inset-0 w-full h-full flex items-center justify-center z-50 hidden">
        <div class="modal-backdrop absolute inset-0 bg-black/50 backdrop-blur-sm opacity-0"></div>
        <div class="modal-content bg-white rounded-2xl shadow-lg w-full max-w-sm z-10 mx-4 transform scale-95 opacity-0">
            <div class="bg-gradient-to-r bg-[#E67E22] text-white p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <i data-lucide="upload" class="w-6 h-6"></i>
                        <h2 class="text-lg font-semibold tracking-tight">å¯¼å…¥è¯„åˆ†ç»†åˆ™</h2>
                    </div>
                    <button id="import-close-btn" class="text-white/80 hover:text-white transition-colors">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <div class="p-6 space-y-4">
                <!-- æ–‡ä»¶æ‹–æ‹½åŒºåŸŸ -->
                <div id="drop-zone" class="file-drop-zone rounded-xl p-8 text-center cursor-pointer">
                    <i data-lucide="cloud-upload" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                    <p class="text-lg font-medium text-gray-700 mb-2">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>
                    <p class="text-sm text-gray-500 mb-4">æˆ–è€…ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                    <input type="file" id="file-input" class="hidden" accept=".txt,.json,.md">
                    <button class="bg-green-100 text-green-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-green-200 transition-colors">
                        é€‰æ‹©æ–‡ä»¶
                    </button>
                </div>

                <!-- æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h4 class="text-sm font-medium text-gray-700 mb-2">æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼š</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-xs">
                        <div class="flex items-center space-x-1">
                            <i data-lucide="file-text" class="w-3 h-3 text-blue-500"></i>
                            <span class="text-gray-600">.txt æ–‡æœ¬æ–‡ä»¶</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i data-lucide="file-json" class="w-3 h-3 text-green-500"></i>
                            <span class="text-gray-600">.json JSONæ ¼å¼</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i data-lucide="file-code" class="w-3 h-3 text-purple-500"></i>
                            <span class="text-gray-600">.md Markdown</span>
                        </div>
                    </div>
                </div>

            </div>

            <div class="bg-gray-50 p-6 rounded-b-2xl flex justify-end space-x-3">
                <button id="import-cancel-btn" class="py-2 px-6 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">
                    å–æ¶ˆ
                </button>
                <button id="import-confirm-btn" class="py-2 px-6 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors" disabled>
                    å¯¼å…¥
                </button>
            </div>
        </div>
    </div>

    <!-- ä¿å­˜è¯„åˆ†ç»†åˆ™ Modal -->
    <div id="save-modal" class="fixed inset-0 w-full h-full flex items-center justify-center z-50 hidden">
        <div class="modal-backdrop absolute inset-0 bg-black/50 backdrop-blur-sm opacity-0"></div>
        <div class="modal-content bg-white rounded-2xl shadow-lg w-full max-w-sm z-10 mx-4 transform scale-95 opacity-0">
            <div class="bg-gradient-to-r bg-[#E67E22] text-white p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <i data-lucide="download" class="w-6 h-6"></i>
                        <h2 class="text-lg font-semibold tracking-tight">ä¿å­˜è¯„åˆ†ç»†åˆ™</h2>
                    </div>
                    <button id="save-close-btn" class="text-white/80 hover:text-white transition-colors">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <div class="p-6 space-y-4">
                <!-- æ–‡ä»¶åè¾“å…¥ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ–‡ä»¶å</label>
                    <input type="text" id="filename-input" class="w-full p-3 border border-gray-300 rounded-lg text-sm" placeholder="è¯·è¾“å…¥æ–‡ä»¶å" value="è¯„åˆ†ç»†åˆ™_å†å²è®ºè¿°é¢˜">
                </div>

                <!-- æ–‡ä»¶æ ¼å¼é€‰æ‹© -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ä¿å­˜æ ¼å¼</label>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <label class="cursor-pointer">
                            <input type="radio" name="save-format" value="txt" checked class="sr-only">
                            <div class="format-option border-2 border-gray-200 rounded-lg p-3 text-center hover:border-blue-500 transition-colors">
                                <i data-lucide="file-text" class="w-6 h-6 text-blue-500 mx-auto mb-1"></i>
                                <span class="text-sm font-medium">TXT</span>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="save-format" value="json" class="sr-only">
                            <div class="format-option border-2 border-gray-200 rounded-lg p-3 text-center hover:border-blue-500 transition-colors">
                                <i data-lucide="file-json" class="w-6 h-6 text-green-500 mx-auto mb-1"></i>
                                <span class="text-sm font-medium">JSON</span>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="save-format" value="md" class="sr-only">
                            <div class="format-option border-2 border-gray-200 rounded-lg p-3 text-center hover:border-blue-500 transition-colors">
                                <i data-lucide="file-code" class="w-6 h-6 text-purple-500 mx-auto mb-1"></i>
                                <span class="text-sm font-medium">MD</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- å†…å®¹é¢„è§ˆ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">å†…å®¹é¢„è§ˆ</label>
                    <div class="template-preview bg-gray-50 rounded-lg p-3 border border-gray-200 custom-scrollbar">
                        <pre id="content-preview" class="text-xs text-gray-700 whitespace-pre-wrap"></pre>
                    </div>
                </div>

                <!-- ä¿å­˜é€‰é¡¹ -->
                <div class="space-y-2">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" id="include-timestamp" checked class="w-4 h-4 text-blue-600">
                        <span class="text-sm text-gray-700">åŒ…å«æ—¶é—´æˆ³</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" id="include-metadata" checked class="w-4 h-4 text-blue-600">
                        <span class="text-sm text-gray-700">åŒ…å«å…ƒæ•°æ®</span>
                    </label>
                </div>
            </div>

            <div class="bg-gray-50 p-6 rounded-b-2xl flex justify-end space-x-3">
                <button id="save-cancel-btn" class="py-2 px-6 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">
                    å–æ¶ˆ
                </button>
                <button id="save-confirm-btn" class="py-2 px-6 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors">
                    ä¿å­˜
                </button>
            </div>
        </div>
    </div>

    <!-- è¯„åˆ†æ ‡å‡†é…ç½® Modal -->
    <div id="rubric-config-modal" class="fixed inset-0 w-full h-full flex items-center justify-center z-50 hidden">
        <div class="modal-backdrop absolute inset-0 bg-black/50 backdrop-blur-sm opacity-0"></div>
        <div class="modal-content bg-white rounded-xl shadow-xl w-full max-w-6xl z-10 mx-4 transform scale-95 opacity-0 border border-gray-200 overflow-hidden" style="max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
            <div class="bg-white border-b border-gray-200 p-6 flex-shrink-0">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="clipboard-list" class="w-6 h-6 text-blue-600"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-semibold text-gray-900">è¯„åˆ†æ ‡å‡†é…ç½®</h2>
                            <p class="text-sm text-gray-500">å†å²å­¦ç§‘è®ºè¿°é¢˜ - çµæ´»é…ç½®è¯„åˆ†ç»´åº¦</p>
                        </div>
                    </div>
                    <button id="rubric-config-close-btn" class="text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <div class="flex-1 overflow-hidden flex">
                <!-- å·¦ä¾§ï¼šè¯„åˆ†ç»´åº¦é…ç½® -->
                <div class="flex-1 p-6 overflow-y-auto custom-scrollbar" style="flex: 2;">
                    <div class="space-y-4">
                        <!-- æ“ä½œæ  -->
                        <div class="flex justify-between items-center">
                            <div class="flex space-x-2">
                                <button id="ai-recommend-btn" class="py-2 px-4 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-colors flex items-center space-x-2">
                                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                                    <span>AIæ™ºèƒ½æ¨è</span>
                                </button>
                                <button id="reset-template-btn" class="py-2 px-4 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors flex items-center space-x-2">
                                    <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                                    <span>é‡ç½®æ¨¡æ¿</span>
                                </button>
                            </div>
                            <button id="add-dimension-btn" class="py-2 px-4 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors flex items-center space-x-2">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span>æ·»åŠ ç»´åº¦</span>
                            </button>
                        </div>

                        <!-- å‚è€ƒç­”æ¡ˆè¾“å…¥åŒº -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-start space-x-3">
                                <i data-lucide="file-text" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                                <div class="flex-1">
                                    <h4 class="text-sm font-medium text-blue-900">å‚è€ƒç­”æ¡ˆï¼ˆå¯é€‰ï¼‰</h4>
                                    <p class="text-xs text-blue-700 mt-1">è¾“å…¥å‚è€ƒç­”æ¡ˆï¼ŒAIå°†è‡ªåŠ¨åˆ†æå¹¶æ¨èè¯„åˆ†æ ‡å‡†</p>
                                    <textarea id="reference-answer" class="w-full mt-3 p-3 border border-blue-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="4" placeholder="è¯·è¾“å…¥å‚è€ƒç­”æ¡ˆ..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- è¯„åˆ†ç»´åº¦åˆ—è¡¨ -->
                        <div id="dimensions-list" class="space-y-3">
                            <!-- ç»´åº¦å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- æ€»åˆ†ç»Ÿè®¡ -->
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-700">æ€»åˆ†åˆ†é…</span>
                                <span id="total-score-display" class="text-2xl font-bold text-blue-600">100</span>
                            </div>
                            <div class="mt-3">
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div id="total-score-progress" class="bg-blue-500 h-3 rounded-full transition-all duration-300" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šå¯è§†åŒ–é¢„è§ˆ -->
                <div class="w-80 bg-gray-50 border-l border-gray-200 p-6 overflow-y-auto custom-scrollbar flex-shrink-0">
                    <h3 class="text-sm font-semibold text-gray-900 mb-4 flex items-center">
                        <i data-lucide="pie-chart" class="w-4 h-4 mr-2"></i>
                        åˆ†å€¼åˆ†å¸ƒé¢„è§ˆ
                    </h3>

                    <!-- é¥¼å›¾å®¹å™¨ -->
                    <div class="bg-white rounded-lg p-4 mb-4">
                        <canvas id="score-distribution-chart" width="300" height="300"></canvas>
                    </div>

                    <!-- ç»´åº¦ç»Ÿè®¡åˆ—è¡¨ -->
                    <div id="dimension-stats" class="space-y-2">
                        <!-- ç»Ÿè®¡åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <!-- æ¨¡æ¿åº“ -->
                    <div class="mt-6">
                        <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                            <i data-lucide="library" class="w-4 h-4 mr-2"></i>
                            å¸¸ç”¨æ¨¡æ¿
                        </h3>
                        <div class="space-y-2">
                            <button class="template-btn w-full p-3 bg-white border border-gray-200 rounded-lg text-left hover:border-blue-300 hover:bg-blue-50 transition-colors" data-template="standard">
                                <div class="font-medium text-sm text-gray-900">æ ‡å‡†è®ºè¿°é¢˜</div>
                                <div class="text-xs text-gray-500 mt-1">è§‚ç‚¹30åˆ†+å²å®30åˆ†+è®ºè¿°25åˆ†+è¡¨è¾¾15åˆ†</div>
                            </button>
                            <button class="template-btn w-full p-3 bg-white border border-gray-200 rounded-lg text-left hover:border-blue-300 hover:bg-blue-50 transition-colors" data-template="analysis">
                                <div class="font-medium text-sm text-gray-900">åˆ†æè®ºè¿°é¢˜</div>
                                <div class="text-xs text-gray-500 mt-1">è§‚ç‚¹25åˆ†+å²å®25åˆ†+åˆ†æ35åˆ†+è¡¨è¾¾15åˆ†</div>
                            </button>
                            <button class="template-btn w-full p-3 bg-white border border-gray-200 rounded-lg text-left hover:border-blue-300 hover:bg-blue-50 transition-colors" data-template="comparison">
                                <div class="font-medium text-sm text-gray-900">å¯¹æ¯”è®ºè¿°é¢˜</div>
                                <div class="text-xs text-gray-500 mt-1">è§‚ç‚¹30åˆ†+å²å®30åˆ†+å¯¹æ¯”25åˆ†+è¡¨è¾¾15åˆ†</div>
                            </button>
                        </div>
                    </div>

                    <!-- AIæ¨èå»ºè®® -->
                    <div id="ai-suggestions" class="mt-6 hidden">
                        <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                            <i data-lucide="lightbulb" class="w-4 h-4 mr-2"></i>
                            AIå»ºè®®
                        </h3>
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                            <div id="ai-suggestions-content" class="text-sm text-purple-700">
                                <!-- AIå»ºè®®å†…å®¹ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-gray-50 p-6 flex justify-end space-x-3 border-t flex-shrink-0">
                <button id="rubric-config-cancel-btn" class="py-2.5 px-6 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
                    å–æ¶ˆ
                </button>
                <button id="rubric-config-save-btn" class="py-2.5 px-6 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors shadow-sm flex items-center space-x-2">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    <span>ä¿å­˜è¯„åˆ†æ ‡å‡†</span>
                </button>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®åŠŸèƒ½ Modal -->
    <div id="settings-modal" class="fixed inset-0 w-full h-full flex items-center justify-center z-50 hidden">
        <div class="modal-backdrop absolute inset-0 bg-black/50 backdrop-blur-sm opacity-0"></div>
        <div class="modal-content bg-white rounded-xl shadow-xl w-full max-w-4xl z-10 mx-4 transform scale-95 opacity-0 border border-gray-200 overflow-hidden">
            <div class="bg-white border-b border-gray-200 p-6">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="settings" class="w-6 h-6 text-blue-600"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-semibold text-gray-900">åŠŸèƒ½è®¾ç½®</h2>
                            <p class="text-sm text-gray-500">é…ç½®AIé˜…å·åŠ©æ‰‹çš„å„é¡¹å‚æ•°</p>
                        </div>
                    </div>
                    <button id="settings-close-btn" class="text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <div class="p-6 space-y-6 max-h-[75vh] overflow-y-auto custom-scrollbar">
                <!-- è®¾ç½®å¯¼èˆªæ ‡ç­¾ -->
                <div class="flex space-x-2 bg-gray-100 p-1.5 rounded-xl border border-gray-200">
                    <button data-settings-tab="api" class="settings-tab-btn flex-1 py-3 px-4 text-sm font-medium rounded-lg transition-all bg-white text-blue-600 shadow-sm border border-blue-200 flex items-center justify-center space-x-2">
                        <i data-lucide="key" class="w-4 h-4"></i>
                        <span>APIå¯†é’¥</span>
                    </button>
                    <button data-settings-tab="model" class="settings-tab-btn flex-1 py-3 px-4 text-sm font-medium rounded-lg transition-all text-gray-700 hover:bg-white hover:border-gray-200 border border-transparent flex items-center justify-center space-x-2">
                        <i data-lucide="brain" class="w-4 h-4"></i>
                        <span>æ¨¡å‹è®¾ç½®</span>
                    </button>
                    <button data-settings-tab="strategy" class="settings-tab-btn flex-1 py-3 px-4 text-sm font-medium rounded-lg transition-all text-gray-700 hover:bg-white hover:border-gray-200 border border-transparent flex items-center justify-center space-x-2">
                        <i data-lucide="cpu" class="w-4 h-4"></i>
                        <span>é˜…å·ç­–ç•¥</span>
                    </button>
                    <button data-settings-tab="advanced" class="settings-tab-btn flex-1 py-3 px-4 text-sm font-medium rounded-lg transition-all text-gray-700 hover:bg-white hover:border-gray-200 border border-transparent flex items-center justify-center space-x-2">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                        <span>é«˜çº§è®¾ç½®</span>
                    </button>
                </div>

                <!-- API å¯†é’¥ç®¡ç† -->
                <section id="settings-api" class="settings-tab-content space-y-4">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                        <div class="flex items-start space-x-3">
                            <i data-lucide="info" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                            <div>
                                <h4 class="text-base font-medium text-blue-900">å®‰å…¨æç¤º</h4>
                                <p class="text-sm text-blue-700 mt-1">æ‚¨çš„APIå¯†é’¥å°†å®‰å…¨å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ï¼Œä¸ä¼šè¢«ä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚</p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- OpenAI Section -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-base font-semibold text-gray-900 flex items-center space-x-2">
                                    <span class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="zap" class="w-5 h-5 text-green-600"></i>
                                    </span>
                                    <span>OpenAI (GPT-4o)</span>
                                </h4>
                                <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">æ¨è</span>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ç«¯ç‚¹ (Endpoint)</label>
                                    <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="https://api.openai.com/v1">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">æ¨¡å‹ (Model)</label>
                                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                                        <option value="gpt-4o" selected>gpt-4o</option>
                                        <option value="gpt-4o-mini">gpt-4o-mini</option>
                                        <option value="gpt-4-turbo">gpt-4-turbo</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="password" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="sk-...">
                                        <button class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="æµ‹è¯•è¿æ¥">
                                            <i data-lucide="plug-zap" class="w-5 h-5"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Gemini Section -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow">
                            <h4 class="text-base font-semibold text-gray-900 mb-4 flex items-center space-x-2">
                                <span class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="gem" class="w-5 h-5 text-purple-600"></i>
                                </span>
                                <span>Google (Gemini)</span>
                            </h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ç«¯ç‚¹ (Endpoint)</label>
                                    <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="https://generativelanguage.googleapis.com/v1beta">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">æ¨¡å‹ (Model)</label>
                                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                                        <option value="gemini-2.5-pro" selected>gemini-2.5-pro</option>
                                        <option value="gemini-1.5-pro">gemini-1.5-pro</option>
                                        <option value="gemini-1.5-flash">gemini-1.5-flash</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="password" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="è¯·è¾“å…¥æ‚¨çš„Gemini API Key...">
                                        <button class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="æµ‹è¯•è¿æ¥">
                                            <i data-lucide="plug-zap" class="w-5 h-5"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Zhipu AI Section -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow">
                            <h4 class="text-base font-semibold text-gray-900 mb-4 flex items-center space-x-2">
                                <span class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="box" class="w-5 h-5 text-orange-600"></i>
                                </span>
                                <span>æ™ºè°±AI (GLM-4.5V)</span>
                            </h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ç«¯ç‚¹ (Endpoint)</label>
                                    <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="https://open.bigmodel.cn/api/paas/v4">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">æ¨¡å‹ (Model)</label>
                                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                                        <option value="glm-4.5-vision" selected>glm-4.5-vision</option>
                                        <option value="glm-4v">glm-4v</option>
                                        <option value="glm-4-plus">glm-4-plus</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="password" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="è¯·è¾“å…¥æ‚¨çš„Zhipu AI API Key...">
                                        <button class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="æµ‹è¯•è¿æ¥">
                                            <i data-lucide="plug-zap" class="w-5 h-5"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- æ¨¡å‹è®¾ç½® -->
                <section id="settings-model" class="settings-tab-content space-y-4 hidden">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-start space-x-3">
                            <i data-lucide="info" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                            <div>
                                <h4 class="text-base font-medium text-blue-900">æ¨¡å‹å‚æ•°è¯´æ˜</h4>
                                <p class="text-sm text-blue-700 mt-1">æ ¹æ®æ‚¨çš„é˜…å·éœ€æ±‚è°ƒæ•´æ¨¡å‹å‚æ•°ï¼Œä¼˜åŒ–è¯„åˆ†æ•ˆæœå’Œæˆæœ¬æ§åˆ¶</p>
                            </div>
                        </div>
                    </div>

                    <!-- æ¨¡å‹å‚æ•°é…ç½® -->
                    <div class="space-y-6">
                        <!-- GPT-4o å‚æ•°è®¾ç½® -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow">
                            <div class="space-y-4">
                                <!-- æ¸©åº¦å‚æ•° -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        æ¸©åº¦ (Temperature): <span class="text-blue-600 font-semibold" id="gpt4o-temp-value">0.7</span>
                                    </label>
                                    <input type="range" id="gpt4o-temp" min="0" max="1" step="0.1" value="0.7" class="w-full">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>ç²¾ç¡®</span>
                                        <span>å¹³è¡¡</span>
                                        <span>åˆ›æ–°</span>
                                    </div>
                                </div>
                                <!-- æœ€å¤§Tokens -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">æœ€å¤§Tokens</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="range" id="gpt4o-max-tokens" min="512" max="4096" step="256" value="2048" class="flex-1">
                                        <span class="text-sm font-medium text-blue-600 min-w-[60px]" id="gpt4o-max-tokens-value">2048</span>
                                    </div>
                                </div>
                                <!-- Top-P -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Top-P: <span class="text-blue-600 font-semibold" id="gpt4o-topp-value">0.9</span>
                                    </label>
                                    <input type="range" id="gpt4o-topp" min="0.1" max="1" step="0.1" value="0.9" class="w-full">
                                </div>
                            </div>
                        </div>

                        <!-- Gemini å‚æ•°è®¾ç½® -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow">
                            <div class="flex items-center space-x-3 mb-4">
                                <span class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="sparkles" class="w-6 h-6 text-purple-600"></i>
                                </span>
                                <div>
                                    <h4 class="text-base font-semibold text-gray-900">Gemini</h4>
                                    <p class="text-sm text-gray-600">Google å¤šæ¨¡æ€AIæ¨¡å‹</p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <!-- æ¸©åº¦å‚æ•° -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        æ¸©åº¦ (Temperature): <span class="text-purple-600 font-semibold" id="gemini-temp-value">0.6</span>
                                    </label>
                                    <input type="range" id="gemini-temp" min="0" max="1" step="0.1" value="0.6" class="w-full">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>ç²¾ç¡®</span>
                                        <span>å¹³è¡¡</span>
                                        <span>åˆ›æ–°</span>
                                    </div>
                                </div>
                                <!-- æœ€å¤§Tokens -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">æœ€å¤§Tokens</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="range" id="gemini-max-tokens" min="512" max="4096" step="256" value="2048" class="flex-1">
                                        <span class="text-sm font-medium text-purple-600 min-w-[60px]" id="gemini-max-tokens-value">2048</span>
                                    </div>
                                </div>
                                <!-- Top-K -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Top-K: <span class="text-purple-600 font-semibold" id="gemini-topk-value">40</span>
                                    </label>
                                    <input type="range" id="gemini-topk" min="1" max="100" step="1" value="40" class="w-full">
                                </div>
                            </div>
                        </div>

                        <!-- Zhipu AI å‚æ•°è®¾ç½® -->
                        <div class="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow">
                            <div class="flex items-center space-x-3 mb-4">
                                <span class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="box" class="w-6 h-6 text-orange-600"></i>
                                </span>
                                <div>
                                    <h4 class="text-base font-semibold text-gray-900">GLM-4.5V</h4>
                                    <p class="text-sm text-gray-600">æ™ºè°±AI å¤šæ¨¡æ€å¤§æ¨¡å‹</p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <!-- æ¸©åº¦å‚æ•° -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        æ¸©åº¦ (Temperature): <span class="text-orange-600 font-semibold" id="glm-temp-value">0.65</span>
                                    </label>
                                    <input type="range" id="glm-temp" min="0" max="1" step="0.05" value="0.65" class="w-full">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>ç²¾ç¡®</span>
                                        <span>å¹³è¡¡</span>
                                        <span>åˆ›æ–°</span>
                                    </div>
                                </div>
                                <!-- æœ€å¤§Tokens -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">æœ€å¤§Tokens</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="range" id="glm-max-tokens" min="512" max="4096" step="256" value="2048" class="flex-1">
                                        <span class="text-sm font-medium text-orange-600 min-w-[60px]" id="glm-max-tokens-value">2048</span>
                                    </div>
                                </div>
                                <!-- é‡å¤æƒ©ç½š -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        é‡å¤æƒ©ç½š: <span class="text-orange-600 font-semibold" id="glm-penalty-value">1.1</span>
                                    </label>
                                    <input type="range" id="glm-penalty" min="1" max="1.5" step="0.05" value="1.1" class="w-full">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- é¢„è®¾é…ç½® -->
                    <div class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="text-sm font-medium text-blue-900 mb-3 flex items-center">
                            <i data-lucide="preset" class="w-4 h-4 mr-2"></i>
                            å¿«é€Ÿé¢„è®¾é…ç½®
                        </h4>
                        <div class="grid grid-cols-3 gap-3">
                            <button class="preset-config-btn p-3 bg-white border border-blue-300 rounded-lg text-sm font-medium text-blue-700 hover:bg-blue-100 hover:border-blue-400 transition-colors flex items-center justify-center space-x-2" data-preset="speed">
                                <i data-lucide="zap" class="w-4 h-4"></i>
                                <span>é€Ÿåº¦ä¼˜å…ˆ</span>
                            </button>
                            <button class="preset-config-btn p-3 bg-white border border-blue-300 rounded-lg text-sm font-medium text-blue-700 hover:bg-blue-100 hover:border-blue-400 transition-colors flex items-center justify-center space-x-2" data-preset="balance">
                                <i data-lucide="scale" class="w-4 h-4"></i>
                                <span>å‡è¡¡æ¨¡å¼</span>
                            </button>
                            <button class="preset-config-btn p-3 bg-white border border-blue-300 rounded-lg text-sm font-medium text-blue-700 hover:bg-blue-100 hover:border-blue-400 transition-colors flex items-center justify-center space-x-2" data-preset="accuracy">
                                <i data-lucide="target" class="w-4 h-4"></i>
                                <span>å‡†ç¡®ä¼˜å…ˆ</span>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- æ™ºèƒ½é˜…å·ç­–ç•¥ -->
                <section id="settings-strategy" class="settings-tab-content space-y-4 hidden">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-start space-x-3">
                            <i data-lucide="info" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                            <div>
                                <h4 class="text-base font-medium text-blue-900">ç­–ç•¥è¯´æ˜</h4>
                                <p class="text-sm text-blue-700 mt-1">æ­¤ç­–ç•¥åœ¨"æ ·é¢˜è¯•é˜…"å®Œæˆåç”Ÿæ•ˆã€‚ç³»ç»Ÿå°†æ ¹æ®æ‚¨çš„æ ¡å‡†ç»“æœè‡ªåŠ¨æ¨èæœ€ä½³ç­–ç•¥ã€‚</p>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-3" id="strategy-list">
                        <!-- ç­–ç•¥ä¸€ -->
                        <label class="strategy-item flex items-start p-4 bg-white border-2 border-blue-500 rounded-xl hover:shadow-md transition-shadow cursor-pointer bg-blue-50">
                            <input type="radio" name="grading-strategy" class="mt-1 text-blue-600" checked>
                            <div class="ml-3">
                                <span class="font-medium text-gray-900">GPT-4o ä¼˜å…ˆ</span>
                                <p class="text-sm text-gray-600 mt-1">é€Ÿåº¦ä¸å‡†ç¡®åº¦æœ€ä½³å‡è¡¡ï¼Œè‡ªåŠ¨æ¨èã€‚</p>
                            </div>
                        </label>
                        <!-- ç­–ç•¥äºŒ -->
                        <label class="strategy-item flex items-start p-4 bg-white border-2 border-gray-200 rounded-xl hover:shadow-md hover:border-blue-300 transition-all cursor-pointer">
                            <input type="radio" name="grading-strategy" class="mt-1 text-blue-600">
                            <div class="ml-3">
                                <span class="font-medium text-gray-900">Gemini ä¼˜å…ˆ</span>
                                <p class="text-sm text-gray-600 mt-1">æˆæœ¬æ•ˆç›Šæœ€é«˜ï¼Œé€‚åˆç®€å•é¢˜ç›®ã€‚</p>
                            </div>
                        </label>
                        <!-- ç­–ç•¥ä¸‰ -->
                        <label class="strategy-item flex items-start p-4 bg-white border-2 border-gray-200 rounded-xl hover:shadow-md hover:border-blue-300 transition-all cursor-pointer">
                            <input type="radio" name="grading-strategy" class="mt-1 text-blue-600">
                            <div class="ml-3">
                                <span class="font-medium text-gray-900">åŒæ¨¡å‹äº¤å‰éªŒè¯</span>
                                <p class="text-sm text-gray-600 mt-1">å‡†ç¡®åº¦æœ€é«˜ï¼Œä½†é€Ÿåº¦è¾ƒæ…¢ä¸”æˆæœ¬è¾ƒé«˜ã€‚</p>
                            </div>
                        </label>
                    </div>
                </section>

                <!-- é«˜çº§è®¾ç½® -->
                <section id="settings-advanced" class="settings-tab-content space-y-4 hidden">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-start space-x-3">
                            <i data-lucide="info" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                            <div>
                                <h4 class="text-base font-medium text-blue-900">é«˜çº§è®¾ç½®è¯´æ˜</h4>
                                <p class="text-sm text-blue-700 mt-1">è¿™äº›è®¾ç½®ä¼šå½±å“ç³»ç»Ÿçš„é»˜è®¤è¡Œä¸ºï¼Œè¯·è°¨æ…ä¿®æ”¹ã€‚</p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <!-- è‡ªåŠ¨ä¿å­˜ -->
                        <div class="flex items-center justify-between p-4 bg-white border border-gray-200 rounded-xl hover:shadow-md transition-shadow">
                            <div>
                                <span class="text-sm font-medium text-gray-900">è‡ªåŠ¨ä¿å­˜è¯„åˆ†ç»†åˆ™</span>
                                <p class="text-xs text-gray-500 mt-1">æ¯æ¬¡ä¿®æ”¹åè‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-500/30 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
                            </label>
                        </div>

                        <!-- åŒæ¨¡å‹éªŒè¯ -->
                        <div class="flex items-center justify-between p-4 bg-white border border-gray-200 rounded-xl hover:shadow-md transition-shadow">
                            <div>
                                <span class="text-sm font-medium text-gray-900">åŒæ¨¡å‹éªŒè¯</span>
                                <p class="text-xs text-gray-500 mt-1">æé«˜è¯„åˆ†å‡†ç¡®ç‡ï¼Œæ¶ˆè€—æ›´å¤šAPIé…é¢</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-500/30 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
                            </label>
                        </div>

                        <!-- é˜…å·é€Ÿåº¦ -->
                        <div class="p-4 bg-white border border-gray-200 rounded-xl">
                            <label class="block text-sm font-medium text-gray-900 mb-3">é˜…å·é€Ÿåº¦</label>
                            <input type="range" id="gradingSpeed" min="1" max="5" value="3" class="w-full">
                            <div class="flex justify-between text-xs text-gray-500 mt-2">
                                <span>æ…¢é€Ÿ</span>
                                <span>æ­£å¸¸</span>
                                <span>å¿«é€Ÿ</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="bg-gray-50 p-6 flex justify-end space-x-3">
                <button id="settings-cancel-btn" class="py-2.5 px-6 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
                    å–æ¶ˆ
                </button>
                <button id="settings-save-btn" class="py-2.5 px-6 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors shadow-sm">
                    ä¿å­˜è®¾ç½®
                </button>
            </div>
        </div>
    </div>

    <!-- åŒæ¨¡å‹è¯¦ç»†å¯¹æ¯” Modal -->
    <div id="dual-model-detail-modal" class="fixed inset-0 w-full h-full flex items-center justify-center z-50 hidden">
        <div class="modal-backdrop absolute inset-0 bg-black/50 backdrop-blur-sm opacity-0"></div>
        <div class="modal-content bg-white rounded-2xl shadow-lg w-full max-w-5xl z-10 mx-4 transform scale-95 opacity-0" style="max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
            <!-- å¼¹çª—æ ‡é¢˜æ  -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <i data-lucide="git-compare" class="w-7 h-7"></i>
                        <div>
                            <h2 class="text-xl font-semibold tracking-tight">åŒæ¨¡å‹è¯¦ç»†å¯¹æ¯”åˆ†æ</h2>
                            <p class="text-sm text-white/80 mt-1">æ ·é¢˜è¯•é˜… - é«˜äºŒå†å²ç¬¬3å•å…ƒæµ‹è¯•</p>
                        </div>
                    </div>
                    <button id="dual-model-close-btn" class="text-white/80 hover:text-white transition-colors">
                        <i data-lucide="x" class="w-7 h-7"></i>
                    </button>
                </div>
            </div>

            <!-- å¼¹çª—ä¸»ä½“å†…å®¹ï¼ˆå¯æ»šåŠ¨ï¼‰ -->
            <div class="p-6 overflow-y-auto custom-scrollbar" style="flex: 1;">
                <!-- æ¨èåˆ†æ•°å’Œæ¦‚è§ˆ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-5 border border-blue-200">
                        <div class="flex items-center space-x-2 mb-1">
                            <i data-lucide="diamond" class="w-4 h-4 text-blue-600"></i>
                            <div class="text-sm text-blue-600 font-medium">æ¨èåˆ†æ•°</div>
                        </div>
                        <div class="text-3xl font-bold text-blue-800">85/100</div>
                        <div class="text-xs text-blue-600 mt-1">ç»¼åˆåŒæ¨¡å‹ç»“æœ</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-5 border border-green-200">
                        <div class="flex items-center space-x-2 mb-1">
                            <i data-lucide="check-circle" class="w-4 h-4 text-green-600"></i>
                            <div class="text-sm text-green-600 font-medium">è¯„åˆ†ä¸€è‡´æ€§</div>
                        </div>
                        <div class="text-3xl font-bold text-green-800">92%</div>
                        <div class="text-xs text-green-600 mt-1">é«˜åº¦ä¸€è‡´</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-5 border border-purple-200">
                        <div class="flex items-center space-x-2 mb-1">
                            <i data-lucide="bar-chart-3" class="w-4 h-4 text-purple-600"></i>
                            <div class="text-sm text-purple-600 font-medium">ç½®ä¿¡åº¦</div>
                        </div>
                        <div class="text-3xl font-bold text-purple-800">92%</div>
                        <div class="text-xs text-purple-600 mt-1">æ¨èå¯ä¿¡åº¦é«˜</div>
                    </div>
                </div>

                <!-- å·®å¼‚æ‘˜è¦ -->
                <div class="bg-amber-50 border border-amber-200 rounded-xl p-5 mb-6">
                    <div class="flex items-start space-x-3">
                        <i data-lucide="alert-circle" class="w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5"></i>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <i data-lucide="pin" class="w-4 h-4 text-amber-800"></i>
                                <h3 class="text-base font-semibold text-amber-800">å·®å¼‚æ‘˜è¦åˆ†æ</h3>
                            </div>
                            <div class="text-sm text-amber-700 space-y-2">
                                <div><strong>åˆ†å€¼å·®å¼‚:</strong> 4åˆ† (å·®å¼‚ç‡4.6%)</div>
                                <div><strong>ä¸»è¦åˆ†æ­§:</strong></div>
                                <ul class="list-disc list-inside ml-4 space-y-1">
                                    <li>GPT-4oæ›´å…³æ³¨è®ºè¿°æ·±åº¦å’Œè¯­è¨€è¡¨è¾¾çš„æµç•…æ€§</li>
                                    <li>Geminiæ›´è®¤å¯ç»“æ„å®Œæ•´æ€§å’Œé€»è¾‘çš„ä¸¥å¯†æ€§</li>
                                </ul>
                                <div><strong>ä¸€è‡´è®¤å¯:</strong> è§‚ç‚¹æ˜ç¡®ã€ä¹¦å†™è§„èŒƒã€å†å²äº‹å®å‡†ç¡®</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åŒæ¨¡å‹è¯¦ç»†å¯¹æ¯”ï¼ˆå·¦å³åˆ†æ ï¼‰ -->
                <div class="grid grid-cols-2 gap-6 mb-6">
                    <!-- GPT-4o è¯¦ç»†ç»“æœ -->
                    <div class="bg-white rounded-xl border border-gray-200 shadow-sm">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-t-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <i data-lucide="brain" class="w-5 h-5"></i>
                                    <span class="font-semibold">GPT-4o Vision</span>
                                </div>
                                <span class="bg-white/20 px-3 py-1 rounded-full text-sm">æ¨¡å‹A</span>
                            </div>
                        </div>
                        <div class="p-5">
                            <div class="text-center mb-4">
                                <div class="text-4xl font-bold text-blue-600 mb-1">87<span class="text-xl">/100</span></div>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div class="bg-blue-500 h-3 rounded-full" style="width: 87%"></div>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <div class="text-sm font-medium text-gray-700 mb-2">è¯¦ç»†è¯„åˆ†ç†ç”±</div>
                                    <div class="space-y-3">
                                        <div class="border-l-4 border-blue-400 pl-3">
                                            <div class="text-sm font-medium text-gray-800">è§‚ç‚¹æ˜ç¡® (28/30åˆ†)</div>
                                            <div class="text-xs text-gray-600 mt-1">â€¢ è®ºç‚¹æ¸…æ™°ï¼Œç«‹åœºåšå®š</div>
                                            <div class="text-xs text-gray-600">â€¢ è§‚ç‚¹ç¬¦åˆå†å²äº‹å®ï¼Œè§’åº¦ç‹¬ç‰¹</div>
                                        </div>
                                        <div class="border-l-4 border-blue-400 pl-3">
                                            <div class="text-sm font-medium text-gray-800">å²å®å‡†ç¡® (25/30åˆ†)</div>
                                            <div class="text-xs text-gray-600 mt-1">â€¢ å†å²äº‹å®æ— è¯¯ï¼Œå¼•ç”¨å‡†ç¡®</div>
                                            <div class="text-xs text-gray-600">â€¢ æ—¶é—´åœ°ç‚¹æ­£ç¡®ï¼Œç»†èŠ‚ä¸°å¯Œ</div>
                                        </div>
                                        <div class="border-l-4 border-blue-400 pl-3">
                                            <div class="text-sm font-medium text-gray-800">è®ºè¿°å……åˆ† (24/25åˆ†)</div>
                                            <div class="text-xs text-gray-600 mt-1">â€¢ è®ºæ®å……å®ï¼Œåˆ†ææ·±å…¥</div>
                                            <div class="text-xs text-gray-600">â€¢ é€»è¾‘ä¸¥å¯†ï¼Œè®ºè¯æœ‰åŠ›</div>
                                        </div>
                                        <div class="border-l-4 border-blue-400 pl-3">
                                            <div class="text-sm font-medium text-gray-800">è¯­è¨€è¡¨è¾¾ (10/15åˆ†)</div>
                                            <div class="text-xs text-gray-600 mt-1">â€¢ è¯­è¨€æµç•…ï¼Œç”¨è¯å‡†ç¡®</div>
                                            <div class="text-xs text-gray-600">â€¢ å¥å¼çµæ´»ï¼Œè¡¨è¾¾æ¸…æ™°</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-blue-50 rounded-lg p-3">
                                    <div class="text-sm font-medium text-blue-800 mb-2">âœ¨ æ¨¡å‹äº®ç‚¹</div>
                                    <div class="text-xs text-blue-700">
                                        <div>â€¢ è®ºè¿°æ·±åº¦è¾ƒå¥½ï¼Œåˆ†æé€å½»</div>
                                        <div>â€¢ è¯­è¨€è¡¨è¾¾æµç•…è‡ªç„¶</div>
                                        <div>â€¢ å†å²ç»†èŠ‚æŠŠæ¡å‡†ç¡®</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gemini è¯¦ç»†ç»“æœ -->
                    <div class="bg-white rounded-xl border border-gray-200 shadow-sm">
                        <div class="bg-gradient-to-r from-teal-500 to-teal-600 text-white p-4 rounded-t-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <i data-lucide="sparkles" class="w-5 h-5"></i>
                                    <span class="font-semibold">Gemini 2.0</span>
                                </div>
                                <span class="bg-white/20 px-3 py-1 rounded-full text-sm">æ¨¡å‹B</span>
                            </div>
                        </div>
                        <div class="p-5">
                            <div class="text-center mb-4">
                                <div class="text-4xl font-bold text-teal-600 mb-1">83<span class="text-xl">/100</span></div>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div class="bg-teal-500 h-3 rounded-full" style="width: 83%"></div>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <div class="text-sm font-medium text-gray-700 mb-2">è¯¦ç»†è¯„åˆ†ç†ç”±</div>
                                    <div class="space-y-3">
                                        <div class="border-l-4 border-teal-400 pl-3">
                                            <div class="text-sm font-medium text-gray-800">è§‚ç‚¹æ˜ç¡® (26/30åˆ†)</div>
                                            <div class="text-xs text-gray-600 mt-1">â€¢ è®ºç‚¹æ˜ç¡®ï¼Œè®ºè¯åˆç†</div>
                                            <div class="text-xs text-gray-600">â€¢ è§‚ç‚¹ç¬¦åˆé¢˜ç›®è¦æ±‚</div>
                                        </div>
                                        <div class="border-l-4 border-teal-400 pl-3">
                                            <div class="text-sm font-medium text-gray-800">å²å®å‡†ç¡® (25/30åˆ†)</div>
                                            <div class="text-xs text-gray-600 mt-1">â€¢ å†å²äº‹å®æ— è¯¯</div>
                                            <div class="text-xs text-gray-600">â€¢ å¼•ç”¨å‡†ç¡®æ°å½“</div>
                                        </div>
                                        <div class="border-l-4 border-teal-400 pl-3">
                                            <div class="text-sm font-medium text-gray-800">è®ºè¿°å……åˆ† (22/25åˆ†)</div>
                                            <div class="text-xs text-gray-600 mt-1">â€¢ ç»“æ„å®Œæ•´ï¼Œé€»è¾‘æ¸…æ™°</div>
                                            <div class="text-xs text-gray-600">â€¢ å»ºè®®åŠ å¼ºè®ºæ®æ”¯æ’‘</div>
                                        </div>
                                        <div class="border-l-4 border-teal-400 pl-3">
                                            <div class="text-sm font-medium text-gray-800">è¯­è¨€è¡¨è¾¾ (10/15åˆ†)</div>
                                            <div class="text-xs text-gray-600 mt-1">â€¢ è¯­è¨€æµç•…ï¼Œè¡¨è¾¾å‡†ç¡®</div>
                                            <div class="text-xs text-gray-600">â€¢ æ ¼å¼è§„èŒƒï¼Œæ¡ç†æ¸…æ¥š</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-teal-50 rounded-lg p-3">
                                    <div class="text-sm font-medium text-teal-800 mb-2">âœ¨ æ¨¡å‹äº®ç‚¹</div>
                                    <div class="text-xs text-teal-700">
                                        <div>â€¢ ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘ä¸¥å¯†</div>
                                        <div>â€¢ è®ºè¯å®Œæ•´ï¼Œæ¡ç†æ¸…æ¥š</div>
                                        <div>â€¢ ä¹¦å†™è§„èŒƒï¼Œæ ¼å¼æ ‡å‡†</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æŒ‰è¯„åˆ†æ ‡å‡†é€é¡¹å¯¹æ¯” -->
                <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="bar-chart-2" class="w-5 h-5 mr-2"></i>
                        <i data-lucide="clipboard-list" class="w-5 h-5 mr-2"></i>
                        æŒ‰è¯„åˆ†æ ‡å‡†é€é¡¹å¯¹æ¯”
                    </h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-5 gap-4 text-sm font-medium text-gray-700 border-b pb-2">
                            <div>è¯„åˆ†æ ‡å‡†</div>
                            <div class="text-center">GPT-4o</div>
                            <div class="text-center">Gemini</div>
                            <div class="text-center">æ¨èåˆ†æ•°</div>
                            <div class="text-center">å·®å¼‚</div>
                        </div>

                        <div class="grid grid-cols-5 gap-4 items-center py-3 border-b border-gray-100">
                            <div class="text-sm text-gray-800">è§‚ç‚¹æ˜ç¡® (30åˆ†)</div>
                            <div class="text-center">
                                <div class="text-blue-600 font-semibold">28åˆ†</div>
                                <div class="text-xs text-gray-500">93%</div>
                            </div>
                            <div class="text-center">
                                <div class="text-teal-600 font-semibold">26åˆ†</div>
                                <div class="text-xs text-gray-500">87%</div>
                            </div>
                            <div class="text-center">
                                <div class="text-purple-600 font-semibold">27åˆ†</div>
                            </div>
                            <div class="text-center">
                                <span class="text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded">+2åˆ†</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-5 gap-4 items-center py-3 border-b border-gray-100">
                            <div class="text-sm text-gray-800">å²å®å‡†ç¡® (30åˆ†)</div>
                            <div class="text-center">
                                <div class="text-blue-600 font-semibold">25åˆ†</div>
                                <div class="text-xs text-gray-500">83%</div>
                            </div>
                            <div class="text-center">
                                <div class="text-teal-600 font-semibold">25åˆ†</div>
                                <div class="text-xs text-gray-500">83%</div>
                            </div>
                            <div class="text-center">
                                <div class="text-purple-600 font-semibold">25åˆ†</div>
                            </div>
                            <div class="text-center">
                                <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">ä¸€è‡´</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-5 gap-4 items-center py-3 border-b border-gray-100">
                            <div class="text-sm text-gray-800">è®ºè¿°å……åˆ† (25åˆ†)</div>
                            <div class="text-center">
                                <div class="text-blue-600 font-semibold">24åˆ†</div>
                                <div class="text-xs text-gray-500">96%</div>
                            </div>
                            <div class="text-center">
                                <div class="text-teal-600 font-semibold">22åˆ†</div>
                                <div class="text-xs text-gray-500">88%</div>
                            </div>
                            <div class="text-center">
                                <div class="text-purple-600 font-semibold">23åˆ†</div>
                            </div>
                            <div class="text-center">
                                <span class="text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded">+2åˆ†</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-5 gap-4 items-center py-3">
                            <div class="text-sm text-gray-800">è¯­è¨€è¡¨è¾¾ (15åˆ†)</div>
                            <div class="text-center">
                                <div class="text-blue-600 font-semibold">10åˆ†</div>
                                <div class="text-xs text-gray-500">67%</div>
                            </div>
                            <div class="text-center">
                                <div class="text-teal-600 font-semibold">10åˆ†</div>
                                <div class="text-xs text-gray-500">67%</div>
                            </div>
                            <div class="text-center">
                                <div class="text-purple-600 font-semibold">10åˆ†</div>
                            </div>
                            <div class="text-center">
                                <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">ä¸€è‡´</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¼¹çª—åº•éƒ¨æ“ä½œåŒº -->
            <div class="bg-gray-50 p-6 rounded-b-2xl flex justify-end space-x-3 border-t">
                <button id="dual-model-save-btn" class="py-2 px-6 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">
                    <i data-lucide="save" class="w-4 h-4 inline mr-1"></i>
                    ä¿å­˜å¯¹æ¯”
                </button>
                <button id="dual-model-export-btn" class="py-2 px-6 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors">
                    <i data-lucide="download" class="w-4 h-4 inline mr-1"></i>
                    å¯¼å‡ºæŠ¥å‘Š
                </button>
                <button id="dual-model-confirm-btn" class="py-2 px-6 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-medium transition-colors">
                    <i data-lucide="check" class="w-4 h-4 inline mr-1"></i>
                    ç¡®è®¤è¯„åˆ†
                </button>
            </div>
        </div>
    </div>

    <!-- æç¤ºæ¶ˆæ¯ -->
    <div id="toast" class="fixed top-4 right-4 z-50 hidden">
        <div class="glass rounded-lg p-4 flex items-center space-x-3 min-w-[300px]">
            <div id="toast-icon"></div>
            <div>
                <p id="toast-title" class="font-medium text-gray-800"></p>
                <p id="toast-message" class="text-sm text-gray-600"></p>
            </div>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        // ========== å•ä¸€DOMContentLoadedç›‘å¬å™¨ ==========
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Page loaded, initializing...');

            // åˆå§‹åŒ– Lucide å›¾æ ‡
            lucide.createIcons();

            // ç¡®ä¿é€‰é¡¹å¡åˆå§‹çŠ¶æ€æ­£ç¡®
            const defaultTabContent = document.getElementById('tab-content-grading');
            const reviewTabContent = document.getElementById('tab-content-review');
            const analysisTabContent = document.getElementById('tab-content-analysis');

            if (defaultTabContent) {
                defaultTabContent.classList.remove('hidden');
                defaultTabContent.classList.add('scale-in');
            }
            if (reviewTabContent) {
                reviewTabContent.classList.add('hidden');
            }
            if (analysisTabContent) {
                analysisTabContent.classList.add('hidden');
            }

            console.log('Tab contents initialized');

            // å…¨å±€å˜é‡
            let currentRubricContent = '';

            // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼ˆå¯é€‰ï¼Œå¦‚æœå­˜åœ¨ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ï¼‰
            const themeToggle = document.getElementById('theme-toggle');
            const body = document.body;
            let isDarkMode = false;

            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    isDarkMode = !isDarkMode;
                    body.classList.toggle('dark-mode');

                    const icon = themeToggle.querySelector('i');
                    if (icon) {
                        icon.setAttribute('data-lucide', isDarkMode ? 'moon' : 'sun');
                        lucide.createIcons();
                    }
                });
            }

            // ========== è®¾ç½®åŠŸèƒ½ ==========
            const settingsModal = document.getElementById('settings-modal');
            const settingsCloseBtn = document.getElementById('settings-close-btn');
            const settingsCancelBtn = document.getElementById('settings-cancel-btn');
            const settingsSaveBtn = document.getElementById('settings-save-btn');
            const settingsTabs = document.querySelectorAll('.settings-tab-btn');
            const settingsTabContents = document.querySelectorAll('.settings-tab-content');

            // æ‰“å¼€è®¾ç½®æ¨¡æ€æ¡†
            function openSettingsModal() {
                if (settingsModal) {
                    settingsModal.classList.remove('hidden');
                    setTimeout(() => {
                        settingsModal.querySelector('.modal-backdrop').classList.add('opacity-100');
                        settingsModal.querySelector('.modal-content').classList.add('scale-100', 'opacity-100');
                        settingsModal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
                    }, 10);
                    // åŠ è½½è®¾ç½®æ•°æ®
                    loadSettings();
                    // é‡æ–°åˆå§‹åŒ–æ»‘å—äº¤äº’ï¼ˆç¡®ä¿æ»‘å—è¿›åº¦æ­£ç¡®æ˜¾ç¤ºï¼‰
                    initSliderInteraction();
                }
            }

            // å…³é—­è®¾ç½®æ¨¡æ€æ¡†
            function closeSettingsModal() {
                if (settingsModal) {
                    settingsModal.querySelector('.modal-backdrop').classList.remove('opacity-100');
                    settingsModal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
                    settingsModal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        settingsModal.classList.add('hidden');
                    }, 300);
                }
            }

            // è®¾ç½®æŒ‰é’®ç»‘å®šäº‹ä»¶ï¼ˆä»å¤´éƒ¨å¯¼èˆªæ ï¼‰
            const settingsHeaderButton = document.getElementById('settings-button');
            if (settingsHeaderButton) {
                settingsHeaderButton.addEventListener('click', openSettingsModal);
            }

            // è¯„åˆ†æ ‡å‡†é…ç½®æŒ‰é’®ç»‘å®šäº‹ä»¶ï¼ˆä»å¤´éƒ¨å¯¼èˆªæ ï¼‰
            const rubricConfigHeaderButton = document.getElementById('rubric-config-button');
            if (rubricConfigHeaderButton) {
                rubricConfigHeaderButton.addEventListener('click', openRubricConfigModal);
            }

            // Tabåˆ‡æ¢åŠŸèƒ½
            settingsTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.getAttribute('data-settings-tab');

                    // æ›´æ–°TabæŒ‰é’®æ ·å¼ï¼ˆè“è‰²ä¸»é¢˜ï¼‰
                    settingsTabs.forEach(t => {
                        t.classList.remove('bg-white', 'text-blue-600', 'shadow-sm', 'border-blue-200');
                        t.classList.add('text-gray-700', 'border-transparent');
                    });
                    tab.classList.add('bg-white', 'text-blue-600', 'shadow-sm', 'border-blue-200');
                    tab.classList.remove('text-gray-700', 'border-transparent');

                    // æ˜¾ç¤ºå¯¹åº”çš„å†…å®¹
                    settingsTabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    const targetContent = document.getElementById(`settings-${targetTab}`);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                        targetContent.classList.add('slide-in');
                    }
                });
            });

            if (settingsCloseBtn) {
                settingsCloseBtn.addEventListener('click', closeSettingsModal);
            }
            if (settingsCancelBtn) {
                settingsCancelBtn.addEventListener('click', closeSettingsModal);
            }
            if (settingsModal) {
                settingsModal.querySelector('.modal-backdrop').addEventListener('click', closeSettingsModal);
            }

            // ä¿å­˜è®¾ç½®
            if (settingsSaveBtn) {
                settingsSaveBtn.addEventListener('click', () => {
                    saveSettings();
                });
            }

            // ========== è¯„åˆ†æ ‡å‡†é…ç½®åŠŸèƒ½ ==========
            const rubricConfigModal = document.getElementById('rubric-config-modal');
            const rubricConfigCloseBtn = document.getElementById('rubric-config-close-btn');
            const rubricConfigCancelBtn = document.getElementById('rubric-config-cancel-btn');
            const rubricConfigSaveBtn = document.getElementById('rubric-config-save-btn');
            const dimensionsList = document.getElementById('dimensions-list');
            const totalScoreDisplay = document.getElementById('total-score-display');
            const totalScoreProgress = document.getElementById('total-score-progress');

            // è¯„åˆ†æ ‡å‡†æ•°æ®ç»“æ„
            let rubricConfig = {
                dimensions: [
                    { id: 1, name: 'è§‚ç‚¹æ˜ç¡®', score: 30, description: 'è®ºç‚¹æ¸…æ™°ï¼Œç«‹åœºæ˜ç¡®' },
                    { id: 2, name: 'å²å®å‡†ç¡®', score: 30, description: 'å†å²äº‹å®å‡†ç¡®æ— è¯¯' },
                    { id: 3, name: 'è®ºè¿°å……åˆ†', score: 25, description: 'è®ºæ®å……å®ï¼Œé€»è¾‘ä¸¥å¯†' },
                    { id: 4, name: 'è¯­è¨€è¡¨è¾¾', score: 15, description: 'è¯­è¨€æµç•…ï¼Œä¹¦å†™è§„èŒƒ' }
                ]
            };

            // æ¨¡æ¿é…ç½®
            const rubricTemplates = {
                standard: {
                    name: 'æ ‡å‡†è®ºè¿°é¢˜',
                    dimensions: [
                        { name: 'è§‚ç‚¹æ˜ç¡®', score: 30, description: 'è®ºç‚¹æ¸…æ™°ï¼Œç«‹åœºåšå®š' },
                        { name: 'å²å®å‡†ç¡®', score: 30, description: 'å†å²äº‹å®å‡†ç¡®æ— è¯¯' },
                        { name: 'è®ºè¿°å……åˆ†', score: 25, description: 'è®ºæ®å……å®ï¼Œé€»è¾‘ä¸¥å¯†' },
                        { name: 'è¯­è¨€è¡¨è¾¾', score: 15, description: 'è¯­è¨€æµç•…ï¼Œä¹¦å†™è§„èŒƒ' }
                    ]
                },
                analysis: {
                    name: 'åˆ†æè®ºè¿°é¢˜',
                    dimensions: [
                        { name: 'è§‚ç‚¹æ˜ç¡®', score: 25, description: 'è§‚ç‚¹æ¸…æ™°ï¼Œåˆ†æåˆ°ä½' },
                        { name: 'å²å®å‡†ç¡®', score: 25, description: 'å²å®å‡†ç¡®ï¼Œåˆ†æåŸºç¡€æ‰å®' },
                        { name: 'æ·±åº¦åˆ†æ', score: 35, description: 'åˆ†ææ·±å…¥ï¼Œè§è§£ç‹¬åˆ°' },
                        { name: 'è¯­è¨€è¡¨è¾¾', score: 15, description: 'è¡¨è¾¾æ¸…æ™°ï¼Œæ¡ç†åˆ†æ˜' }
                    ]
                },
                comparison: {
                    name: 'å¯¹æ¯”è®ºè¿°é¢˜',
                    dimensions: [
                        { name: 'è§‚ç‚¹æ˜ç¡®', score: 30, description: 'å¯¹æ¯”ç‚¹æ˜ç¡®ï¼Œç»“è®ºæ¸…æ™°' },
                        { name: 'å²å®å‡†ç¡®', score: 30, description: 'å¯¹æ¯”å†…å®¹å²å®å‡†ç¡®' },
                        { name: 'å¯¹æ¯”åˆ†æ', score: 25, description: 'å¯¹æ¯”æ·±å…¥ï¼Œåˆ†æé€å½»' },
                        { name: 'è¯­è¨€è¡¨è¾¾', score: 15, description: 'è¡¨è¾¾è§„èŒƒï¼Œé€»è¾‘æ¸…æ™°' }
                    ]
                }
            };

            // æ‰“å¼€è¯„åˆ†æ ‡å‡†é…ç½®æ¨¡æ€æ¡†
            function openRubricConfigModal() {
                if (rubricConfigModal) {
                    // åŠ è½½å·²ä¿å­˜çš„é…ç½®
                    loadRubricConfig();
                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    rubricConfigModal.classList.remove('hidden');
                    setTimeout(() => {
                        rubricConfigModal.querySelector('.modal-backdrop').classList.add('opacity-100');
                        rubricConfigModal.querySelector('.modal-content').classList.add('scale-100', 'opacity-100');
                        rubricConfigModal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
                    }, 10);
                    // æ¸²æŸ“ç»´åº¦åˆ—è¡¨
                    renderDimensionsList();
                    // æ›´æ–°å¯è§†åŒ–
                    updateVisualization();
                }
            }

            // å…³é—­è¯„åˆ†æ ‡å‡†é…ç½®æ¨¡æ€æ¡†
            function closeRubricConfigModal() {
                if (rubricConfigModal) {
                    rubricConfigModal.querySelector('.modal-backdrop').classList.remove('opacity-100');
                    rubricConfigModal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
                    rubricConfigModal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        rubricConfigModal.classList.add('hidden');
                    }, 300);
                }
            }

            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            if (rubricConfigCloseBtn) {
                rubricConfigCloseBtn.addEventListener('click', closeRubricConfigModal);
            }
            if (rubricConfigCancelBtn) {
                rubricConfigCancelBtn.addEventListener('click', closeRubricConfigModal);
            }
            if (rubricConfigModal) {
                rubricConfigModal.querySelector('.modal-backdrop').addEventListener('click', closeRubricConfigModal);
            }

            // æ¸²æŸ“ç»´åº¦åˆ—è¡¨
            function renderDimensionsList() {
                if (!dimensionsList) return;

                dimensionsList.innerHTML = '';
                rubricConfig.dimensions.forEach((dimension, index) => {
                    const dimensionCard = document.createElement('div');
                    dimensionCard.className = 'dimension-card bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-move';
                    dimensionCard.setAttribute('draggable', 'true');
                    dimensionCard.setAttribute('data-dimension-id', dimension.id);

                    dimensionCard.innerHTML = `
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0 mt-1 cursor-move">
                                <i data-lucide="grip-vertical" class="w-5 h-5 text-gray-400"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-3">
                                    <input type="text" value="${dimension.name}" class="dimension-name flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500" data-dimension-id="${dimension.id}">
                                    <div class="flex items-center space-x-2">
                                        <input type="number" value="${dimension.score}" min="0" max="100" class="dimension-score w-20 px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-center focus:ring-2 focus:ring-blue-500 focus:border-blue-500" data-dimension-id="${dimension.id}">
                                        <span class="text-sm text-gray-500">åˆ†</span>
                                        <button class="delete-dimension-btn text-red-500 hover:text-red-700 p-1" data-dimension-id="${dimension.id}">
                                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                <textarea value="${dimension.description}" rows="2" class="dimension-description w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="è¯„åˆ†è¯´æ˜..." data-dimension-id="${dimension.id}">${dimension.description}</textarea>
                            </div>
                        </div>
                    `;

                    dimensionsList.appendChild(dimensionCard);
                });

                // åˆå§‹åŒ–å›¾æ ‡
                lucide.createIcons();

                // ç»‘å®šäº‹ä»¶
                bindDimensionEvents();
                updateTotalScore();
            }

            // ç»‘å®šç»´åº¦äº‹ä»¶
            function bindDimensionEvents() {
                // åˆ†æ•°è¾“å…¥
                document.querySelectorAll('.dimension-score').forEach(input => {
                    input.addEventListener('input', (e) => {
                        const id = parseInt(e.target.dataset.dimensionId);
                        const dimension = rubricConfig.dimensions.find(d => d.id === id);
                        if (dimension) {
                            dimension.score = parseInt(e.target.value) || 0;
                            updateTotalScore();
                            updateVisualization();
                        }
                    });
                });

                // åç§°è¾“å…¥
                document.querySelectorAll('.dimension-name').forEach(input => {
                    input.addEventListener('input', (e) => {
                        const id = parseInt(e.target.dataset.dimensionId);
                        const dimension = rubricConfig.dimensions.find(d => d.id === id);
                        if (dimension) {
                            dimension.name = e.target.value;
                        }
                    });
                });

                // æè¿°è¾“å…¥
                document.querySelectorAll('.dimension-description').forEach(textarea => {
                    textarea.addEventListener('input', (e) => {
                        const id = parseInt(e.target.dataset.dimensionId);
                        const dimension = rubricConfig.dimensions.find(d => d.id === id);
                        if (dimension) {
                            dimension.description = e.target.value;
                        }
                    });
                });

                // åˆ é™¤æŒ‰é’®
                document.querySelectorAll('.delete-dimension-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(btn.dataset.dimensionId);
                        deleteDimension(id);
                    });
                });
            }

            // åˆ é™¤ç»´åº¦
            function deleteDimension(id) {
                if (rubricConfig.dimensions.length <= 1) {
                    showToast('warning', 'æç¤º', 'è‡³å°‘éœ€è¦ä¸€ä¸ªè¯„åˆ†ç»´åº¦');
                    return;
                }
                rubricConfig.dimensions = rubricConfig.dimensions.filter(d => d.id !== id);
                renderDimensionsList();
                updateVisualization();
            }

            // æ›´æ–°æ€»åˆ†æ˜¾ç¤º
            function updateTotalScore() {
                const total = rubricConfig.dimensions.reduce((sum, d) => sum + parseInt(d.score), 0);
                if (totalScoreDisplay) {
                    totalScoreDisplay.textContent = total;
                }
                if (totalScoreProgress) {
                    const percentage = (total / 100) * 100;
                    totalScoreProgress.style.width = `${percentage}%`;
                    totalScoreProgress.className = `h-3 rounded-full transition-all duration-300 ${percentage === 100 ? 'bg-green-500' : percentage > 100 ? 'bg-red-500' : 'bg-blue-500'}`;
                }
            }

            // æ›´æ–°å¯è§†åŒ–å›¾è¡¨
            function updateVisualization() {
                // æ›´æ–°é¥¼å›¾
                const canvas = document.getElementById('score-distribution-chart');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = 100;
                const total = rubricConfig.dimensions.reduce((sum, d) => sum + d.score, 0);

                let startAngle = -Math.PI / 2;
                const colors = ['#3B82F6', '#8B5CF6', '#14B8A6', '#F59E0B', '#EF4444', '#10B981'];

                rubricConfig.dimensions.forEach((dimension, index) => {
                    const sliceAngle = (dimension.score / total) * 2 * Math.PI;
                    const endAngle = startAngle + sliceAngle;

                    // ç»˜åˆ¶æ‰‡å½¢
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                    ctx.closePath();
                    ctx.fillStyle = colors[index % colors.length];
                    ctx.fill();

                    startAngle = endAngle;
                });

                // ä¸­å¿ƒåœ†
                ctx.beginPath();
                ctx.arc(centerX, centerY, 50, 0, 2 * Math.PI);
                ctx.fillStyle = '#fff';
                ctx.fill();

                // æ€»åˆ†æ–‡å­—
                ctx.fillStyle = '#1F2937';
                ctx.font = 'bold 24px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(total, centerX, centerY);

                // æ›´æ–°ç»Ÿè®¡åˆ—è¡¨
                const dimensionStats = document.getElementById('dimension-stats');
                if (dimensionStats) {
                    dimensionStats.innerHTML = '';
                    rubricConfig.dimensions.forEach((dimension, index) => {
                        const percentage = total > 0 ? ((dimension.score / total) * 100).toFixed(1) : 0;
                        const statItem = document.createElement('div');
                        statItem.className = 'flex items-center justify-between p-2 bg-white rounded border border-gray-200';
                        statItem.innerHTML = `
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 rounded-full" style="background-color: ${colors[index % colors.length]}"></div>
                                <span class="text-sm text-gray-700">${dimension.name}</span>
                            </div>
                            <div class="text-sm font-medium text-gray-900">
                                ${dimension.score}åˆ† (${percentage}%)
                            </div>
                        `;
                        dimensionStats.appendChild(statItem);
                    });
                }
            }

            // åº”ç”¨æ¨¡æ¿
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const templateKey = btn.dataset.template;
                    const template = rubricTemplates[templateKey];
                    if (template) {
                        rubricConfig.dimensions = template.dimensions.map((d, i) => ({
                            id: Date.now() + i,
                            name: d.name,
                            score: d.score,
                            description: d.description
                        }));
                        renderDimensionsList();
                        updateVisualization();
                        showToast('success', 'æ¨¡æ¿åº”ç”¨æˆåŠŸ', `å·²åº”ç”¨${template.name}æ¨¡æ¿`);
                    }
                });
            });

            // AIæ™ºèƒ½æ¨èåŠŸèƒ½
            const aiRecommendBtn = document.getElementById('ai-recommend-btn');
            const referenceAnswerInput = document.getElementById('reference-answer');
            const aiSuggestionsDiv = document.getElementById('ai-suggestions');
            const aiSuggestionsContent = document.getElementById('ai-suggestions-content');

            if (aiRecommendBtn) {
                aiRecommendBtn.addEventListener('click', () => {
                    const answer = referenceAnswerInput.value.trim();
                    if (!answer) {
                        showToast('warning', 'æç¤º', 'è¯·å…ˆè¾“å…¥å‚è€ƒç­”æ¡ˆ');
                        return;
                    }

                    // æ¨¡æ‹ŸAIåˆ†æ
                    const loadingHTML = '<div class="flex items-center justify-center space-x-2"><div class="w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"></div><span>AIæ­£åœ¨åˆ†æ...</span></div>';
                    aiSuggestionsContent.innerHTML = loadingHTML;
                    aiSuggestionsDiv.classList.remove('hidden');

                    setTimeout(() => {
                        // æ¨¡æ‹ŸAIæ¨èç»“æœ
                        const suggestions = [
                            'æ ¹æ®å‚è€ƒç­”æ¡ˆï¼Œå»ºè®®å¢åŠ "å²å®å‡†ç¡®"ç»´åº¦çš„æƒé‡è‡³35åˆ†',
                            'å‚è€ƒç­”æ¡ˆä¸­åˆ†ææ·±åº¦è¾ƒå¥½ï¼Œå»ºè®®æ–°å¢"æ·±åº¦åˆ†æ"ç»´åº¦',
                            'è¯­è¨€è¡¨è¾¾è¦æ±‚è¾ƒé«˜ï¼Œå»ºè®®æé«˜è‡³20åˆ†'
                        ];

                        aiSuggestionsContent.innerHTML = `
                            <ul class="space-y-2">
                                ${suggestions.map(s => `<li class="flex items-start space-x-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0"></i><span>${s}</span></li>`).join('')}
                            </ul>
                            <button id="apply-ai-suggestions-btn" class="mt-3 w-full py-2 px-4 bg-purple-500 hover:bg-purple-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center space-x-2">
                                <i data-lucide="sparkles" class="w-4 h-4"></i>
                                <span>åº”ç”¨AIå»ºè®®</span>
                            </button>
                        `;

                        lucide.createIcons();

                        // ç»‘å®šåº”ç”¨å»ºè®®æŒ‰é’®
                        const applyBtn = document.getElementById('apply-ai-suggestions-btn');
                        if (applyBtn) {
                            applyBtn.addEventListener('click', () => {
                                applyAISuggestions();
                                aiSuggestionsDiv.classList.add('hidden');
                            });
                        }
                    }, 1500);
                });
            }

            // åº”ç”¨AIå»ºè®®
            function applyAISuggestions() {
                rubricConfig.dimensions = [
                    { id: Date.now(), name: 'è§‚ç‚¹æ˜ç¡®', score: 25, description: 'è®ºç‚¹æ¸…æ™°ï¼Œç«‹åœºæ˜ç¡®' },
                    { id: Date.now() + 1, name: 'å²å®å‡†ç¡®', score: 35, description: 'å†å²äº‹å®å‡†ç¡®æ— è¯¯' },
                    { id: Date.now() + 2, name: 'æ·±åº¦åˆ†æ', score: 25, description: 'åˆ†ææ·±å…¥ï¼Œè§è§£ç‹¬åˆ°' },
                    { id: Date.now() + 3, name: 'è¯­è¨€è¡¨è¾¾', score: 15, description: 'è¯­è¨€æµç•…ï¼Œä¹¦å†™è§„èŒƒ' }
                ];
                renderDimensionsList();
                updateVisualization();
                showToast('success', 'AIå»ºè®®å·²åº”ç”¨', 'è¯„åˆ†æ ‡å‡†å·²ä¼˜åŒ–');
            }

            // æ·»åŠ ç»´åº¦
            const addDimensionBtn = document.getElementById('add-dimension-btn');
            if (addDimensionBtn) {
                addDimensionBtn.addEventListener('click', () => {
                    if (rubricConfig.dimensions.length >= 8) {
                        showToast('warning', 'æç¤º', 'è¯„åˆ†ç»´åº¦ä¸å®œè¿‡å¤šï¼Œå»ºè®®ä¸è¶…è¿‡8ä¸ª');
                        return;
                    }
                    const newId = Date.now();
                    rubricConfig.dimensions.push({
                        id: newId,
                        name: 'æ–°ç»´åº¦',
                        score: 10,
                        description: 'è¯·è¾“å…¥è¯„åˆ†è¯´æ˜'
                    });
                    renderDimensionsList();
                    updateVisualization();

                    // èšç„¦åˆ°æ–°æ·»åŠ çš„ç»´åº¦åç§°
                    setTimeout(() => {
                        const newInput = document.querySelector(`input[data-dimension-id="${newId}"].dimension-name`);
                        if (newInput) {
                            newInput.focus();
                            newInput.select();
                        }
                    }, 100);
                });
            }

            // é‡ç½®æ¨¡æ¿
            const resetTemplateBtn = document.getElementById('reset-template-btn');
            if (resetTemplateBtn) {
                resetTemplateBtn.addEventListener('click', () => {
                    if (confirm('ç¡®å®šè¦é‡ç½®ä¸ºæ ‡å‡†æ¨¡æ¿å—ï¼Ÿå½“å‰é…ç½®å°†ä¼šä¸¢å¤±ã€‚')) {
                        const template = rubricTemplates.standard;
                        rubricConfig.dimensions = template.dimensions.map((d, i) => ({
                            id: Date.now() + i,
                            name: d.name,
                            score: d.score,
                            description: d.description
                        }));
                        renderDimensionsList();
                        updateVisualization();
                        showToast('success', 'é‡ç½®æˆåŠŸ', 'å·²æ¢å¤ä¸ºæ ‡å‡†æ¨¡æ¿');
                    }
                });
            }

            // ä¿å­˜è¯„åˆ†æ ‡å‡†
            if (rubricConfigSaveBtn) {
                rubricConfigSaveBtn.addEventListener('click', () => {
                    saveRubricConfig();
                });
            }

            // ä¿å­˜è¯„åˆ†æ ‡å‡†é…ç½®
            function saveRubricConfig() {
                const total = rubricConfig.dimensions.reduce((sum, d) => sum + d.score, 0);
                if (total !== 100) {
                    showToast('warning', 'è¯„åˆ†æ ‡å‡†æ— æ•ˆ', `æ€»åˆ†å¿…é¡»ä¸º100åˆ†ï¼Œå½“å‰ä¸º${total}åˆ†`);
                    return;
                }

                localStorage.setItem('rubricConfig', JSON.stringify(rubricConfig));
                showToast('success', 'ä¿å­˜æˆåŠŸ', 'è¯„åˆ†æ ‡å‡†å·²ä¿å­˜');
                closeRubricConfigModal();

                // å¯ä»¥åœ¨è¿™é‡Œè§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œé€šçŸ¥å…¶ä»–ç»„ä»¶
                const event = new CustomEvent('rubricConfigSaved', { detail: rubricConfig });
                document.dispatchEvent(event);
            }

            // åŠ è½½è¯„åˆ†æ ‡å‡†é…ç½®
            function loadRubricConfig() {
                const saved = localStorage.getItem('rubricConfig');
                if (saved) {
                    try {
                        rubricConfig = JSON.parse(saved);
                    } catch (e) {
                        console.error('åŠ è½½è¯„åˆ†æ ‡å‡†å¤±è´¥:', e);
                    }
                }
            }

            // æ›´æ–°è¯„åˆ†ç»“æœæ˜¾ç¤ºï¼ˆåŸºäºè¯„åˆ†ç»†åˆ™ï¼‰
            function updateScoringResults() {
                // æ¨¡æ‹ŸAIè¯„åˆ†æ•°æ®
                const aiScores = {
                    'è§‚ç‚¹æ˜ç¡®': 28,
                    'å²å®å‡†ç¡®': 25,
                    'è®ºè¿°å……åˆ†': 22,
                    'è¯­è¨€è¡¨è¾¾': 10
                };

                // åŠ¨æ€ç”Ÿæˆè¯„åˆ†ç†ç”±
                const reasons = {
                    'è§‚ç‚¹æ˜ç¡®': 'è®ºç‚¹æ¸…æ™°ï¼Œç«‹åœºæ˜ç¡®ï¼Œèƒ½å¤Ÿå‡†ç¡®æŠŠæ¡é¢˜ç›®è¦æ±‚',
                    'å²å®å‡†ç¡®': 'å†å²äº‹å®å‡†ç¡®æ— è¯¯ï¼Œå¼•ç”¨ææ–™æ°å½“',
                    'è®ºè¿°å……åˆ†': 'è®ºæ®å……å®ï¼Œé€»è¾‘ä¸¥å¯†ï¼Œè®ºè¯æœ‰åŠ›',
                    'è¯­è¨€è¡¨è¾¾': 'è¡¨è¾¾æµç•…ï¼Œä¹¦å†™è§„èŒƒï¼Œæ¡ç†æ¸…æ™°'
                };

                // æ›´æ–°åˆ†é¡¹å¾—åˆ†
                const dimensionScoresContainer = document.getElementById('dimension-scores');
                if (dimensionScoresContainer && rubricConfig.dimensions) {
                    dimensionScoresContainer.innerHTML = '';
                    let totalScore = 0;

                    rubricConfig.dimensions.forEach(dimension => {
                        const score = aiScores[dimension.name] || 0;
                        const percentage = (score / dimension.score) * 100;
                        totalScore += score;

                        // åŠ¨æ€ç”Ÿæˆé¢œè‰²
                        const colors = ['blue', 'green', 'purple', 'orange', 'red', 'indigo'];
                        const colorIndex = rubricConfig.dimensions.indexOf(dimension) % colors.length;
                        const colorClass = colors[colorIndex];

                        const scoreItem = document.createElement('div');
                        scoreItem.className = 'flex items-center justify-between py-1';
                        scoreItem.innerHTML = `
                            <span class="text-sm text-gray-700">${dimension.name}</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-16 bg-gray-200 rounded-full h-1.5">
                                    <div class="bg-${colorClass}-500 h-1.5 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
                                </div>
                                <span class="text-sm font-medium text-gray-800 min-w-[45px] text-right">${score}/${dimension.score}</span>
                            </div>
                        `;
                        dimensionScoresContainer.appendChild(scoreItem);
                    });

                    // æ›´æ–°æ€»åˆ†
                    const totalScoreElement = document.getElementById('total-score');
                    if (totalScoreElement) {
                        const maxTotal = rubricConfig.dimensions.reduce((sum, d) => sum + d.score, 0);
                        totalScoreElement.innerHTML = `${totalScore}<span class="text-xl text-blue-600">/${maxTotal}</span>`;
                    }
                }

                // æ›´æ–°è¯„åˆ†ç†ç”±
                const reasonsContainer = document.getElementById('scoring-reasons');
                if (reasonsContainer && rubricConfig.dimensions) {
                    reasonsContainer.innerHTML = '';
                    rubricConfig.dimensions.forEach(dimension => {
                        const colorClasses = {
                            'è§‚ç‚¹æ˜ç¡®': 'text-blue-600',
                            'å²å®å‡†ç¡®': 'text-green-600',
                            'è®ºè¿°å……åˆ†': 'text-purple-600',
                            'è¯­è¨€è¡¨è¾¾': 'text-orange-600'
                        };

                        const reasonItem = document.createElement('div');
                        reasonItem.className = 'flex items-start space-x-2';
                        reasonItem.innerHTML = `
                            <span class="font-medium ${colorClasses[dimension.name] || 'text-gray-600'} min-w-[80px]">${dimension.name}:</span>
                            <span>${reasons[dimension.name] || dimension.description || 'åŸºäºè¯„åˆ†ç»†åˆ™è‡ªåŠ¨ç”Ÿæˆ'}</span>
                        `;
                        reasonsContainer.appendChild(reasonItem);
                    });
                }
            }

            // ç›‘å¬è¯„åˆ†æ ‡å‡†é…ç½®ä¿å­˜äº‹ä»¶
            document.addEventListener('rubricConfigSaved', function(event) {
                console.log('è¯„åˆ†æ ‡å‡†å·²ä¿å­˜ï¼Œæ›´æ–°è¯„åˆ†ç»“æœ');
                updateScoringResults();
            });

            // åˆå§‹åŒ–è¯„åˆ†ç»“æœï¼ˆé¡µé¢åŠ è½½æ—¶ï¼‰
            function initScoringResults() {
                loadRubricConfig();
                updateScoringResults();
            }

            // ========== äººå·¥å¤æ ¸åŠŸèƒ½ ==========
            // å¤æ ¸æ•°æ®ç»“æ„ï¼ˆé¢˜ç›®ä¸­å¿ƒåŒ–ï¼‰
            let reviewData = {
                questions: {
                    'q_20241109_001': {
                        questionId: 'q_20241109_001',
                        questionTitle: 'é¢˜ç›® 1 - å†å²è®ºè¿°é¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending', // pending/confirmed/modified
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_002': {
                        questionId: 'q_20241109_002',
                        questionTitle: 'é¢˜ç›® 2 - ææ–™åˆ†æé¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_003': {
                        questionId: 'q_20241109_003',
                        questionTitle: 'é¢˜ç›® 3 - ç®€ç­”é¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_004': {
                        questionId: 'q_20241109_004',
                        questionTitle: 'é¢˜ç›® 4 - è®¡ç®—é¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_005': {
                        questionId: 'q_20241109_005',
                        questionTitle: 'é¢˜ç›® 5 - åº”ç”¨é¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_006': {
                        questionId: 'q_20241109_006',
                        questionTitle: 'é¢˜ç›® 6 - è¯æ˜é¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_007': {
                        questionId: 'q_20241109_007',
                        questionTitle: 'é¢˜ç›® 7 - åˆ†æé¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_008': {
                        questionId: 'q_20241109_008',
                        questionTitle: 'é¢˜ç›® 8 - ç»¼åˆé¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_009': {
                        questionId: 'q_20241109_009',
                        questionTitle: 'é¢˜ç›® 9 - è§£ç­”é¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_010': {
                        questionId: 'q_20241109_010',
                        questionTitle: 'é¢˜ç›® 10 - æ€è€ƒé¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_011': {
                        questionId: 'q_20241109_011',
                        questionTitle: 'é¢˜ç›® 11 - æ¨ç†é¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_012': {
                        questionId: 'q_20241109_012',
                        questionTitle: 'é¢˜ç›® 12 - åˆ›æ–°é¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_013': {
                        questionId: 'q_20241109_013',
                        questionTitle: 'é¢˜ç›® 13 - æ¢ç©¶é¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_014': {
                        questionId: 'q_20241109_014',
                        questionTitle: 'é¢˜ç›® 14 - å®éªŒé¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    },
                    'q_20241109_015': {
                        questionId: 'q_20241109_015',
                        questionTitle: 'é¢˜ç›® 15 - æ€»ç»“é¢˜',
                        currentScore: 0,
                        aiScore: 0,
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: Date.now(),
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    }
                },
                currentQuestionId: 'q_20241109_001',
                totalQuestions: 15,
                stats: {
                    totalReviewed: 0,
                    pendingReview: 15,
                    modifiedCount: 0
                }
            };

            // ä»localStorageåŠ è½½å¤æ ¸æ•°æ®
            function loadReviewData() {
                // ä¼˜å…ˆä½¿ç”¨æ–°çš„keyï¼Œå…¼å®¹æ—§çš„key
                const saved = localStorage.getItem('aiReviewData') || localStorage.getItem('reviewData');
                if (saved) {
                    reviewData = JSON.parse(saved);
                    // ç¡®ä¿totalQuestionså­—æ®µå­˜åœ¨
                    if (!reviewData.totalQuestions) {
                        reviewData.totalQuestions = Object.keys(reviewData.questions).length;
                    }
                    console.log('å·²åŠ è½½å¤æ ¸æ•°æ®');
                }
            }

            // ä¿å­˜å¤æ ¸æ•°æ®åˆ°localStorage
            function saveReviewData() {
                localStorage.setItem('aiReviewData', JSON.stringify(reviewData));
                showToast('success', 'ä¿å­˜æˆåŠŸ', 'å¤æ ¸è¿›åº¦å·²è‡ªåŠ¨ä¿å­˜');
            }

            // ä»æ™ºå­¦ç½‘é¡µé¢æ™ºèƒ½æå–å½“å‰é¢˜ç›®ä¿¡æ¯
            function getCurrentQuestionInfo() {
                // æå–é¢˜ç›®IDï¼ˆä»URLæˆ–é¡µé¢å…ƒç´ ï¼‰
                const questionId = extractQuestionId();

                // æå–é¢˜ç›®å†…å®¹ï¼ˆå°è¯•å¤šç§é€‰æ‹©å™¨ï¼‰
                const questionTitleSelectors = [
                    '.question-title',
                    '.question-text h3',
                    '.question-header h3',
                    'h3.question',
                    '.topic-title',
                    '.subject-title',
                    '[class*="title"]'
                ];

                let questionTitle = 'é¢˜ç›®';
                for (const selector of questionTitleSelectors) {
                    const element = document.querySelector(selector);
                    if (element && element.innerText.trim()) {
                        questionTitle = element.innerText.trim();
                        break;
                    }
                }

                // æå–å½“å‰å¾—åˆ†ï¼ˆå°è¯•å¤šç§é€‰æ‹©å™¨ï¼‰
                const scoreSelectors = [
                    'input[name*="score"]',
                    'input[id*="score"]',
                    '.score-input input',
                    '.score-input',
                    '[class*="score"] input'
                ];

                let currentScore = 0;
                for (const selector of scoreSelectors) {
                    const element = document.querySelector(selector);
                    if (element) {
                        const value = element.value || element.getAttribute('value');
                        const score = parseFloat(value);
                        if (!isNaN(score)) {
                            currentScore = score;
                            break;
                        }
                    }
                }

                // æå–é¢˜ç›®ç±»å‹
                const typeSelectors = [
                    '.question-type',
                    '.q-type',
                    '[class*="type"]'
                ];

                let questionType = 'æœªçŸ¥ç±»å‹';
                for (const selector of typeSelectors) {
                    const element = document.querySelector(selector);
                    if (element && element.innerText.trim()) {
                        questionType = element.innerText.trim();
                        break;
                    }
                }

                // æå–é¢˜ç›®æ»¡åˆ†
                const maxScoreSelectors = [
                    '.max-score',
                    '.full-score',
                    '.question-score',
                    '[class*="score"] .max'
                ];

                let questionScore = 5; // é»˜è®¤åˆ†å€¼
                for (const selector of maxScoreSelectors) {
                    const element = document.querySelector(selector);
                    if (element) {
                        const text = element.innerText;
                        const match = text.match(/(\d+\.?\d*)/);
                        if (match) {
                            questionScore = parseFloat(match[1]);
                            break;
                        }
                    }
                }

                return {
                    questionId,
                    questionTitle,
                    currentScore,
                    questionType,
                    questionScore,
                    timestamp: Date.now()
                };
            }

            // æå–é¢˜ç›®IDçš„è¾…åŠ©å‡½æ•°
            function extractQuestionId() {
                // æ–¹æ³•1: å°è¯•ä»URLä¸­æå–
                const urlParams = new URLSearchParams(window.location.search);
                const qid = urlParams.get('qid') || urlParams.get('questionId') || urlParams.get('id');

                if (qid) return `q_${qid}`;

                // æ–¹æ³•2: å°è¯•ä»é¡µé¢å…ƒç´ ä¸­æå–
                const selectors = [
                    '[data-question-id]',
                    '.question-id',
                    '#question-id',
                    '.qid',
                    '[id*="question"]',
                    '[class*="question"]'
                ];

                for (const selector of selectors) {
                    const element = document.querySelector(selector);
                    if (element) {
                        const value = element.getAttribute('data-question-id') ||
                                     element.innerText.trim() ||
                                     element.value;
                        if (value) {
                            return `q_${value}`;
                        }
                    }
                }

                // æ–¹æ³•3: ç”ŸæˆåŸºäºå½“å‰æ—¶é—´å’Œé¡µé¢çš„å”¯ä¸€ID
                return `q_${Date.now()}`;
            }

            // æ›´æ–°å¤æ ¸ç•Œé¢æ˜¾ç¤ºï¼ˆé¢˜ç›®ä¸­å¿ƒåŒ–ï¼‰
            function updateReviewInterface() {
                const question = reviewData.questions[reviewData.currentQuestionId];
                if (!question) return;

                // è·å–æ™ºå­¦ç½‘é¡µé¢çš„å½“å‰é¢˜ç›®ä¿¡æ¯
                const currentInfo = getCurrentQuestionInfo();

                // æ›´æ–°é¢˜ç›®ä¿¡æ¯
                document.getElementById('reviewQuestionTitle').textContent = question.questionTitle;
                document.getElementById('reviewQuestionId').textContent = question.questionId;
                document.getElementById('reviewGradingTime').textContent = formatTime(question.timestamp);

                // æ›´æ–°é¢˜ç›®ç±»å‹ï¼ˆå¦‚æœæœ‰å¯¹åº”å…ƒç´ ï¼‰
                const questionTypeElement = document.getElementById('reviewQuestionType');
                if (questionTypeElement) {
                    questionTypeElement.textContent = currentInfo.questionType || 'æœªçŸ¥ç±»å‹';
                }

                // æ›´æ–°å¤æ ¸çŠ¶æ€
                document.getElementById('ai-suggestion').textContent = `${question.aiScore}åˆ†`;
                document.getElementById('current-score').textContent = `${question.currentScore}åˆ†`;

                // æ›´æ–°åˆ†æ•°è¾“å…¥æ¡†
                const scoreInput = document.getElementById('score-input');
                if (scoreInput) {
                    scoreInput.value = question.currentScore;

                    // è·å–æ»¡åˆ†åˆ†å€¼å¹¶æ›´æ–°è¾“å…¥æ¡†çš„maxå±æ€§
                    const maxScore = currentInfo.maxScore || 100;
                    scoreInput.max = maxScore;

                    // æ›´æ–°æ»¡åˆ†æ˜¾ç¤º
                    const maxScoreDisplay = scoreInput.parentElement.querySelector('span.text-sm.text-gray-500');
                    if (maxScoreDisplay) {
                        maxScoreDisplay.textContent = `/ ${maxScore}`;
                    }
                }

                // æ›´æ–°å¤æ ¸æ¬¡æ•°
                const reviewCountElement = document.getElementById('review-count');
                if (reviewCountElement) {
                    reviewCountElement.textContent = `${question.reviewRecord.confirmations + question.reviewRecord.modifications}æ¬¡`;
                }

                // æ›´æ–°å¤æ ¸è®°å½•
                updateReviewHistory(question);

                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                updateReviewButtonStates();

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateReviewStats();
            }

            // æ ¼å¼åŒ–æ—¶é—´
            function formatTime(timestamp) {
                const date = new Date(timestamp);
                return date.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            // æ›´æ–°å¤æ ¸è®°å½•
            function updateReviewHistory(question) {
                const reviewList = document.getElementById('review-list');
                if (!reviewList) return;

                reviewList.innerHTML = '';

                const history = [
                    { label: 'ç¡®è®¤æ¬¡æ•°', value: question.reviewRecord.confirmations },
                    { label: 'è°ƒæ•´æ¬¡æ•°', value: question.reviewRecord.modifications },
                    { label: 'å¤æ ¸æ•™å¸ˆ', value: question.reviewRecord.lastReviewer }
                ];

                history.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'py-1 text-sm text-gray-600';
                    li.textContent = `${item.label}: ${item.value}`;
                    reviewList.appendChild(li);
                });
            }

            // æ›´æ–°å¤æ ¸ç»Ÿè®¡
            function updateReviewStats() {
                const questions = Object.values(reviewData.questions);
                const total = reviewData.totalQuestions || questions.length;
                const pending = questions.filter(q => q.status === 'pending').length;
                const completed = questions.filter(q => q.status === 'confirmed' || q.status === 'modified').length;
                const modified = questions.filter(q => q.status === 'modified').length;

                reviewData.stats.totalReviewed = completed;
                reviewData.stats.pendingReview = pending;
                reviewData.stats.modifiedCount = modified;

                // æ›´æ–°è¿›åº¦æ¡æ–‡æœ¬ (å¤§å·æ˜¾ç¤º)
                const progressText = document.getElementById('reviewProgressText');
                if (progressText) {
                    progressText.textContent = `${completed}/${total}`;
                }

                // æ›´æ–°è¿›åº¦æ¡ç™¾åˆ†æ¯”
                const progressPercentage = document.getElementById('reviewProgressPercentage');
                if (progressPercentage) {
                    const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                    progressPercentage.textContent = `${percentage}%`;
                }

                // æ›´æ–°è¿›åº¦æ¡å®½åº¦å’ŒåŠ¨ç”»
                const progressBar = document.getElementById('reviewProgressBar');
                if (progressBar) {
                    const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                    progressBar.style.width = `${percentage}%`;

                    // æ ¹æ®è¿›åº¦è®¾ç½®ä¸åŒçš„é¢œè‰²
                    if (percentage === 100) {
                        progressBar.className = 'bg-gradient-to-r from-green-500 to-green-600 h-4 rounded-full transition-all duration-700 ease-out flex items-center justify-end pr-2';
                    } else if (percentage >= 50) {
                        progressBar.className = 'bg-gradient-to-r from-blue-500 to-blue-600 h-4 rounded-full transition-all duration-700 ease-out flex items-center justify-end pr-2';
                    } else {
                        progressBar.className = 'bg-gradient-to-r from-yellow-500 to-yellow-600 h-4 rounded-full transition-all duration-700 ease-out flex items-center justify-end pr-2';
                    }
                }

                // æ›´æ–°è®¡æ•°ç»Ÿè®¡
                const completedCount = document.getElementById('completedCount');
                if (completedCount) {
                    completedCount.textContent = completed;
                }

                const pendingCount = document.getElementById('pendingCount');
                if (pendingCount) {
                    pendingCount.textContent = pending;
                }

                const modifiedCount = document.getElementById('modifiedCount');
                if (modifiedCount) {
                    modifiedCount.textContent = modified;
                }

                // è®¡ç®—å¹¶æ›´æ–°é¢„è®¡å®Œæˆæ—¶é—´
                const estimatedTime = document.getElementById('estimatedTime');
                if (estimatedTime && pending > 0) {
                    // å‡è®¾æ¯é¢˜éœ€è¦1-2åˆ†é’Ÿï¼Œè¿™é‡Œä½¿ç”¨1.5åˆ†é’Ÿçš„å¹³å‡å€¼
                    const avgTimePerQuestion = 1.5; // åˆ†é’Ÿ
                    const totalEstimatedMinutes = Math.round(pending * avgTimePerQuestion);

                    if (totalEstimatedMinutes < 60) {
                        estimatedTime.textContent = `${totalEstimatedMinutes} åˆ†é’Ÿ`;
                    } else {
                        const hours = Math.floor(totalEstimatedMinutes / 60);
                        const minutes = totalEstimatedMinutes % 60;
                        estimatedTime.textContent = `${hours} å°æ—¶ ${minutes} åˆ†é’Ÿ`;
                    }
                } else if (estimatedTime) {
                    estimatedTime.textContent = 'å³å°†å®Œæˆ';
                }
            }

            // æ›´æ–°æŒ‰é’®çŠ¶æ€ï¼ˆé¢˜ç›®ä¸­å¿ƒåŒ–ï¼‰
            function updateReviewButtonStates() {
                const question = reviewData.questions[reviewData.currentQuestionId];
                if (!question) return;

                const skipBtn = document.getElementById('skip-review');
                const saveBtn = document.getElementById('save-review');

                // æŒ‰é’®é€»è¾‘ï¼šè·³è¿‡å¤æ ¸å’Œä¿å­˜è®°å½•æŒ‰é’®å§‹ç»ˆå¯ç”¨
                if (skipBtn) {
                    skipBtn.disabled = false;
                }
                if (saveBtn) {
                    saveBtn.disabled = false;
                }

                // æŒ‰é’®æ ·å¼
                [skipBtn, saveBtn].forEach(btn => {
                    if (btn && btn.disabled) {
                        btn.classList.add('opacity-50', 'cursor-not-allowed');
                    } else if (btn) {
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                });
            }

            // ç¡®è®¤åˆ†æ•°
            function confirmScore() {
                const question = reviewData.questions[reviewData.currentQuestionId];
                if (!question) return;

                if (question.status === 'pending') {
                    // ä»åˆ†æ•°è¾“å…¥æ¡†è·å–åˆ†æ•°
                    const scoreInput = document.getElementById('score-input');
                    if (scoreInput) {
                        const score = parseFloat(scoreInput.value);
                        // è·å–æ»¡åˆ†åˆ†å€¼
                        const currentInfo = getCurrentQuestionInfo();
                        const maxScore = currentInfo.maxScore || 100;

                        if (!isNaN(score) && score >= 0 && score <= maxScore) {
                            question.currentScore = score;
                        } else {
                            if (isNaN(score) || score < 0) {
                                showToast('error', 'è¾“å…¥æ— æ•ˆ', 'è¯·è¾“å…¥æœ‰æ•ˆçš„åˆ†æ•°');
                            } else if (score > maxScore) {
                                showToast('error', 'è¾“å…¥æ— æ•ˆ', `åˆ†æ•°ä¸èƒ½è¶…è¿‡ ${maxScore} åˆ†`);
                            }
                            return;
                        }
                    }

                    question.status = 'confirmed';
                    question.teacherScore = question.currentScore;
                    question.reviewRecord.confirmations++;
                    question.timestamp = Date.now();

                    // åŒæ­¥åˆ†æ•°åˆ°æ™ºå­¦ç½‘å¾—åˆ†æ¡†
                    const syncSuccess = scoreSyncEngine.syncScoreToZhixue(question.currentScore, false);
                    if (syncSuccess) {
                        showToast('success', 'å¤æ ¸å®Œæˆ', `å·²ç¡®è®¤"${question.questionTitle}"çš„è¯„åˆ†ï¼Œåˆ†æ•°å·²åŒæ­¥åˆ°æ™ºå­¦ç½‘`);
                    } else {
                        showToast('warning', 'å¤æ ¸å®Œæˆ', `å·²ç¡®è®¤"${question.questionTitle}"çš„è¯„åˆ†ï¼ˆåŒæ­¥å¤±è´¥ï¼‰`);
                    }

                    updateReviewInterface();
                    saveReviewData();

                    // æ›´æ–°è¯„åˆ†è®°å½•åˆ—è¡¨
                    loadReviewRecords();
                }
            }

            // è°ƒæ•´åˆ†æ•°
            function adjustScore() {
                const question = reviewData.questions[reviewData.currentQuestionId];
                if (!question) return;

                if (question.status === 'pending') {
                    // ä»åˆ†æ•°è¾“å…¥æ¡†è·å–åˆ†æ•°
                    const scoreInput = document.getElementById('score-input');
                    if (scoreInput) {
                        const score = parseFloat(scoreInput.value);
                        // è·å–æ»¡åˆ†åˆ†å€¼
                        const currentInfo = getCurrentQuestionInfo();
                        const maxScore = currentInfo.maxScore || 100;

                        if (!isNaN(score) && score >= 0 && score <= maxScore) {
                            question.currentScore = score;
                            question.status = 'modified';
                            question.teacherScore = score;
                            question.reviewRecord.modifications++;
                            question.timestamp = Date.now();

                            // åŒæ­¥åˆ†æ•°åˆ°æ™ºå­¦ç½‘å¾—åˆ†æ¡†
                            const syncSuccess = scoreSyncEngine.syncScoreToZhixue(score, false);
                            if (syncSuccess) {
                                showToast('success', 'è°ƒæ•´å®Œæˆ', `å·²å°†"${question.questionTitle}"è°ƒæ•´ä¸º ${score} åˆ†ï¼Œåˆ†æ•°å·²åŒæ­¥åˆ°æ™ºå­¦ç½‘`);
                            } else {
                                showToast('warning', 'è°ƒæ•´å®Œæˆ', `å·²å°†"${question.questionTitle}"è°ƒæ•´ä¸º ${score} åˆ†ï¼ˆåŒæ­¥å¤±è´¥ï¼‰`);
                            }

                            updateReviewInterface();
                            saveReviewData();

                            // æ›´æ–°è¯„åˆ†è®°å½•åˆ—è¡¨
                            loadReviewRecords();
                        } else {
                            if (isNaN(score) || score < 0) {
                                showToast('error', 'è¾“å…¥æ— æ•ˆ', 'è¯·è¾“å…¥æœ‰æ•ˆçš„åˆ†æ•°');
                            } else if (score > maxScore) {
                                showToast('error', 'è¾“å…¥æ— æ•ˆ', `åˆ†æ•°ä¸èƒ½è¶…è¿‡ ${maxScore} åˆ†`);
                            }
                        }
                    }
                } else {
                    // å·²ç¡®è®¤/å·²è°ƒæ•´çŠ¶æ€ä¸‹ï¼Œç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ
                    showToast('info', 'æŸ¥çœ‹ç­”æ¡ˆ', 'å‚è€ƒç­”æ¡ˆåŠŸèƒ½å¼€å‘ä¸­');
                }
            }

            // è·³è¿‡å¤æ ¸
            function skipReview() {
                const question = reviewData.questions[reviewData.currentQuestionId];
                if (!question) return;

                question.status = 'pending'; // ä¿æŒå¾…ç¡®è®¤çŠ¶æ€
                question.timestamp = Date.now();

                updateReviewInterface();
                saveReviewData();

                showToast('warning', 'å·²è·³è¿‡', `å·²è·³è¿‡"${question.questionTitle}"çš„å¤æ ¸`);
            }

            // ä¿å­˜è®°å½•
            function saveReviewRecord() {
                const question = reviewData.questions[reviewData.currentQuestionId];
                if (!question) return;

                saveReviewData();
                showToast('success', 'ä¿å­˜æˆåŠŸ', 'å¤æ ¸è®°å½•å·²ä¿å­˜åˆ°æœ¬åœ°');

                // æ›´æ–°è¯„åˆ†è®°å½•åˆ—è¡¨
                loadReviewRecords();
            }

            // åˆå§‹åŒ–äººå·¥å¤æ ¸åŠŸèƒ½ï¼ˆé¢˜ç›®ä¸­å¿ƒåŒ–ï¼‰
            function initReviewInterface() {
                loadReviewData();
                updateReviewInterface();
                updateReviewStats(); // åˆå§‹åŒ–è¿›åº¦æ¡

                // ç»‘å®šæŒ‰é’®äº‹ä»¶
                const refreshBtn = document.getElementById('refresh-question');
                const skipBtn = document.getElementById('skip-review');
                const saveBtn = document.getElementById('save-review');
                const scoreInput = document.getElementById('score-input');
                const prevQuestionBtn = document.getElementById('prev-question');
                const nextQuestionBtn = document.getElementById('next-question');

                if (refreshBtn) refreshBtn.onclick = refreshCurrentQuestion;
                if (skipBtn) skipBtn.onclick = skipReview;
                if (saveBtn) saveBtn.onclick = saveReviewRecord;

                // ç»‘å®šåˆ†æ•°è¾“å…¥æ¡†äº‹ä»¶
                if (scoreInput) {
                    scoreInput.addEventListener('change', handleScoreInputChange);
                    scoreInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            // å¦‚æœæŒ‰Enteré”®ï¼Œç¡®è®¤åˆ†æ•°
                            const question = reviewData.questions[reviewData.currentQuestionId];
                            if (question && question.status === 'pending') {
                                confirmScore();
                            }
                        }
                    });
                }

                // ç»‘å®šå¯¼èˆªæŒ‰é’®äº‹ä»¶
                if (prevQuestionBtn) prevQuestionBtn.onclick = navigateToPreviousQuestion;
                if (nextQuestionBtn) nextQuestionBtn.onclick = navigateToNextQuestion;
            }

            // å¤„ç†åˆ†æ•°è¾“å…¥å˜åŒ–
            function handleScoreInputChange() {
                const scoreInput = document.getElementById('score-input');
                if (!scoreInput) return;

                const score = parseFloat(scoreInput.value);
                // è·å–æ™ºå­¦ç½‘é¡µé¢çš„å½“å‰é¢˜ç›®ä¿¡æ¯ä»¥è·å–æ»¡åˆ†åˆ†å€¼
                const currentInfo = getCurrentQuestionInfo();
                const maxScore = currentInfo.maxScore || 100; // å¦‚æœæ²¡æœ‰è·å–åˆ°æ»¡åˆ†ï¼Œé»˜è®¤ä¸º100

                if (!isNaN(score) && score >= 0 && score <= maxScore) {
                    const question = reviewData.questions[reviewData.currentQuestionId];
                    if (question) {
                        question.currentScore = score;
                        updateReviewInterface();
                    }
                } else {
                    // è¾“å…¥æ— æ•ˆï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                    if (isNaN(score) || score < 0) {
                        showToast('error', 'è¾“å…¥æ— æ•ˆ', 'è¯·è¾“å…¥æœ‰æ•ˆçš„åˆ†æ•°');
                    } else if (score > maxScore) {
                        showToast('error', 'è¾“å…¥æ— æ•ˆ', `åˆ†æ•°ä¸èƒ½è¶…è¿‡ ${maxScore} åˆ†`);
                    }

                    // é‡ç½®ä¸ºä¹‹å‰å€¼
                    const question = reviewData.questions[reviewData.currentQuestionId];
                    if (question) {
                        scoreInput.value = question.currentScore;
                    }
                }
            }

            // å¯¼èˆªåˆ°ä¸Šä¸€é¢˜
            function navigateToPreviousQuestion() {
                const questionIds = Object.keys(reviewData.questions);
                const currentIndex = questionIds.indexOf(reviewData.currentQuestionId);

                if (currentIndex > 0) {
                    reviewData.currentQuestionId = questionIds[currentIndex - 1];
                    updateReviewInterface();
                    saveReviewData();
                    showToast('info', 'å¯¼èˆªæˆåŠŸ', `å·²è·³è½¬åˆ°ä¸Šä¸€é¢˜ï¼š${reviewData.questions[reviewData.currentQuestionId].questionTitle}`);
                } else {
                    showToast('warning', 'å¯¼èˆªæç¤º', 'å·²ç»æ˜¯ç¬¬ä¸€é¢˜');
                }
            }

            // å¯¼èˆªåˆ°ä¸‹ä¸€é¢˜
            function navigateToNextQuestion() {
                const questionIds = Object.keys(reviewData.questions);
                const currentIndex = questionIds.indexOf(reviewData.currentQuestionId);

                if (currentIndex < questionIds.length - 1) {
                    reviewData.currentQuestionId = questionIds[currentIndex + 1];
                    updateReviewInterface();
                    saveReviewData();
                    showToast('info', 'å¯¼èˆªæˆåŠŸ', `å·²è·³è½¬åˆ°ä¸‹ä¸€é¢˜ï¼š${reviewData.questions[reviewData.currentQuestionId].questionTitle}`);
                } else {
                    showToast('warning', 'å¯¼èˆªæç¤º', 'å·²ç»æ˜¯æœ€åä¸€é¢˜');
                }
            }

            // ä»æ™ºå­¦ç½‘é¡µé¢åˆ·æ–°å½“å‰é¢˜ç›®ä¿¡æ¯
            function refreshCurrentQuestion() {
                const currentInfo = getCurrentQuestionInfo();
                const questionId = currentInfo.questionId;

                // å¦‚æœé¢˜ç›®ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º
                if (!reviewData.questions[questionId]) {
                    reviewData.questions[questionId] = {
                        questionId: questionId,
                        questionTitle: currentInfo.questionTitle,
                        currentScore: currentInfo.currentScore,
                        aiScore: currentInfo.currentScore, // å‡è®¾AIåˆ†æ•°ç­‰äºå½“å‰åˆ†æ•°
                        teacherScore: 0,
                        status: 'pending',
                        timestamp: currentInfo.timestamp,
                        reviewRecord: {
                            confirmations: 0,
                            modifications: 0,
                            lastReviewer: 'teacher_1'
                        }
                    };
                    // æ›´æ–°æ€»é¢˜ç›®æ•°
                    reviewData.totalQuestions = Object.keys(reviewData.questions).length;
                } else {
                    // æ›´æ–°ç°æœ‰é¢˜ç›®ä¿¡æ¯
                    const question = reviewData.questions[questionId];
                    question.currentScore = currentInfo.currentScore;
                    question.questionTitle = currentInfo.questionTitle;
                    question.timestamp = currentInfo.timestamp;
                }

                // è®¾ç½®ä¸ºå½“å‰é¢˜ç›®
                reviewData.currentQuestionId = questionId;

                // æ›´æ–°ç•Œé¢
                updateReviewInterface();
                saveReviewData();

                showToast('success', 'åˆ·æ–°æˆåŠŸ', `å·²è·å–å½“å‰é¢˜ç›®ä¿¡æ¯ï¼š${currentInfo.questionTitle}`);
            }

            // å¯¼å‡ºå¤æ ¸æŠ¥å‘Š
            function exportReviewReport() {
                showToast('info', 'æç¤º', 'å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­');
            }

            // ========== Tab åˆ‡æ¢åŠŸèƒ½ ==========
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            console.log('Tab buttons found:', tabButtons.length);
            console.log('Tab contents found:', tabContents.length);

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    try {
                        const targetTab = button.getAttribute('data-tab');
                        console.log('Tab clicked:', targetTab);

                        // é‡ç½®æ‰€æœ‰æŒ‰é’®æ ·å¼
                        tabButtons.forEach(btn => {
                            btn.classList.remove('active', 'bg-white', 'text-blue-600', 'shadow-sm', 'border-blue-200');
                            btn.classList.add('text-gray-700', 'border-transparent');
                        });

                        // éšè—æ‰€æœ‰å†…å®¹ï¼ˆç§»é™¤æ‰€æœ‰åŠ¨ç”»ç±»é¿å…å†²çªï¼‰
                        tabContents.forEach(content => {
                            content.classList.add('hidden');
                            content.classList.remove('slide-in', 'scale-in', 'fade-in');
                        });

                        // æ¿€æ´»å½“å‰æŒ‰é’®
                        button.classList.add('active', 'bg-white', 'text-blue-600', 'shadow-sm', 'border-blue-200');
                        button.classList.remove('text-gray-700', 'border-transparent');

                        // æ˜¾ç¤ºå¯¹åº”å†…å®¹
                        const targetContent = document.getElementById(`tab-content-${targetTab}`);
                        console.log('Target content found:', targetContent);

                        if (targetContent) {
                            targetContent.classList.remove('hidden');

                            // æ ¹æ®é€‰é¡¹å¡ç±»å‹æ‰§è¡Œç›¸åº”æ“ä½œ
                            if (targetTab === 'review') {
                                console.log('Initializing review interface...');
                                // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿DOMå®Œå…¨æ˜¾ç¤º
                                setTimeout(() => {
                                    if (typeof initReviewInterface === 'function') {
                                        initReviewInterface();
                                        // è‡ªåŠ¨åˆ·æ–°å½“å‰é¢˜ç›®ä¿¡æ¯
                                        if (typeof refreshCurrentQuestion === 'function') {
                                            refreshCurrentQuestion();
                                        }
                                    }
                                }, 100);
                            } else if (targetTab === 'analysis') {
                                // å»¶è¿Ÿåˆå§‹åŒ–å›¾è¡¨ï¼Œç¡®ä¿tabå†…å®¹å¯è§
                                setTimeout(() => {
                                    updateStatistics();
                                    initChart();
                                }, 200);
                            } else if (targetTab === 'grading') {
                                // æ™ºèƒ½é˜…å·æ¨¡å—åˆ‡æ¢æ—¶è‡ªåŠ¨åˆ·æ–°æ•°æ®
                                setTimeout(() => {
                                    // åˆ·æ–°è¯„åˆ†è®°å½•
                                    if (typeof loadReviewRecords === 'function') {
                                        loadReviewRecords();
                                    }
                                    // åˆ·æ–°è¯„åˆ†ç»“æœ
                                    if (typeof updateScoringResults === 'function') {
                                        updateScoringResults();
                                    }
                                }, 100);
                            }
                        } else {
                            console.error('Content not found for tab:', targetTab);
                            showToast('error', 'åˆ‡æ¢å¤±è´¥', 'æ‰¾ä¸åˆ°é€‰é¡¹å¡å†…å®¹: ' + targetTab);
                        }
                    } catch (error) {
                        console.error('Tab switch error:', error);
                        showToast('error', 'åˆ‡æ¢å¤±è´¥', 'é€‰é¡¹å¡åˆ‡æ¢æ—¶å‘ç”Ÿé”™è¯¯: ' + error.message);
                    }
                });
            });

            // å­—æ•°ç»Ÿè®¡åŠŸèƒ½
            const rubricContent = document.getElementById('rubric-content');
            const charCount = document.getElementById('char-count');

            rubricContent.addEventListener('input', () => {
                const length = rubricContent.value.length;
                charCount.textContent = length;

                if (length > 500) {
                    charCount.parentElement.classList.add('text-red-500');
                } else if (length > 400) {
                    charCount.parentElement.classList.add('text-yellow-500');
                } else {
                    charCount.parentElement.classList.remove('text-red-500', 'text-yellow-500');
                }
            });

            // æ¸…ç©ºåŠŸèƒ½
            document.getElementById('clear-rubric-btn').addEventListener('click', () => {
            if (rubricContent.value.trim()) {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºè¯„åˆ†ç»†åˆ™å†…å®¹å—ï¼Ÿ')) {
                    rubricContent.value = '';
                    charCount.textContent = '0';
                    showToast('success', 'æ¸…ç©ºæˆåŠŸ', 'è¯„åˆ†ç»†åˆ™å†…å®¹å·²æ¸…ç©º');
                }
            }
        });

        // å¯¼å…¥åŠŸèƒ½
        const importModal = document.getElementById('import-modal');
        const importBtn = document.getElementById('import-rubric-btn');
        const importCloseBtn = document.getElementById('import-close-btn');
        const importCancelBtn = document.getElementById('import-cancel-btn');
        const importConfirmBtn = document.getElementById('import-confirm-btn');
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');

        function openImportModal() {
            importModal.classList.remove('hidden');
            setTimeout(() => {
                importModal.querySelector('.modal-backdrop').classList.add('opacity-100');
                importModal.querySelector('.modal-content').classList.add('scale-100', 'opacity-100');
                importModal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function closeImportModal() {
            importModal.querySelector('.modal-backdrop').classList.remove('opacity-100');
            importModal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
            importModal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                importModal.classList.add('hidden');
                resetImportModal();
            }, 300);
        }

        function resetImportModal() {
            fileInput.value = '';
            importConfirmBtn.disabled = true;
            dropZone.classList.remove('dragover');
        }

        importBtn.addEventListener('click', openImportModal);
        importCloseBtn.addEventListener('click', closeImportModal);
        importCancelBtn.addEventListener('click', closeImportModal);

        // æ–‡ä»¶æ‹–æ‹½åŠŸèƒ½
        dropZone.addEventListener('click', () => {
            fileInput.click();
        });

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            const validTypes = ['text/plain', 'application/json', 'text/markdown'];
            const validExtensions = ['.txt', '.json', '.md'];

            const isValidFile = validTypes.includes(file.type) ||
                              validExtensions.some(ext => file.name.toLowerCase().endsWith(ext));

            if (!isValidFile) {
                showToast('error', 'æ–‡ä»¶æ ¼å¼é”™è¯¯', 'è¯·é€‰æ‹©æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼š.txt, .json, .md');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                currentRubricContent = e.target.result;
                importConfirmBtn.disabled = false;
                showToast('success', 'æ–‡ä»¶å·²åŠ è½½', `"${file.name}" å·²æˆåŠŸåŠ è½½`);
            };
            reader.readAsText(file);
        }

        // ç¡®è®¤å¯¼å…¥
        importConfirmBtn.addEventListener('click', () => {
            if (currentRubricContent) {
                rubricContent.value = currentRubricContent;
                charCount.textContent = currentRubricContent.length;
                closeImportModal();
                showToast('success', 'å¯¼å…¥æˆåŠŸ', 'è¯„åˆ†ç»†åˆ™å·²æˆåŠŸå¯¼å…¥');
            }
        });

        // ä¿å­˜åŠŸèƒ½
        const saveModal = document.getElementById('save-modal');
        const saveBtn = document.getElementById('save-rubric-btn');
        const saveCloseBtn = document.getElementById('save-close-btn');
        const saveCancelBtn = document.getElementById('save-cancel-btn');
        const saveConfirmBtn = document.getElementById('save-confirm-btn');
        const filenameInput = document.getElementById('filename-input');
        const contentPreview = document.getElementById('content-preview');

        function openSaveModal() {
            if (!rubricContent.value.trim()) {
                showToast('warning', 'å†…å®¹ä¸ºç©º', 'è¯·å…ˆè¾“å…¥è¯„åˆ†ç»†åˆ™å†…å®¹');
                return;
            }

            updateContentPreview();
            saveModal.classList.remove('hidden');
            setTimeout(() => {
                saveModal.querySelector('.modal-backdrop').classList.add('opacity-100');
                saveModal.querySelector('.modal-content').classList.add('scale-100', 'opacity-100');
                saveModal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function closeSaveModal() {
            saveModal.querySelector('.modal-backdrop').classList.remove('opacity-100');
            saveModal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
            saveModal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                saveModal.classList.add('hidden');
            }, 300);
        }

        function updateContentPreview() {
            const content = rubricContent.value;
            const format = document.querySelector('input[name="save-format"]:checked').value;
            const includeTimestamp = document.getElementById('include-timestamp').checked;
            const includeMetadata = document.getElementById('include-metadata').checked;

            let preview = content;

            if (includeMetadata) {
                const metadata = `---
æ–‡ä»¶å: ${filenameInput.value}
åˆ›å»ºæ—¶é—´: ${new Date().toLocaleString()}
å­—ç¬¦æ•°: ${content.length}
ç±»å‹: è¯„åˆ†ç»†åˆ™
---

`;
                preview = metadata + preview;
            }

            if (format === 'json') {
                const jsonData = {
                    filename: filenameInput.value,
                    created_at: new Date().toISOString(),
                    content: content,
                    metadata: includeMetadata ? {
                        char_count: content.length,
                        type: 'è¯„åˆ†ç»†åˆ™'
                    } : undefined
                };
                preview = JSON.stringify(jsonData, null, 2);
            }

            contentPreview.textContent = preview;
        }

        saveBtn.addEventListener('click', openSaveModal);
        saveCloseBtn.addEventListener('click', closeSaveModal);
        saveCancelBtn.addEventListener('click', closeSaveModal);

        // æ ¼å¼é€‰æ‹©
        document.querySelectorAll('input[name="save-format"]').forEach(radio => {
            radio.addEventListener('change', () => {
                // æ›´æ–°UIæ ·å¼
                document.querySelectorAll('.format-option').forEach(option => {
                    option.classList.remove('border-[#E67E22]', 'bg-[#FDF2E8]');
                    option.classList.add('border-gray-200');
                });

                const selectedOption = radio.parentElement.querySelector('.format-option');
                selectedOption.classList.remove('border-gray-200');
                selectedOption.classList.add('border-[#E67E22]', 'bg-[#FDF2E8]');

                updateContentPreview();
            });
        });

        // ä¿å­˜é€‰é¡¹å˜æ›´
        document.getElementById('include-timestamp').addEventListener('change', updateContentPreview);
        document.getElementById('include-metadata').addEventListener('change', updateContentPreview);
        filenameInput.addEventListener('input', updateContentPreview);

        // ç¡®è®¤ä¿å­˜
        saveConfirmBtn.addEventListener('click', () => {
            const filename = filenameInput.value.trim() || 'è¯„åˆ†ç»†åˆ™';
            const format = document.querySelector('input[name="save-format"]:checked').value;
            const content = rubricContent.value;

            let fileContent = content;
            let mimeType = 'text/plain';

            if (document.getElementById('include-metadata').checked) {
                const metadata = `---
æ–‡ä»¶å: ${filename}
åˆ›å»ºæ—¶é—´: ${new Date().toLocaleString()}
å­—ç¬¦æ•°: ${content.length}
ç±»å‹: è¯„åˆ†ç»†åˆ™
---

`;
                fileContent = metadata + fileContent;
            }

            if (format === 'json') {
                const jsonData = {
                    filename: filename,
                    created_at: new Date().toISOString(),
                    content: content,
                    metadata: document.getElementById('include-metadata').checked ? {
                        char_count: content.length,
                        type: 'è¯„åˆ†ç»†åˆ™'
                    } : undefined
                };
                fileContent = JSON.stringify(jsonData, null, 2);
                mimeType = 'application/json';
            }

            const blob = new Blob([fileContent], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.${format}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            closeSaveModal();
            showToast('success', 'ä¿å­˜æˆåŠŸ', `æ–‡ä»¶ "${filename}.${format}" å·²ä¿å­˜åˆ°æœ¬åœ°`);
        });

        // ç¼–è¾‘åŠŸèƒ½
        document.getElementById('edit-rubric-btn').addEventListener('click', () => {
            rubricContent.focus();
            rubricContent.select();
        });

        // Toast æç¤ºåŠŸèƒ½
        function showToast(type, title, message) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toast-icon');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');

            // è®¾ç½®å›¾æ ‡
            const iconMap = {
                'success': 'check-circle',
                'error': 'x-circle',
                'warning': 'alert-triangle',
                'info': 'info'
            };

            const colorMap = {
                'success': 'text-green-500',
                'error': 'text-red-500',
                'warning': 'text-yellow-500',
                'info': 'text-blue-500'
            };

            toastIcon.innerHTML = `<i data-lucide="${iconMap[type]}" class="w-5 h-5 ${colorMap[type]}"></i>`;
            toastTitle.textContent = title;
            toastMessage.textContent = message;

            toast.classList.remove('hidden');
            toast.classList.add('slide-in-right');

            lucide.createIcons();

            setTimeout(() => {
                toast.classList.add('hidden');
                toast.classList.remove('slide-in-right');
            }, 3000);
        }

        // ========== æ¨¡å‹è®¾ç½®æ»‘å—äº¤äº’ ==========
        function initSliderInteraction() {
            // åˆå§‹åŒ–æ‰€æœ‰æ»‘å—çš„è¿›åº¦æ˜¾ç¤º
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                const value = parseFloat(slider.value);
                const min = parseFloat(slider.min) || 0;
                const max = parseFloat(slider.max) || 1;
                const percentage = ((value - min) / (max - min)) * 100;
                slider.style.setProperty('--progress', percentage + '%');

                // æ ¹æ®æ»‘å—IDè®¾ç½®é¢œè‰²
                if (slider.id.includes('gpt4o')) {
                    slider.style.setProperty('--slider-color', '#3b82f6');
                } else if (slider.id.includes('gemini')) {
                    slider.style.setProperty('--slider-color', '#14b8a6');
                } else if (slider.id.includes('glm')) {
                    slider.style.setProperty('--slider-color', '#8b5cf6');
                } else if (slider.id.includes('gradingSpeed')) {
                    slider.style.setProperty('--slider-color', '#4f46e5');
                } else {
                    slider.style.setProperty('--slider-color', '#3b82f6');
                }
            });

            // GPT-4o å‚æ•°è®¾ç½®
            const gpt4oTemp = document.getElementById('gpt4o-temp');
            const gpt4oTempValue = document.getElementById('gpt4o-temp-value');
            const gpt4oMaxTokens = document.getElementById('gpt4o-max-tokens');
            const gpt4oMaxTokensValue = document.getElementById('gpt4o-max-tokens-value');
            const gpt4oTopp = document.getElementById('gpt4o-topp');
            const gpt4oToppValue = document.getElementById('gpt4o-topp-value');

            if (gpt4oTemp && gpt4oTempValue) {
                gpt4oTemp.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    gpt4oTempValue.textContent = value;
                    // æ›´æ–°æ»‘å—è¿›åº¦
                    const percentage = (value / 1) * 100;
                    gpt4oTemp.style.setProperty('--progress', percentage + '%');
                    gpt4oTemp.style.setProperty('--slider-color', '#3b82f6');
                });
            }
            if (gpt4oMaxTokens && gpt4oMaxTokensValue) {
                gpt4oMaxTokens.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    gpt4oMaxTokensValue.textContent = value;
                    const percentage = ((value - 512) / (4096 - 512)) * 100;
                    gpt4oMaxTokens.style.setProperty('--progress', percentage + '%');
                    gpt4oMaxTokens.style.setProperty('--slider-color', '#3b82f6');
                });
            }
            if (gpt4oTopp && gpt4oToppValue) {
                gpt4oTopp.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    gpt4oToppValue.textContent = value;
                    const percentage = ((value - 0.1) / (1 - 0.1)) * 100;
                    gpt4oTopp.style.setProperty('--progress', percentage + '%');
                    gpt4oTopp.style.setProperty('--slider-color', '#3b82f6');
                });
            }

            // Gemini å‚æ•°è®¾ç½®
            const geminiTemp = document.getElementById('gemini-temp');
            const geminiTempValue = document.getElementById('gemini-temp-value');
            const geminiMaxTokens = document.getElementById('gemini-max-tokens');
            const geminiMaxTokensValue = document.getElementById('gemini-max-tokens-value');
            const geminiTopk = document.getElementById('gemini-topk');
            const geminiTopkValue = document.getElementById('gemini-topk-value');

            if (geminiTemp && geminiTempValue) {
                geminiTemp.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    geminiTempValue.textContent = value;
                    const percentage = (value / 1) * 100;
                    geminiTemp.style.setProperty('--progress', percentage + '%');
                    geminiTemp.style.setProperty('--slider-color', '#14b8a6');
                });
            }
            if (geminiMaxTokens && geminiMaxTokensValue) {
                geminiMaxTokens.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    geminiMaxTokensValue.textContent = value;
                    const percentage = ((value - 512) / (4096 - 512)) * 100;
                    geminiMaxTokens.style.setProperty('--progress', percentage + '%');
                    geminiMaxTokens.style.setProperty('--slider-color', '#14b8a6');
                });
            }
            if (geminiTopk && geminiTopkValue) {
                geminiTopk.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    geminiTopkValue.textContent = value;
                    const percentage = ((value - 1) / (100 - 1)) * 100;
                    geminiTopk.style.setProperty('--progress', percentage + '%');
                    geminiTopk.style.setProperty('--slider-color', '#14b8a6');
                });
            }

            // GLM-4.5V å‚æ•°è®¾ç½®
            const glmTemp = document.getElementById('glm-temp');
            const glmTempValue = document.getElementById('glm-temp-value');
            const glmMaxTokens = document.getElementById('glm-max-tokens');
            const glmMaxTokensValue = document.getElementById('glm-max-tokens-value');
            const glmPenalty = document.getElementById('glm-penalty');
            const glmPenaltyValue = document.getElementById('glm-penalty-value');

            if (glmTemp && glmTempValue) {
                glmTemp.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    glmTempValue.textContent = value;
                    const percentage = (value / 1) * 100;
                    glmTemp.style.setProperty('--progress', percentage + '%');
                    glmTemp.style.setProperty('--slider-color', '#8b5cf6');
                });
            }
            if (glmMaxTokens && glmMaxTokensValue) {
                glmMaxTokens.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    glmMaxTokensValue.textContent = value;
                    const percentage = ((value - 512) / (4096 - 512)) * 100;
                    glmMaxTokens.style.setProperty('--progress', percentage + '%');
                    glmMaxTokens.style.setProperty('--slider-color', '#8b5cf6');
                });
            }
            if (glmPenalty && glmPenaltyValue) {
                glmPenalty.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    glmPenaltyValue.textContent = value;
                    const percentage = ((value - 1) / (1.5 - 1)) * 100;
                    glmPenalty.style.setProperty('--progress', percentage + '%');
                    glmPenalty.style.setProperty('--slider-color', '#8b5cf6');
                });
            }

            // é˜…å·é€Ÿåº¦æ»‘å—
            const gradingSpeed = document.querySelector('#gradingSpeed');
            if (gradingSpeed) {
                // æ‹–åŠ¨æ—¶åŠ¨æ€æ›´æ–°è¿›åº¦
                gradingSpeed.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    const percentage = ((value - 1) / (5 - 1)) * 100;
                    gradingSpeed.style.setProperty('--progress', percentage + '%');
                    gradingSpeed.style.setProperty('--slider-color', '#4f46e5');
                });
            }
        }

        // åˆå§‹åŒ–æ»‘å—äº¤äº’
        initSliderInteraction();

        // ========== é”®ç›˜å¯¼èˆªæ”¯æŒ ==========
        function initKeyboardNavigation() {
            document.addEventListener('keydown', (e) => {
                // ESC é”®å…³é—­è®¾ç½®æ¨¡æ€æ¡†
                if (e.key === 'Escape') {
                    if (settingsModal && !settingsModal.classList.contains('hidden')) {
                        closeSettingsModal();
                    }
                }

                // Ctrl+, æ‰“å¼€è®¾ç½®
                if (e.ctrlKey && e.key === ',') {
                    e.preventDefault();
                    openSettingsModal();
                }

                // Ctrl+S ä¿å­˜è®¾ç½®
                if (e.ctrlKey && e.key === 's') {
                    if (settingsModal && !settingsModal.classList.contains('hidden')) {
                        e.preventDefault();
                        saveSettings();
                    }
                }

                // Alt+æ•°å­—é”®åˆ‡æ¢è®¾ç½®æ ‡ç­¾é¡µ
                if (e.altKey && settingsModal && !settingsModal.classList.contains('hidden')) {
                    const tabIndex = parseInt(e.key) - 1;
                    if (tabIndex >= 0 && tabIndex < settingsTabs.length) {
                        settingsTabs[tabIndex].click();
                    }
                }
            });
        }

        // åˆå§‹åŒ–é”®ç›˜å¯¼èˆª
        initKeyboardNavigation();

        // ========== é¢„è®¾é…ç½®åŠŸèƒ½ ==========
        const presetButtons = document.querySelectorAll('.preset-config-btn');
        const presetConfigs = {
            speed: {
                gpt4o: { temp: 0.3, maxTokens: 1024, topp: 0.7 },
                gemini: { temp: 0.2, maxTokens: 1024, topk: 20 },
                glm: { temp: 0.25, maxTokens: 1024, penalty: 1.05 }
            },
            balance: {
                gpt4o: { temp: 0.7, maxTokens: 2048, topp: 0.9 },
                gemini: { temp: 0.6, maxTokens: 2048, topk: 40 },
                glm: { temp: 0.65, maxTokens: 2048, penalty: 1.1 }
            },
            accuracy: {
                gpt4o: { temp: 0.2, maxTokens: 4096, topp: 0.95 },
                gemini: { temp: 0.1, maxTokens: 4096, topk: 10 },
                glm: { temp: 0.15, maxTokens: 4096, penalty: 1.2 }
            }
        };

        presetButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const preset = e.currentTarget.getAttribute('data-preset');
                const config = presetConfigs[preset];

                if (!config) return;

                // åº”ç”¨ GPT-4o é…ç½®
                if (gpt4oTemp) {
                    gpt4oTemp.value = config.gpt4o.temp;
                    gpt4oTemp.dispatchEvent(new Event('input'));
                }
                if (gpt4oTempValue) gpt4oTempValue.textContent = config.gpt4o.temp;
                if (gpt4oMaxTokens) {
                    gpt4oMaxTokens.value = config.gpt4o.maxTokens;
                    gpt4oMaxTokens.dispatchEvent(new Event('input'));
                }
                if (gpt4oMaxTokensValue) gpt4oMaxTokensValue.textContent = config.gpt4o.maxTokens;
                if (gpt4oTopp) {
                    gpt4oTopp.value = config.gpt4o.topp;
                    gpt4oTopp.dispatchEvent(new Event('input'));
                }
                if (gpt4oToppValue) gpt4oToppValue.textContent = config.gpt4o.topp;

                // åº”ç”¨ Gemini é…ç½®
                if (geminiTemp) {
                    geminiTemp.value = config.gemini.temp;
                    geminiTemp.dispatchEvent(new Event('input'));
                }
                if (geminiTempValue) geminiTempValue.textContent = config.gemini.temp;
                if (geminiMaxTokens) {
                    geminiMaxTokens.value = config.gemini.maxTokens;
                    geminiMaxTokens.dispatchEvent(new Event('input'));
                }
                if (geminiMaxTokensValue) geminiMaxTokensValue.textContent = config.gemini.maxTokens;
                if (geminiTopk) {
                    geminiTopk.value = config.gemini.topk;
                    geminiTopk.dispatchEvent(new Event('input'));
                }
                if (geminiTopkValue) geminiTopkValue.textContent = config.gemini.topk;

                // åº”ç”¨ GLM-4.5V é…ç½®
                if (glmTemp) {
                    glmTemp.value = config.glm.temp;
                    glmTemp.dispatchEvent(new Event('input'));
                }
                if (glmTempValue) glmTempValue.textContent = config.glm.temp;
                if (glmMaxTokens) {
                    glmMaxTokens.value = config.glm.maxTokens;
                    glmMaxTokens.dispatchEvent(new Event('input'));
                }
                if (glmMaxTokensValue) glmMaxTokensValue.textContent = config.glm.maxTokens;
                if (glmPenalty) {
                    glmPenalty.value = config.glm.penalty;
                    glmPenalty.dispatchEvent(new Event('input'));
                }
                if (glmPenaltyValue) glmPenaltyValue.textContent = config.glm.penalty;

                const presetNames = {
                    speed: 'é€Ÿåº¦ä¼˜å…ˆ',
                    balance: 'å‡è¡¡æ¨¡å¼',
                    accuracy: 'å‡†ç¡®ä¼˜å…ˆ'
                };

                showToast('success', 'é¢„è®¾åº”ç”¨æˆåŠŸ', `${presetNames[preset]}é…ç½®å·²åº”ç”¨åˆ°æ‰€æœ‰æ¨¡å‹`);
            });
        });

        // APIè¿æ¥æµ‹è¯•
        document.querySelectorAll('[title="æµ‹è¯•è¿æ¥"]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const button = e.currentTarget;
                const originalIcon = button.innerHTML;
                button.innerHTML = '<div class="loading"></div>';
                button.disabled = true;

                // æ¨¡æ‹ŸAPIæµ‹è¯•
                setTimeout(() => {
                    button.innerHTML = originalIcon;
                    button.disabled = false;
                    showToast('success', 'è¿æ¥æˆåŠŸ', 'APIè¿æ¥æµ‹è¯•é€šè¿‡');
                }, 1500);
            });
        });

        // ç­–ç•¥é€‰æ‹©å¤„ç†
        document.querySelectorAll('input[name="grading-strategy"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                // ç§»é™¤æ‰€æœ‰é€‰ä¸­æ ·å¼
                document.querySelectorAll('.strategy-item').forEach(item => {
                    item.classList.remove('border-[#E67E22]', 'bg-[#FDF2E8]');
                    item.classList.add('border-gray-200');
                });
                // æ·»åŠ é€‰ä¸­æ ·å¼
                if (e.target.checked) {
                    const parent = e.target.closest('.strategy-item');
                    parent.classList.remove('border-gray-200');
                    parent.classList.add('border-[#E67E22]', 'bg-[#FDF2E8]');
                }
            });
        });

        // é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (!importModal.classList.contains('hidden')) {
                    closeImportModal();
                } else if (!saveModal.classList.contains('hidden')) {
                    closeSaveModal();
                } else if (settingsModal && !settingsModal.classList.contains('hidden')) {
                    closeSettingsModal();
                }
            }

            // Ctrl+S ä¿å­˜
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                if (rubricContent.value.trim()) {
                    openSaveModal();
                }
            }

            // Ctrl+O æ‰“å¼€å¯¼å…¥
            if (e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                openImportModal();
            }
        });

        // åŒæ¨¡å‹ç»“æœå±•ç¤ºåŠŸèƒ½
        const dualModelResult = document.getElementById('dual-model-result');
        const startGradingBtn = document.getElementById('start-grading-btn');
        const viewDetailBtn = document.getElementById('view-detail-btn');

        // å¼€å§‹æ ·é¢˜è¯•é˜…
        startGradingBtn.addEventListener('click', async () => {
            // æ£€æŸ¥è¯„åˆ†ç»†åˆ™
            const rubricContent = document.getElementById('rubric-content');
            if (!rubricContent.value.trim()) {
                showToast('warning', 'æç¤º', 'è¯·å…ˆè¾“å…¥è¯„åˆ†ç»†åˆ™');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            startGradingBtn.disabled = true;
            startGradingBtn.innerHTML = `
                <span class="flex items-center justify-center space-x-3">
                    <div class="loading"></div>
                    <span>AIè¯„åˆ†ä¸­...</span>
                </span>
            `;

            showToast('info', 'è¯„åˆ†å¼€å§‹', 'æ­£åœ¨è°ƒç”¨åŒæ¨¡å‹è¿›è¡Œè¯„åˆ†ï¼Œè¯·ç¨å€™...');

            // æ¨¡æ‹ŸåŒæ¨¡å‹è¯„åˆ†è¿‡ç¨‹
            setTimeout(() => {
                // æ˜¾ç¤ºç»“æœ
                dualModelResult.classList.remove('hidden');
                dualModelResult.classList.add('scale-in');

                // æ¢å¤æŒ‰é’®
                startGradingBtn.disabled = false;
                startGradingBtn.innerHTML = `
                    <span class="flex items-center justify-center space-x-3">
                        <i data-lucide="play-circle" class="w-6 h-6"></i>
                        <span>å¼€å§‹æ ·é¢˜è¯•é˜…</span>
                        <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </span>
                `;

                lucide.createIcons();
                showToast('success', 'è¯„åˆ†å®Œæˆ', 'åŒæ¨¡å‹è¯„åˆ†å·²å®Œæˆï¼Œè¯·æŸ¥çœ‹ç»“æœ');
            }, 3000);
        });

        // åŒæ¨¡å‹è¯¦ç»†å¯¹æ¯”å¼¹çª—
        const dualModelModal = document.getElementById('dual-model-detail-modal');
        const dualModelCloseBtn = document.getElementById('dual-model-close-btn');
        const dualModelSaveBtn = document.getElementById('dual-model-save-btn');
        const dualModelExportBtn = document.getElementById('dual-model-export-btn');
        const dualModelConfirmBtn = document.getElementById('dual-model-confirm-btn');

        // æ‰“å¼€è¯¦ç»†å¯¹æ¯”å¼¹çª—
        function openDualModelModal() {
            dualModelModal.classList.remove('hidden');
            setTimeout(() => {
                dualModelModal.querySelector('.modal-backdrop').classList.add('opacity-100');
                dualModelModal.querySelector('.modal-content').classList.add('scale-100', 'opacity-100');
                dualModelModal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        // å…³é—­è¯¦ç»†å¯¹æ¯”å¼¹çª—
        function closeDualModelModal() {
            dualModelModal.querySelector('.modal-backdrop').classList.remove('opacity-100');
            dualModelModal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
            dualModelModal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                dualModelModal.classList.add('hidden');
            }, 300);
        }

        // æŸ¥çœ‹è¯¦ç»†å¯¹æ¯”æŒ‰é’®
        viewDetailBtn.addEventListener('click', openDualModelModal);

        // å…³é—­å¼¹çª—æŒ‰é’®
        dualModelCloseBtn.addEventListener('click', closeDualModelModal);

        // ä¿å­˜å¯¹æ¯”ç»“æœ
        dualModelSaveBtn.addEventListener('click', () => {
            showToast('success', 'ä¿å­˜æˆåŠŸ', 'åŒæ¨¡å‹å¯¹æ¯”ç»“æœå·²ä¿å­˜');
            closeDualModelModal();
        });

        // å¯¼å‡ºå¯¹æ¯”æŠ¥å‘Š
        dualModelExportBtn.addEventListener('click', () => {
            showToast('info', 'å¯¼å‡ºå¼€å§‹', 'æ­£åœ¨ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š...');
            setTimeout(() => {
                showToast('success', 'å¯¼å‡ºæˆåŠŸ', 'åŒæ¨¡å‹å¯¹æ¯”æŠ¥å‘Šå·²å¯¼å‡º');
            }, 1500);
        });

        // ç¡®è®¤è¯„åˆ†
        dualModelConfirmBtn.addEventListener('click', () => {
            showToast('success', 'è¯„åˆ†ç¡®è®¤', 'æ¨èåˆ†æ•°85åˆ†å·²ç¡®è®¤');
            closeDualModelModal();
        });

        // ç‚¹å‡»èƒŒæ™¯å…³é—­å¼¹çª—
        dualModelModal.querySelector('.modal-backdrop').addEventListener('click', closeDualModelModal);

        // ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (!dualModelModal.classList.contains('hidden')) {
                    closeDualModelModal();
                }
            }
        });

        // ========== åˆ†æ•°åŒæ­¥åŠŸèƒ½ ==========
        // åˆ†æ•°åŒæ­¥å¼•æ“ç±»
        class ScoreSyncEngine {
            constructor() {
                this.currentScore = 85;
                this.maxScore = 100;
                this.isAutoSubmit = false;
                this.scoreInput = null;
                this.lastSyncTime = null;
                this.init();
            }

            init() {
                console.log('ğŸ”— åˆ†æ•°åŒæ­¥å¼•æ“å·²å¯åŠ¨');
                this.detectScoreElements();
            }

            /**
             * æ™ºèƒ½è¯†åˆ«æ™ºå­¦ç½‘çš„å¾—åˆ†æ¡†å…ƒç´ 
             */
            detectScoreElements() {
                const possibleSelectors = [
                    'input[type="number"][class*="score"]',
                    'input[class*="grade"]',
                    'input[id*="score"]',
                    '.score-input input',
                    '.grade-box input',
                    'input[name*="score"]',
                    'input[placeholder*="åˆ†"]',
                    '.exam-grade-box input',
                    '.answer-score input',
                    'input[maxlength="3"]'
                ];

                for (const selector of possibleSelectors) {
                    const element = document.querySelector(selector);
                    if (element && this.isScoreElement(element)) {
                        this.scoreInput = element;
                        console.log('[âœ“] æ‰¾åˆ°å¾—åˆ†æ¡†å…ƒç´ :', {
                            tagName: element.tagName,
                            className: element.className,
                            id: element.id,
                            selector: selector
                        });
                        return true;
                    }
                }

                console.warn('âš ï¸ æœªæ‰¾åˆ°å¾—åˆ†æ¡†å…ƒç´ ï¼Œæ¨¡æ‹Ÿæ¨¡å¼ä¸‹å°†æ˜¾ç¤ºæç¤º');
                return false;
            }

            /**
             * åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸ºå¾—åˆ†æ¡†
             */
            isScoreElement(element) {
                if (!element || element.tagName !== 'INPUT') return false;

                const attrs = {
                    type: element.type,
                    className: element.className.toLowerCase(),
                    id: element.id.toLowerCase(),
                    name: element.name.toLowerCase(),
                    placeholder: element.placeholder || ''
                };

                const scoreKeywords = ['score', 'grade', 'å¾—åˆ†', 'åˆ†æ•°', 'åˆ†å€¼'];
                const hasScoreKeyword = scoreKeywords.some(keyword =>
                    attrs.className.includes(keyword) ||
                    attrs.id.includes(keyword) ||
                    attrs.name.includes(keyword) ||
                    attrs.placeholder.includes(keyword)
                );

                return hasScoreKeyword || attrs.type === 'number';
            }

            /**
             * åŒæ­¥åˆ†æ•°åˆ°æ™ºå­¦ç½‘å¾—åˆ†æ¡†
             */
            syncScoreToZhixue(score, showFeedback = true) {
                // éªŒè¯åˆ†æ•°èŒƒå›´
                if (score < 0) score = 0;
                if (score > this.maxScore) score = this.maxScore;
                this.currentScore = score;

                if (this.scoreInput) {
                    try {
                        // è®¾ç½®åˆ†æ•°
                        this.scoreInput.value = score;

                        // è§¦å‘äº‹ä»¶
                        const changeEvent = new Event('change', { bubbles: true });
                        this.scoreInput.dispatchEvent(changeEvent);

                        const inputEvent = new Event('input', { bubbles: true });
                        this.scoreInput.dispatchEvent(inputEvent);

                        const blurEvent = new Event('blur', { bubbles: true });
                        this.scoreInput.dispatchEvent(blurEvent);

                        this.lastSyncTime = new Date();
                        this.updateSyncStatus(true);

                        if (showFeedback) {
                            showToast('success', 'åˆ†æ•°åŒæ­¥æˆåŠŸ', `å·²è®¾ç½®åˆ†æ•°: ${score}/${this.maxScore}`);
                        }

                        console.log('[âœ“] åˆ†æ•°åŒæ­¥æˆåŠŸ:', score);
                        return true;
                    } catch (error) {
                        console.error('[âœ—] åˆ†æ•°åŒæ­¥å¤±è´¥:', error);
                        if (showFeedback) {
                            showToast('error', 'åŒæ­¥å¤±è´¥', error.message);
                        }
                        return false;
                    }
                } else {
                    // æ¨¡æ‹Ÿæ¨¡å¼ï¼šä»…æ˜¾ç¤ºæç¤º
                    this.lastSyncTime = new Date();
                    this.updateSyncStatus(true);
                    if (showFeedback) {
                        showToast('info', 'æ¨¡æ‹ŸåŒæ­¥æˆåŠŸ', `åœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œåˆ†æ•° ${score} å°†åŒæ­¥åˆ°æ™ºå­¦ç½‘å¾—åˆ†æ¡†`);
                    }
                    console.log(`ğŸ­ æ¨¡æ‹ŸåŒæ­¥åˆ†æ•°: ${score}`);
                    return true;
                }
            }

            /**
             * æ›´æ–°åŒæ­¥çŠ¶æ€æ˜¾ç¤º
             */
            updateSyncStatus(isSynced) {
                // åœ¨é‡æ„åçš„ç‰ˆæœ¬ä¸­ï¼Œæ ·é¢˜è¯•é˜…æ¨¡å—ä¸å†æ˜¾ç¤ºåŒæ­¥çŠ¶æ€
                // ä¿ç•™æ­¤æ–¹æ³•ä»¥ä¿æŒAPIå…¼å®¹æ€§
                console.log(`åˆ†æ•°åŒæ­¥çŠ¶æ€: ${isSynced ? 'å·²åŒæ­¥' : 'æœªåŒæ­¥'}`);
            }

            /**
             * è®¾ç½®è‡ªåŠ¨æäº¤
             */
            setAutoSubmit(enabled) {
                this.isAutoSubmit = enabled;
                console.log(`[é¶] è‡ªåŠ¨æäº¤å·²${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`);
            }

            /**
             * è·å–å½“å‰åˆ†æ•°
             */
            getCurrentScore() {
                return this.currentScore;
            }
        }

        // åˆå§‹åŒ–åˆ†æ•°åŒæ­¥å¼•æ“
        const scoreSyncEngine = new ScoreSyncEngine();

        // åˆ†æ•°è°ƒæ•´é¢æ¿äº‹ä»¶å¤„ç† - é‡æ„ç‰ˆé€‚é…
        function setupScoreAdjustment() {
            const scoreInput = document.getElementById('adjustedScoreInput');
            const submitToZhixueBtn = document.getElementById('submitToZhixueBtn');

            // åˆ†æ•°è¾“å…¥æ¡†å˜åŒ–äº‹ä»¶
            if (scoreInput) {
                scoreInput.addEventListener('input', (e) => {
                    const score = parseInt(e.target.value);
                    if (score >= 0 && score <= 100) {
                        scoreSyncEngine.currentScore = score;
                    }
                });
            }

            // åŒæ­¥åˆ°æ™ºå­¦ç½‘æŒ‰é’®
            if (submitToZhixueBtn) {
                submitToZhixueBtn.addEventListener('click', () => {
                    const score = parseInt(scoreInput.value);
                    if (score >= 0 && score <= 100) {
                        scoreSyncEngine.syncScoreToZhixue(score, true);
                    } else {
                        showToast('error', 'åˆ†æ•°æ— æ•ˆ', 'è¯·è¾“å…¥0-100ä¹‹é—´çš„åˆ†æ•°');
                    }
                });
            }
        }

        // åˆå§‹åŒ–åˆ†æ•°è°ƒæ•´åŠŸèƒ½
        setupScoreAdjustment();

        // ç›‘å¬åˆ†æ•°è°ƒæ•´é¢æ¿çš„è¾“å…¥æ¡†å˜åŒ–
        document.addEventListener('input', (e) => {
            if (e.target.id === 'adjustedScoreInput') {
                const score = parseInt(e.target.value);
                if (score >= 0 && score <= 100) {
                    scoreSyncEngine.currentScore = score;
                    scoreSyncEngine.updateSyncStatus(false);
                }
            }
        });

        // ========== æ•°æ®åˆ†æåŠŸèƒ½ ==========
        // æ¨¡æ‹Ÿè¯„é˜…æ•°æ®
        let gradingData = generateMockData();

        // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
        function generateMockData() {
            const data = [];
            for (let i = 0; i < 892; i++) {
                // ç”Ÿæˆæ­£æ€åˆ†å¸ƒçš„åˆ†æ•°æ•°æ®
                const score = Math.round(Math.min(100, Math.max(0,
                    85 + (Math.random() - 0.5) * 30 + (Math.random() - 0.5) * 20
                )));
                data.push({
                    id: `PAPER_${String(i + 1).padStart(4, '0')}`,
                    score: score,
                    timestamp: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000),
                    subject: ['è¯­æ–‡', 'æ•°å­¦', 'è‹±è¯­', 'ç‰©ç†', 'åŒ–å­¦'][Math.floor(Math.random() * 5)],
                    paperType: ['é€‰æ‹©é¢˜', 'å¡«ç©ºé¢˜', 'è§£ç­”é¢˜', 'è®ºè¿°é¢˜'][Math.floor(Math.random() * 4)]
                });
            }
            return data;
        }

        // è®¡ç®—ç»Ÿè®¡æ•°æ®
        function calculateStatistics(data) {
            const scores = data.map(d => d.score).sort((a, b) => a - b);
            const total = data.length;
            const sum = scores.reduce((acc, val) => acc + val, 0);
            const average = sum / total;
            const max = Math.max(...scores);
            const min = Math.min(...scores);
            const median = total % 2 === 0
                ? (scores[total / 2 - 1] + scores[total / 2]) / 2
                : scores[Math.floor(total / 2)];

            // è®¡ç®—æ ‡å‡†å·®
            const variance = scores.reduce((acc, val) => acc + Math.pow(val - average, 2), 0) / total;
            const stdDev = Math.sqrt(variance);

            // è®¡ç®—å„åˆ†æ•°æ®µäººæ•°
            const scoreRanges = {
                '0-59': 0,
                '60-69': 0,
                '70-79': 0,
                '80-89': 0,
                '90-100': 0
            };

            scores.forEach(score => {
                if (score < 60) scoreRanges['0-59']++;
                else if (score < 70) scoreRanges['60-69']++;
                else if (score < 80) scoreRanges['70-79']++;
                else if (score < 90) scoreRanges['80-89']++;
                else scoreRanges['90-100']++;
            });

            const passCount = scores.filter(s => s >= 60).length;
            const excellentCount = scores.filter(s => s >= 90).length;

            return {
                total,
                average: average.toFixed(1),
                max,
                min,
                median: median.toFixed(1),
                stdDev: stdDev.toFixed(1),
                scoreRanges,
                passRate: ((passCount / total) * 100).toFixed(1),
                excellentRate: ((excellentCount / total) * 100).toFixed(1),
                todayCount: Math.floor(Math.random() * 50) + 10
            };
        }

        // åˆå§‹åŒ–Chart.jså›¾è¡¨
        let scoreChart = null;

        function initChart() {
            const ctx = document.getElementById('scoreDistributionChart');
            if (!ctx) return;

            const stats = calculateStatistics(gradingData);

            if (scoreChart) {
                scoreChart.destroy();
            }

            const chartType = document.getElementById('chartTypeSelect').value;
            const labels = Object.keys(stats.scoreRanges);
            const data = Object.values(stats.scoreRanges);

            const config = {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å­¦ç”Ÿäººæ•°',
                        data: data,
                        backgroundColor: chartType === 'pie'
                            ? [
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(251, 146, 60, 0.8)',
                                'rgba(250, 204, 21, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(59, 130, 246, 0.8)'
                              ]
                            : 'rgba(59, 130, 246, 0.6)',
                        borderColor: chartType === 'pie'
                            ? [
                                'rgb(239, 68, 68)',
                                'rgb(251, 146, 60)',
                                'rgb(250, 204, 21)',
                                'rgb(34, 197, 94)',
                                'rgb(59, 130, 246)'
                              ]
                            : 'rgb(59, 130, 246)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: chartType === 'pie',
                            position: 'bottom'
                        },
                        title: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value}äºº (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: chartType !== 'pie' ? {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 10
                            }
                        }
                    } : {}
                }
            };

            scoreChart = new Chart(ctx, config);
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®æ˜¾ç¤º
        function updateStatistics() {
            const stats = calculateStatistics(gradingData);

            // æ›´æ–°ä¸»è¦ç»Ÿè®¡å¡ç‰‡
            document.getElementById('totalPapers').textContent = stats.total;
            document.getElementById('todayPapers').textContent = stats.todayCount;
            document.getElementById('averageScore').textContent = stats.average;
            document.getElementById('scoreRate').textContent = `${stats.average}%`;
            document.getElementById('passRate').textContent = `${stats.passRate}%`;

            // æ›´æ–°è¯¦ç»†ç»Ÿè®¡
            document.getElementById('maxScore').textContent = `${stats.max}åˆ†`;
            document.getElementById('minScore').textContent = `${stats.min}åˆ†`;
            document.getElementById('medianScore').textContent = `${stats.median}åˆ†`;
            document.getElementById('stdDev').textContent = stats.stdDev;
            document.getElementById('excellentRate').textContent = `${stats.excellentRate}%`;
            document.getElementById('passRateDetail').textContent = `${stats.passRate}%`;
        }

        // å¯¼å‡ºJSONæ•°æ®
        function exportJSON() {
            const exportData = {
                exportTime: new Date().toISOString(),
                statistics: calculateStatistics(gradingData),
                rawData: gradingData
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai_grading_data_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('success', 'å¯¼å‡ºæˆåŠŸ', 'JSONæ•°æ®å·²å¯¼å‡º');
        }

        // å¯¼å‡ºCSVæ•°æ®
        function exportCSV() {
            const headers = ['ID', 'åˆ†æ•°', 'ç§‘ç›®', 'é¢˜å‹', 'è¯„é˜…æ—¶é—´'];
            const rows = gradingData.map(item => [
                item.id,
                item.score,
                item.subject,
                item.paperType,
                item.timestamp.toLocaleString('zh-CN')
            ]);

            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai_grading_details_${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('success', 'å¯¼å‡ºæˆåŠŸ', 'CSVè¯„åˆ†æ˜ç»†å·²å¯¼å‡º');
        }

        // ç”ŸæˆPDFæŠ¥å‘Š
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const stats = calculateStatistics(gradingData);

            // è®¾ç½®ä¸­æ–‡å­—ä½“ï¼ˆä½¿ç”¨é»˜è®¤å­—ä½“ï¼‰
            doc.setFont('helvetica');
            doc.setFontSize(20);
            doc.text('AIé˜…å·æ•°æ®åˆ†ææŠ¥å‘Š', 20, 20);

            doc.setFontSize(12);
            doc.text(`ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString('zh-CN')}`, 20, 30);

            // åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯
            doc.setFontSize(16);
            doc.text('åŸºæœ¬ç»Ÿè®¡', 20, 45);

            doc.setFontSize(12);
            const basicStats = [
                `è¯„é˜…ä»½æ•°: ${stats.total} ä»½`,
                `ä»Šæ—¥æ–°å¢: ${stats.todayCount} ä»½`,
                `å¹³å‡åˆ†: ${stats.average} åˆ†`,
                `æœ€é«˜åˆ†: ${stats.max} åˆ†`,
                `æœ€ä½åˆ†: ${stats.min} åˆ†`,
                `ä¸­ä½æ•°: ${stats.median} åˆ†`,
                `æ ‡å‡†å·®: ${stats.stdDev}`,
                `å¾—åˆ†ç‡: ${stats.average}%`,
                `åŠæ ¼ç‡: ${stats.passRate}%`,
                `ä¼˜ç§€ç‡: ${stats.excellentRate}%`
            ];

            basicStats.forEach((stat, index) => {
                doc.text(stat, 20, 60 + index * 8);
            });

            // åˆ†æ•°åˆ†å¸ƒ
            doc.setFontSize(16);
            doc.text('åˆ†æ•°åˆ†å¸ƒ', 20, 150);

            doc.setFontSize(12);
            const ranges = Object.entries(stats.scoreRanges);
            ranges.forEach(([range, count], index) => {
                const percentage = ((count / stats.total) * 100).toFixed(1);
                doc.text(`${range}åˆ†: ${count}äºº (${percentage}%)`, 20, 165 + index * 8);
            });

            // é¡µè„š
            doc.setFontSize(10);
            doc.text('Generated by AIæ™ºèƒ½é˜…å·åŠ©æ‰‹', 20, 280);

            doc.save(`ai_grading_report_${new Date().toISOString().slice(0, 10)}.pdf`);
            showToast('success', 'ç”ŸæˆæˆåŠŸ', 'PDFåˆ†ææŠ¥å‘Šå·²ç”Ÿæˆ');
        }

        // ========== è¯„åˆ†è®°å½•æŸ¥çœ‹åŠŸèƒ½ ==========
        // åŠ è½½è¯„åˆ†è®°å½•
        function loadReviewRecords() {
            const recordsList = document.getElementById('reviewRecordsList');
            if (!recordsList) return;

            // ä»localStorageè·å–å¤æ ¸æ•°æ®
            const savedData = localStorage.getItem('aiReviewData');
            if (!savedData) {
                recordsList.innerHTML = '<div class="text-center py-8 text-gray-500 text-sm">æš‚æ— è¯„åˆ†è®°å½•</div>';
                return;
            }

            try {
                const reviewData = JSON.parse(savedData);
                const questions = reviewData.questions || {};

                if (Object.keys(questions).length === 0) {
                    recordsList.innerHTML = '<div class="text-center py-8 text-gray-500 text-sm">æš‚æ— è¯„åˆ†è®°å½•</div>';
                    return;
                }

                recordsList.innerHTML = '';
                Object.values(questions).forEach(question => {
                    const recordItem = document.createElement('div');
                    recordItem.className = 'p-3 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-300 transition-colors';

                    // çŠ¶æ€é¢œè‰²
                    const statusColors = {
                        'pending': 'text-yellow-600 bg-yellow-50',
                        'confirmed': 'text-green-600 bg-green-50',
                        'modified': 'text-blue-600 bg-blue-50',
                        'skipped': 'text-gray-600 bg-gray-50'
                    };

                    const statusText = {
                        'pending': 'å¾…ç¡®è®¤',
                        'confirmed': 'å·²ç¡®è®¤',
                        'modified': 'å·²è°ƒæ•´',
                        'skipped': 'å·²è·³è¿‡'
                    };

                    const statusClass = statusColors[question.status] || 'text-gray-600 bg-gray-50';
                    const statusLabel = statusText[question.status] || 'æœªçŸ¥';

                    // æ ¼å¼åŒ–æ—¶é—´
                    const time = new Date(question.timestamp).toLocaleString('zh-CN', {
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    recordItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-medium text-gray-800">${question.questionTitle || 'æœªçŸ¥é¢˜ç›®'}</span>
                                    <span class="text-xs px-2 py-0.5 rounded ${statusClass}">${statusLabel}</span>
                                </div>
                                <div class="mt-1 text-xs text-gray-500">
                                    <span>å¾—åˆ†: ${question.currentScore}åˆ†</span>
                                    ${question.teacherScore ? `<span class="ml-2">æ•™å¸ˆè¯„åˆ†: ${question.teacherScore}åˆ†</span>` : ''}
                                    <span class="ml-2">${time}</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-1">
                                <button class="view-record-btn p-1 text-gray-400 hover:text-blue-600" data-question-id="${question.questionId}" title="æŸ¥çœ‹è¯¦æƒ…">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    recordsList.appendChild(recordItem);
                });

                // é‡æ–°åˆå§‹åŒ–å›¾æ ‡
                lucide.createIcons();
            } catch (error) {
                console.error('åŠ è½½è¯„åˆ†è®°å½•å¤±è´¥:', error);
                recordsList.innerHTML = '<div class="text-center py-8 text-red-500 text-sm">åŠ è½½è®°å½•å¤±è´¥</div>';
            }
        }

        // åˆ·æ–°è¯„åˆ†è®°å½•
        function refreshReviewRecords() {
            loadReviewRecords();
            showToast('success', 'åˆ·æ–°æˆåŠŸ', 'è¯„åˆ†è®°å½•å·²æ›´æ–°');
        }

        // å¯¼å‡ºè¯„åˆ†è®°å½•ï¼ˆæ™ºèƒ½é˜…å·æ¨¡å—ä¸“ç”¨ï¼‰
        function exportReviewRecords() {
            const savedData = localStorage.getItem('aiReviewData');
            if (!savedData) {
                showToast('warning', 'å¯¼å‡ºå¤±è´¥', 'æ²¡æœ‰å¯å¯¼å‡ºçš„è¯„åˆ†è®°å½•');
                return;
            }

            try {
                const reviewData = JSON.parse(savedData);
                const questions = reviewData.questions || {};

                if (Object.keys(questions).length === 0) {
                    showToast('warning', 'å¯¼å‡ºå¤±è´¥', 'æ²¡æœ‰å¯å¯¼å‡ºçš„è¯„åˆ†è®°å½•');
                    return;
                }

                // ç”Ÿæˆæ—¶é—´æˆ³
                const timestamp = new Date().toISOString().slice(0, 10);
                const filename = `ai_scoring_records_${timestamp}`;

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const blob = new Blob([savedData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${filename}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showToast('success', 'å¯¼å‡ºæˆåŠŸ', `è¯„åˆ†è®°å½•å·²å¯¼å‡ºä¸º ${filename}.json`);
            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                showToast('error', 'å¯¼å‡ºå¤±è´¥', 'æ•°æ®æ ¼å¼é”™è¯¯');
            }
        }

        // ========== å¯¼å‡ºåŠŸèƒ½å®ç° ==========
        // å¯¼å‡ºJSONæ ¼å¼
        function exportToJSON() {
            const savedData = localStorage.getItem('aiReviewData');
            if (!savedData) {
                showToast('warning', 'å¯¼å‡ºå¤±è´¥', 'æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
                return;
            }

            const blob = new Blob([savedData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai_grading_records_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('success', 'å¯¼å‡ºæˆåŠŸ', 'JSONæ–‡ä»¶å·²ä¸‹è½½');
        }

        // å¯¼å‡ºCSVæ ¼å¼
        function exportToCSV() {
            const savedData = localStorage.getItem('aiReviewData');
            if (!savedData) {
                showToast('warning', 'å¯¼å‡ºå¤±è´¥', 'æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
                return;
            }

            try {
                const reviewData = JSON.parse(savedData);
                const questions = reviewData.questions || {};

                // CSVå¤´éƒ¨
                const headers = ['é¢˜ç›®ID', 'é¢˜ç›®æ ‡é¢˜', 'å½“å‰å¾—åˆ†', 'AIå»ºè®®', 'æ•™å¸ˆè¯„åˆ†', 'å¤æ ¸çŠ¶æ€', 'å¤æ ¸æ¬¡æ•°', 'ä¿®æ”¹æ¬¡æ•°', 'æ—¶é—´'];

                // CSVæ•°æ®è¡Œ
                const rows = [headers];
                Object.values(questions).forEach(question => {
                    const statusText = {
                        'pending': 'å¾…ç¡®è®¤',
                        'confirmed': 'å·²ç¡®è®¤',
                        'modified': 'å·²è°ƒæ•´',
                        'skipped': 'å·²è·³è¿‡'
                    };

                    const row = [
                        question.questionId || '',
                        question.questionTitle || '',
                        question.currentScore || 0,
                        question.aiScore || 0,
                        question.teacherScore || 0,
                        statusText[question.status] || 'æœªçŸ¥',
                        question.reviewRecord?.confirmations || 0,
                        question.reviewRecord?.modifications || 0,
                        new Date(question.timestamp).toLocaleString('zh-CN')
                    ];
                    rows.push(row);
                });

                // è½¬æ¢ä¸ºCSVå­—ç¬¦ä¸²
                const csvContent = rows.map(row =>
                    row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
                ).join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ai_grading_records_${new Date().toISOString().slice(0, 10)}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showToast('success', 'å¯¼å‡ºæˆåŠŸ', 'CSVæ–‡ä»¶å·²ä¸‹è½½');
            } catch (error) {
                console.error('CSVå¯¼å‡ºå¤±è´¥:', error);
                showToast('error', 'å¯¼å‡ºå¤±è´¥', 'æ•°æ®æ ¼å¼é”™è¯¯');
            }
        }

        // ========== è®¾ç½®ä¿å­˜/åŠ è½½åŠŸèƒ½ ==========
        // ä¿å­˜è®¾ç½®åˆ°localStorage
        function saveSettings() {
            const settings = {
                // APIå¯†é’¥è®¾ç½®
                apiKeys: {
                    openai: {
                        endpoint: document.querySelector('#settings-api input[placeholder*="openai"]')?.value || '',
                        model: document.querySelector('#settings-api select')?.value || 'gpt-4o',
                        key: document.querySelector('#settings-api input[type="password"]')?.value || ''
                    },
                    gemini: {
                        endpoint: document.querySelectorAll('#settings-api input[type="text"]')[1]?.value || '',
                        model: document.querySelectorAll('#settings-api select')[1]?.value || 'gemini-2.5-pro',
                        key: document.querySelectorAll('#settings-api input[type="password"]')[1]?.value || ''
                    },
                    zhipu: {
                        endpoint: document.querySelectorAll('#settings-api input[type="text"]')[2]?.value || '',
                        model: document.querySelectorAll('#settings-api select')[2]?.value || 'glm-4.5-vision',
                        key: document.querySelectorAll('#settings-api input[type="password"]')[2]?.value || ''
                    }
                },
                // æ¨¡å‹å‚æ•°è®¾ç½®
                modelParams: {
                    gpt4o: {
                        temp: parseFloat(document.getElementById('gpt4o-temp')?.value || 0.7),
                        maxTokens: parseInt(document.getElementById('gpt4o-max-tokens')?.value || 2048),
                        topp: parseFloat(document.getElementById('gpt4o-topp')?.value || 0.9)
                    },
                    gemini: {
                        temp: parseFloat(document.getElementById('gemini-temp')?.value || 0.6),
                        maxTokens: parseInt(document.getElementById('gemini-max-tokens')?.value || 2048),
                        topk: parseInt(document.getElementById('gemini-topk')?.value || 40)
                    },
                    glm: {
                        temp: parseFloat(document.getElementById('glm-temp')?.value || 0.65),
                        maxTokens: parseInt(document.getElementById('glm-max-tokens')?.value || 2048),
                        penalty: parseFloat(document.getElementById('glm-penalty')?.value || 1.1)
                    }
                },
                // é˜…å·ç­–ç•¥
                gradingStrategy: document.querySelector('input[name="grading-strategy"]:checked')?.value || 'gpt4o',
                // é«˜çº§è®¾ç½®
                advancedSettings: {
                    autoSave: document.querySelector('#settings-advanced input[type="checkbox"]')?.checked || false,
                    dualModelValidation: document.querySelectorAll('#settings-advanced input[type="checkbox"]')[1]?.checked || false,
                    gradingSpeed: parseInt(document.querySelector('#settings-advanced input[type="range"]')?.value || 3)
                },
                // ä¿å­˜æ—¶é—´
                lastModified: new Date().toISOString()
            };

            localStorage.setItem('aiGradingSettings', JSON.stringify(settings));
            showToast('success', 'ä¿å­˜æˆåŠŸ', 'è®¾ç½®å·²ä¿å­˜åˆ°æœ¬åœ°');
            closeSettingsModal();
        }

        // ä»localStorageåŠ è½½è®¾ç½®
        function loadSettings() {
            const saved = localStorage.getItem('aiGradingSettings');
            if (!saved) {
                // å¦‚æœæ²¡æœ‰ä¿å­˜çš„è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼
                return;
            }

            try {
                const settings = JSON.parse(saved);

                // åŠ è½½APIå¯†é’¥è®¾ç½®
                if (settings.apiKeys) {
                    const inputs = document.querySelectorAll('#settings-api input[type="text"]');
                    const passwords = document.querySelectorAll('#settings-api input[type="password"]');
                    const selects = document.querySelectorAll('#settings-api select');

                    if (settings.apiKeys.openai && inputs[0]) {
                        inputs[0].value = settings.apiKeys.openai.endpoint || '';
                        if (selects[0]) selects[0].value = settings.apiKeys.openai.model || 'gpt-4o';
                        if (passwords[0]) passwords[0].value = settings.apiKeys.openai.key || '';
                    }
                    if (settings.apiKeys.gemini && inputs[1]) {
                        inputs[1].value = settings.apiKeys.gemini.endpoint || '';
                        if (selects[1]) selects[1].value = settings.apiKeys.gemini.model || 'gemini-2.5-pro';
                        if (passwords[1]) passwords[1].value = settings.apiKeys.gemini.key || '';
                    }
                    if (settings.apiKeys.zhipu && inputs[2]) {
                        inputs[2].value = settings.apiKeys.zhipu.endpoint || '';
                        if (selects[2]) selects[2].value = settings.apiKeys.zhipu.model || 'glm-4.5-vision';
                        if (passwords[2]) passwords[2].value = settings.apiKeys.zhipu.key || '';
                    }
                }

                // åŠ è½½æ¨¡å‹å‚æ•°è®¾ç½®
                if (settings.modelParams) {
                    // GPT-4o
                    if (settings.modelParams.gpt4o) {
                        const gpt4o = settings.modelParams.gpt4o;
                        if (document.getElementById('gpt4o-temp')) {
                            document.getElementById('gpt4o-temp').value = gpt4o.temp;
                            document.getElementById('gpt4o-temp-value').textContent = gpt4o.temp;
                        }
                        if (document.getElementById('gpt4o-max-tokens')) {
                            document.getElementById('gpt4o-max-tokens').value = gpt4o.maxTokens;
                            document.getElementById('gpt4o-max-tokens-value').textContent = gpt4o.maxTokens;
                        }
                        if (document.getElementById('gpt4o-topp')) {
                            document.getElementById('gpt4o-topp').value = gpt4o.topp;
                            document.getElementById('gpt4o-topp-value').textContent = gpt4o.topp;
                        }
                    }

                    // Gemini
                    if (settings.modelParams.gemini) {
                        const gemini = settings.modelParams.gemini;
                        if (document.getElementById('gemini-temp')) {
                            document.getElementById('gemini-temp').value = gemini.temp;
                            document.getElementById('gemini-temp-value').textContent = gemini.temp;
                        }
                        if (document.getElementById('gemini-max-tokens')) {
                            document.getElementById('gemini-max-tokens').value = gemini.maxTokens;
                            document.getElementById('gemini-max-tokens-value').textContent = gemini.maxTokens;
                        }
                        if (document.getElementById('gemini-topk')) {
                            document.getElementById('gemini-topk').value = gemini.topk;
                            document.getElementById('gemini-topk-value').textContent = gemini.topk;
                        }
                    }

                    // GLM-4.5V
                    if (settings.modelParams.glm) {
                        const glm = settings.modelParams.glm;
                        if (document.getElementById('glm-temp')) {
                            document.getElementById('glm-temp').value = glm.temp;
                            document.getElementById('glm-temp-value').textContent = glm.temp;
                        }
                        if (document.getElementById('glm-max-tokens')) {
                            document.getElementById('glm-max-tokens').value = glm.maxTokens;
                            document.getElementById('glm-max-tokens-value').textContent = glm.maxTokens;
                        }
                        if (document.getElementById('glm-penalty')) {
                            document.getElementById('glm-penalty').value = glm.penalty;
                            document.getElementById('glm-penalty-value').textContent = glm.penalty;
                        }
                    }
                }

                // åŠ è½½é˜…å·ç­–ç•¥
                if (settings.gradingStrategy) {
                    const strategyRadio = document.querySelector(`input[name="grading-strategy"][value="${settings.gradingStrategy}"]`);
                    if (strategyRadio) {
                        strategyRadio.checked = true;
                        strategyRadio.dispatchEvent(new Event('change'));
                    }
                }

                // åŠ è½½é«˜çº§è®¾ç½®
                if (settings.advancedSettings) {
                    const checks = document.querySelectorAll('#settings-advanced input[type="checkbox"]');
                    const range = document.querySelector('#settings-advanced input[type="range"]');

                    if (settings.advancedSettings.autoSave && checks[0]) {
                        checks[0].checked = true;
                    }
                    if (settings.advancedSettings.dualModelValidation && checks[1]) {
                        checks[1].checked = true;
                    }
                    if (range && settings.advancedSettings.gradingSpeed) {
                        range.value = settings.advancedSettings.gradingSpeed;
                    }
                }

                // æ›´æ–°æ»‘å—è¿›åº¦æ˜¾ç¤º
                initSliderInteraction();

                showToast('info', 'è®¾ç½®å·²åŠ è½½', 'å·²ä»æœ¬åœ°åŠ è½½ä¿å­˜çš„è®¾ç½®');
            } catch (error) {
                console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);
                showToast('warning', 'åŠ è½½å¤±è´¥', 'æ— æ³•åŠ è½½ä¿å­˜çš„è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®');
            }
        }

        // é‡ç½®è®¾ç½®
        function resetSettings() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                localStorage.removeItem('aiGradingSettings');
                showToast('success', 'é‡ç½®æˆåŠŸ', 'æ‰€æœ‰è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
                // é‡æ–°åŠ è½½é¡µé¢ä»¥åº”ç”¨é»˜è®¤è®¾ç½®
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }

        // æ·»åŠ é‡ç½®æŒ‰é’®äº‹ä»¶ï¼ˆåœ¨é«˜çº§è®¾ç½®é¡µé¢ï¼‰
        const resetSettingsBtn = document.createElement('button');
        resetSettingsBtn.className = 'w-full mt-4 py-2 px-4 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors flex items-center justify-center space-x-2';
        resetSettingsBtn.innerHTML = '<i data-lucide="rotate-ccw" class="w-4 h-4"></i><span>é‡ç½®æ‰€æœ‰è®¾ç½®</span>';
        resetSettingsBtn.addEventListener('click', resetSettings);

        // å°†é‡ç½®æŒ‰é’®æ·»åŠ åˆ°é«˜çº§è®¾ç½®åŒºåŸŸ
        const advancedSection = document.querySelector('#settings-advanced .space-y-3');
        if (advancedSection) {
            advancedSection.appendChild(resetSettingsBtn);
        }

        // å¯¼å‡ºè®¾ç½®
        function exportSettings() {
            const settings = localStorage.getItem('aiGradingSettings');
            if (!settings) {
                showToast('warning', 'å¯¼å‡ºå¤±è´¥', 'æ²¡æœ‰å¯å¯¼å‡ºçš„è®¾ç½®');
                return;
            }

            const blob = new Blob([settings], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai_grading_settings_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('success', 'å¯¼å‡ºæˆåŠŸ', 'è®¾ç½®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶');
        }

        // å¯¼å…¥è®¾ç½®
        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';

            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const settings = JSON.parse(e.target.result);
                        localStorage.setItem('aiGradingSettings', JSON.stringify(settings));
                        showToast('success', 'å¯¼å…¥æˆåŠŸ', 'è®¾ç½®å·²å¯¼å…¥å¹¶ä¿å­˜');
                        loadSettings();
                    } catch (error) {
                        showToast('error', 'å¯¼å…¥å¤±è´¥', 'æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                    }
                };
                reader.readAsText(file);
            });

            input.click();
        }

        // æ·»åŠ å¯¼å‡º/å¯¼å…¥æŒ‰é’®ï¼ˆåœ¨APIå¯†é’¥ç®¡ç†é¡µé¢ï¼‰
        const settingsApiSection = document.querySelector('#settings-api');
        if (settingsApiSection) {
            const exportImportDiv = document.createElement('div');
            exportImportDiv.className = 'mt-4 flex space-x-2';
            exportImportDiv.innerHTML = `
                <button id="exportSettingsBtn" class="flex-1 py-2 px-3 bg-blue-500 hover:bg-blue-600 text-white text-sm rounded-lg font-medium transition-colors flex items-center justify-center space-x-1">
                    <i data-lucide="download" class="w-4 h-4"></i>
                    <span>å¯¼å‡ºè®¾ç½®</span>
                </button>
                <button id="importSettingsBtn" class="flex-1 py-2 px-3 bg-green-500 hover:bg-green-600 text-white text-sm rounded-lg font-medium transition-colors flex items-center justify-center space-x-1">
                    <i data-lucide="upload" class="w-4 h-4"></i>
                    <span>å¯¼å…¥è®¾ç½®</span>
                </button>
            `;
            settingsApiSection.appendChild(exportImportDiv);

            // ç»‘å®šå¯¼å‡º/å¯¼å…¥æŒ‰é’®äº‹ä»¶
            document.getElementById('exportSettingsBtn')?.addEventListener('click', exportSettings);
            document.getElementById('importSettingsBtn')?.addEventListener('click', importSettings);
        }

        // ç»‘å®šå¯¼å‡ºæŒ‰é’®äº‹ä»¶
        document.getElementById('exportJsonBtn').addEventListener('click', exportToJSON);
        document.getElementById('exportCsvBtn').addEventListener('click', exportToCSV);
        document.getElementById('exportPdfBtn').addEventListener('click', generatePDF);

        // ç»‘å®šåˆ·æ–°è®°å½•æŒ‰é’®äº‹ä»¶
        document.getElementById('refreshRecordsBtn').addEventListener('click', refreshReviewRecords);

        // ç»‘å®šå¯¼å‡ºè®°å½•æŒ‰é’®äº‹ä»¶
        document.getElementById('exportRecordsBtn')?.addEventListener('click', exportReviewRecords);

        // ç»‘å®šæŸ¥çœ‹è®°å½•æŒ‰é’®äº‹ä»¶ï¼ˆä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¼‰
        document.addEventListener('click', function(event) {
            if (event.target.closest('.view-record-btn')) {
                const button = event.target.closest('.view-record-btn');
                const questionId = button.getAttribute('data-question-id');
                showToast('info', 'æŸ¥çœ‹è¯¦æƒ…', `æŸ¥çœ‹é¢˜ç›® ${questionId} çš„è¯¦ç»†è®°å½•`);
            }
        });

        // ========== åˆå§‹åŒ–é˜…å·ç•Œé¢ ==========
        function initGradingInterface() {
            const startBtn = document.getElementById('startGradingBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const exportBtn = document.getElementById('exportBtn');
            const helpBtn = document.getElementById('helpBtn');
            const viewCriteriaBtn = document.getElementById('viewCriteriaBtn');
            const recalibrateBtn = document.getElementById('recalibrateBtn');

            // æŸ¥çœ‹è¯„åˆ†ç»†åˆ™
            if (viewCriteriaBtn) {
                viewCriteriaBtn.addEventListener('click', () => {
                    showToast('info', 'è¯„åˆ†ç»†åˆ™ v1.2', 'è§‚ç‚¹æ˜ç¡®(30åˆ†) | å²å®å‡†ç¡®(30åˆ†) | è®ºè¿°å……åˆ†(25åˆ†) | è¯­è¨€è¡¨è¾¾(15åˆ†)');
                });
            }

            // é‡æ–°æ ¡å‡†
            if (recalibrateBtn) {
                recalibrateBtn.addEventListener('click', () => {
                    showToast('warning', 'é‡æ–°æ ¡å‡†', 'å°†è¿”å›æ ·é¢˜è¯•é˜…é¡µé¢é‡æ–°æ ¡å‡†è¯„åˆ†ç»†åˆ™');
                });
            }

            // å¼€å§‹é˜…å·
            if (startBtn) {
                startBtn.addEventListener('click', () => {
                    showToast('info', 'å¼€å§‹é˜…å·', 'AIæ­£åœ¨åˆ†æå­¦ç”Ÿç­”é¢˜å¡...');
                    startBtn.disabled = true;
                    startBtn.innerHTML = '<span class="loading inline-block w-5 h-5 border-2 border-white border-t-transparent rounded-full mr-2"></span><span>AIé˜…å·ä¸­...</span>';

                    // æ¨¡æ‹ŸAIé˜…å·è¿‡ç¨‹
                    setTimeout(() => {
                        showToast('success', 'é˜…å·å®Œæˆ', 'å¼ ä¸‰åŒå­¦å¾—åˆ†ï¼š85/100ï¼Œæ™ºå­¦ç½‘å°†è‡ªåŠ¨è·³è½¬ä¸‹ä¸€ä»½');
                        startBtn.disabled = false;
                        startBtn.innerHTML = '<i data-lucide="zap" class="w-5 h-5"></i><span>âš¡ å¼€å§‹é˜…å·</span>';
                        lucide.createIcons();
                        updateProgress();
                    }, 3000);
                });
            }

            // æš‚åœ/ç»§ç»­
            if (pauseBtn) {
                pauseBtn.addEventListener('click', () => {
                    if (pauseBtn.innerHTML.includes('æš‚åœ')) {
                        showToast('warning', 'å·²æš‚åœ', 'é˜…å·å·²æš‚åœï¼Œå¯éšæ—¶ç»§ç»­');
                        pauseBtn.innerHTML = '<i data-lucide="play" class="w-5 h-5"></i><span>â–¶ï¸ ç»§ç»­</span>';
                    } else {
                        showToast('info', 'ç»§ç»­é˜…å·', 'å·²æ¢å¤é˜…å·');
                        pauseBtn.innerHTML = '<i data-lucide="pause" class="w-5 h-5"></i><span>â¸ï¸ æš‚åœ</span>';
                    }
                    lucide.createIcons();
                });
            }

            // å¯¼å‡ºæˆç»©
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    showToast('success', 'å¯¼å‡ºæˆåŠŸ', 'æˆç»©æŠ¥å‘Šå·²ç”Ÿæˆå¹¶ä¸‹è½½');
                });
            }

            // å¸®åŠ©
            if (helpBtn) {
                helpBtn.addEventListener('click', () => {
                    showToast('info', 'å¸®åŠ©æ–‡æ¡£', 'æŸ¥çœ‹æ™ºèƒ½é˜…å·ä½¿ç”¨è¯´æ˜');
                });
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const progressBar = document.querySelector('#tab-content-grading .h-3.rounded-full');
            if (progressBar) {
                const currentProgress = 40;
                const newProgress = Math.min(currentProgress + 10, 100);
                progressBar.style.width = newProgress + '%';

                // æ›´æ–°è¿›åº¦æ–‡å­—
                const progressText = document.querySelector('#tab-content-grading .space-y-3 div:nth-child(2) span:first-child');
                if (progressText) {
                    progressText.textContent = `è¿›åº¦ï¼š${Math.floor(newProgress / 100 * 15)}/15 ä»½`;
                }
            }
        }

        // é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveReviewData();
                        break;
                    case 'n':
                        e.preventDefault();
                        nextReview();
                        break;
                    case 'e':
                        e.preventDefault();
                        exportReviewReport();
                        break;
                }
            }

            // ========== å…¨å±€åˆå§‹åŒ– ==========
            // åˆå§‹åŒ–ç»Ÿè®¡æ•°æ®å’Œå›¾è¡¨
            updateStatistics();
            initChart();

            // åˆå§‹åŒ–é˜…å·ç•Œé¢
            initGradingInterface();

            // åˆå§‹åŒ–è¯„åˆ†ç»“æœï¼ˆåŸºäºè¯„åˆ†ç»†åˆ™ï¼‰
            initScoringResults();

            // åˆå§‹åŒ–è¯„åˆ†è®°å½•åˆ—è¡¨
            loadReviewRecords();

            console.log('AIæ™ºèƒ½é˜…å·åŠ©æ‰‹å·²å®Œå…¨åŠ è½½å®Œæˆ');
        });

        }); // ç»“æŸDOMContentLoadedäº‹ä»¶ç›‘å¬å™¨

        // ==================== è¯„åˆ†è®¾ç½®å³ä¾§æ»‘å‡ºé¢æ¿ ====================
        const statusRubricConfig = document.getElementById('status-rubric-config');
        let rubricDrawerOpen = false;

        // åˆ›å»ºå³ä¾§æ»‘å‡ºé¢æ¿ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        function createRubricDrawer() {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            if (document.getElementById('rubric-drawer')) return;

            const drawerHTML = `
                <!-- è¯„åˆ†è®¾ç½®å³ä¾§æ»‘å‡ºé¢æ¿ -->
                <div id="rubric-drawer" class="fixed inset-0 z-50 hidden">
                    <!-- èƒŒæ™¯é®ç½© -->
                    <div id="rubric-drawer-backdrop" class="absolute inset-0 bg-black/50 backdrop-blur-sm opacity-0 transition-opacity"></div>

                    <!-- æ»‘å‡ºé¢æ¿ -->
                    <div id="rubric-drawer-panel" class="absolute right-0 top-0 h-full w-full max-w-md sm:max-w-md md:max-w-lg bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out overflow-y-auto">
                        <!-- é¢æ¿å¤´éƒ¨ -->
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 sticky top-0 z-10">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i data-lucide="clipboard-list" class="w-6 h-6"></i>
                                    <h2 class="text-lg font-semibold">è¯„åˆ†è®¾ç½®</h2>
                                </div>
                                <button id="rubric-drawer-close" class="p-1 hover:bg-white/20 rounded-lg transition-colors">
                                    <i data-lucide="x" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>

                        <!-- é¢æ¿å†…å®¹ -->
                        <div class="p-4">
                            <!-- Tabå¯¼èˆª -->
                            <div class="flex border-b border-gray-200 mb-4">
                                <button id="tab-import" class="tab-btn active px-4 py-2 text-sm font-medium border-b-2 border-blue-500 text-blue-600 hover:text-blue-700">
                                    <i data-lucide="upload" class="w-4 h-4 inline mr-2"></i>
                                    å¯¼å…¥è¯„åˆ†ç»†åˆ™
                                </button>
                                <button id="tab-ai" class="tab-btn px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                                    <i data-lucide="brain" class="w-4 h-4 inline mr-2"></i>
                                    AIæ™ºèƒ½ä¼˜åŒ–
                                </button>
                            </div>

                            <!-- Tabå†…å®¹åŒºåŸŸ -->
                            <div class="tab-content-wrapper">
                                <!-- Tab 1: å¯¼å…¥è¯„åˆ†ç»†åˆ™ -->
                                <div id="content-import" class="tab-content">
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">ä»æ–‡ä»¶å¯¼å…¥</label>
                                            <input type="file" id="import-file" accept=".json,.csv" class="w-full text-xs text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                                            <p class="text-xs text-gray-500 mt-1">æ”¯æŒæ ¼å¼ï¼šJSONã€CSV</p>
                                        </div>

                                        <!-- å¯¼å…¥æç¤º -->
                                        <div class="bg-blue-50 border border-blue-100 rounded-lg p-3">
                                            <div class="flex items-start space-x-2">
                                                <i data-lucide="info" class="w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"></i>
                                                <div>
                                                    <div class="text-xs font-medium text-blue-900 mb-1">å¯¼å…¥è¯´æ˜</div>
                                                    <ul class="text-xs text-blue-700 space-y-0.5">
                                                        <li>â€¢ æ”¯æŒJSONå’ŒCSVæ ¼å¼çš„è¯„åˆ†ç»†åˆ™æ–‡ä»¶</li>
                                                        <li>â€¢ å¯¼å…¥åå¯åœ¨å³ä¾§æŸ¥çœ‹ç»´åº¦æ•°é‡</li>
                                                        <li>â€¢ ç‚¹å‡»"ä¿å­˜è®¾ç½®"åº”ç”¨åˆ°å½“å‰é˜…å·</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 2: AIæ™ºèƒ½ä¼˜åŒ– -->
                                <div id="content-ai" class="tab-content hidden">
                                    <div class="space-y-3">
                                        <p class="text-xs text-gray-500">åŸºäºè¯•é¢˜å’Œå‚è€ƒç­”æ¡ˆè‡ªåŠ¨ç”Ÿæˆè¯„åˆ†ç»†åˆ™</p>

                                        <!-- AIåˆ†æè¾“å…¥åŒº -->
                                        <div class="space-y-3">
                                            <!-- é¢˜ç›®å†…å®¹è¾“å…¥ -->
                                            <div>
                                                <div class="flex items-center justify-between mb-1">
                                                    <label class="text-xs font-medium text-gray-700">é¢˜ç›®å†…å®¹</label>
                                                    <button id="import-question-btn" class="text-xs text-purple-600 hover:text-purple-700 flex items-center">
                                                        <i data-lucide="file-image" class="w-3 h-3 mr-1"></i>
                                                        å¯¼å…¥PDF/å›¾ç‰‡
                                                    </button>
                                                    <input type="file" id="import-question-file" accept=".pdf,.png,.jpg,.jpeg" class="hidden">
                                                </div>
                                                <textarea id="ai-question" rows="3" class="w-full text-xs border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="è¯·è¾“å…¥å®Œæ•´çš„é¢˜ç›®å†…å®¹...æˆ–ç‚¹å‡»å³ä¾§æŒ‰é’®å¯¼å…¥PDF/å›¾ç‰‡"></textarea>
                                            </div>

                                            <!-- å‚è€ƒç­”æ¡ˆè¾“å…¥ -->
                                            <div>
                                                <div class="flex items-center justify-between mb-1">
                                                    <label class="text-xs font-medium text-gray-700">å‚è€ƒç­”æ¡ˆ</label>
                                                    <button id="import-answer-btn" class="text-xs text-purple-600 hover:text-purple-700 flex items-center">
                                                        <i data-lucide="file-image" class="w-3 h-3 mr-1"></i>
                                                        å¯¼å…¥PDF/å›¾ç‰‡
                                                    </button>
                                                    <input type="file" id="import-answer-file" accept=".pdf,.png,.jpg,.jpeg" class="hidden">
                                                </div>
                                                <textarea id="ai-answer" rows="3" class="w-full text-xs border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="è¯·è¾“å…¥å‚è€ƒç­”æ¡ˆ...æˆ–ç‚¹å‡»å³ä¾§æŒ‰é’®å¯¼å…¥PDF/å›¾ç‰‡"></textarea>
                                            </div>

                                            <button id="ai-optimize-btn" class="w-full py-2 px-4 bg-gradient-to-r from-purple-500 to-blue-600 text-white rounded-lg text-sm font-medium hover:from-purple-600 hover:to-blue-700 transition-all flex items-center justify-center">
                                                <i data-lucide="sparkles" class="w-4 h-4 mr-2"></i>
                                                AIä¸€é”®ä¼˜åŒ–
                                            </button>
                                        </div>

                                        <!-- AIä¼˜åŒ–æç¤º -->
                                        <div class="bg-purple-50 border border-purple-100 rounded-lg p-3">
                                            <div class="flex items-start space-x-2">
                                                <i data-lucide="lightbulb" class="w-4 h-4 text-purple-600 mt-0.5 flex-shrink-0"></i>
                                                <div>
                                                    <div class="text-xs font-medium text-purple-900 mb-1">AIä¼˜åŒ–ä¼˜åŠ¿</div>
                                                    <ul class="text-xs text-purple-700 space-y-0.5">
                                                        <li>â€¢ æ•ˆç‡æå‡20-30å€</li>
                                                        <li>â€¢ å‡†ç¡®æ€§æå‡15-20%</li>
                                                        <li>â€¢ æ™ºèƒ½æƒé‡åˆ†é…</li>
                                                        <li>â€¢ æ”¯æŒæ‰€æœ‰é¢˜å‹</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ä½¿ç”¨è¯´æ˜ -->
                        <div class="px-4 pb-4">
                            <div class="bg-blue-50 border border-blue-100 rounded-lg p-3">
                                <div class="flex items-start space-x-2">
                                    <i data-lucide="info" class="w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"></i>
                                    <div>
                                        <div class="text-xs font-medium text-blue-900 mb-1">ä½¿ç”¨è¯´æ˜</div>
                                        <ul class="text-xs text-blue-700 space-y-1">
                                            <li>â€¢ åˆ‡æ¢Tabé€‰æ‹©å¯¼å…¥æˆ–AIä¼˜åŒ–åŠŸèƒ½</li>
                                            <li>â€¢ å¯¼å…¥è¯„åˆ†ç»†åˆ™ï¼šæ”¯æŒJSON/CSVæ ¼å¼</li>
                                            <li>â€¢ AIæ™ºèƒ½ä¼˜åŒ–ï¼šæ”¯æŒPDF/å›¾ç‰‡/æ–‡æœ¬è¾“å…¥</li>
                                            <li>â€¢ å®Œæˆè®¾ç½®åç‚¹å‡»"ä¿å­˜è®¾ç½®"ç”Ÿæ•ˆ</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- é¢æ¿åº•éƒ¨æ“ä½œåŒº -->
                        <div class="sticky bottom-0 bg-white border-t border-gray-200 p-4 mt-6">
                            <div class="flex space-x-3">
                                <button id="rubric-drawer-test" class="py-2 px-4 bg-purple-500 hover:bg-purple-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center">
                                    <i data-lucide="play" class="w-4 h-4 mr-2"></i>
                                    æµ‹è¯•è®¾ç½®
                                </button>
                                <button id="rubric-drawer-cancel" class="flex-1 py-2 px-4 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
                                    é‡ç½®
                                </button>
                                <button id="rubric-drawer-save" class="flex-1 py-2 px-4 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors">
                                    ä¿å­˜è®¾ç½®
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', drawerHTML);
            lucide.createIcons();

            // ç»‘å®šäº‹ä»¶
            bindRubricDrawerEvents();
        }

        // ç»‘å®šå³ä¾§æ»‘å‡ºé¢æ¿äº‹ä»¶
        function bindRubricDrawerEvents() {
            const drawer = document.getElementById('rubric-drawer');
            const backdrop = document.getElementById('rubric-drawer-backdrop');
            const panel = document.getElementById('rubric-drawer-panel');
            const closeBtn = document.getElementById('rubric-drawer-close');
            const cancelBtn = document.getElementById('rubric-drawer-cancel');
            const saveBtn = document.getElementById('rubric-drawer-save');

            // æ‰“å¼€é¢æ¿
            function openDrawer() {
                drawer.classList.remove('hidden');
                setTimeout(() => {
                    backdrop.classList.remove('opacity-0');
                    panel.classList.remove('translate-x-full');
                    rubricDrawerOpen = true;
                }, 10);
                document.body.style.overflow = 'hidden';
            }

            // å…³é—­é¢æ¿
            function closeDrawer() {
                backdrop.classList.add('opacity-0');
                panel.classList.add('translate-x-full');
                setTimeout(() => {
                    drawer.classList.add('hidden');
                    document.body.style.overflow = '';
                    rubricDrawerOpen = false;
                }, 300);
            }

            // ==================== Tabåˆ‡æ¢åŠŸèƒ½ ====================
            // åˆå§‹åŒ–tab
            const tabImport = document.getElementById('tab-import');
            const tabAI = document.getElementById('tab-ai');
            const contentImport = document.getElementById('content-import');
            const contentAI = document.getElementById('content-ai');

            // Tabåˆ‡æ¢å‡½æ•°
            function switchTab(tab) {
                // ç§»é™¤æ‰€æœ‰tabçš„activeçŠ¶æ€
                tabImport.classList.remove('active', 'border-blue-500', 'text-blue-600');
                tabImport.classList.add('border-transparent', 'text-gray-500');
                tabAI.classList.remove('active', 'border-purple-500', 'text-purple-600');
                tabAI.classList.add('border-transparent', 'text-gray-500');

                // éšè—æ‰€æœ‰å†…å®¹
                contentImport.classList.add('hidden');
                contentAI.classList.add('hidden');

                // æ˜¾ç¤ºå¯¹åº”å†…å®¹
                if (tab === 'import') {
                    tabImport.classList.add('active', 'border-blue-500', 'text-blue-600');
                    tabImport.classList.remove('border-transparent', 'text-gray-500');
                    contentImport.classList.remove('hidden');
                } else if (tab === 'ai') {
                    tabAI.classList.add('active', 'border-purple-500', 'text-purple-600');
                    tabAI.classList.remove('border-transparent', 'text-gray-500');
                    contentAI.classList.remove('hidden');
                }

                // é‡æ–°åˆå§‹åŒ–Lucideå›¾æ ‡
                lucide.createIcons();
            }

            // ç»‘å®štabç‚¹å‡»äº‹ä»¶
            if (tabImport) {
                tabImport.addEventListener('click', () => switchTab('import'));
            }
            if (tabAI) {
                tabAI.addEventListener('click', () => switchTab('ai'));
            }

            // è®¾ç½®é»˜è®¤æ˜¾ç¤ºå¯¼å…¥è¯„åˆ†ç»†åˆ™tab
            switchTab('import');

            // ç»‘å®šè§¦å‘å™¨
            if (statusRubricConfig) {
                statusRubricConfig.addEventListener('click', openDrawer);
            }

            // å…³é—­äº‹ä»¶
            if (closeBtn) closeBtn.addEventListener('click', closeDrawer);
            if (backdrop) backdrop.addEventListener('click', closeDrawer);

            // æµ‹è¯•æŒ‰é’®äº‹ä»¶
            const testBtn = document.getElementById('rubric-drawer-test');
            if (testBtn) {
                testBtn.addEventListener('click', () => {
                    // æ”¶é›†å½“å‰è®¾ç½®çŠ¶æ€
                    const aiQuestion = document.getElementById('ai-question');
                    const aiAnswer = document.getElementById('ai-answer');

                    showToast('info', 'æµ‹è¯•è¿è¡Œä¸­', `å½“å‰åŠŸèƒ½ï¼šAIæ™ºèƒ½ä¼˜åŒ–ã€å¯¼å…¥è¯„åˆ†ç»†åˆ™`);
                    console.log('æµ‹è¯•è®¾ç½®:', {
                        aiOptimizeAvailable: !!(aiQuestion && aiAnswer),
                        importEnabled: true,
                        timestamp: new Date().toISOString()
                    });
                });
            }

            if (cancelBtn) {
                cancelBtn.addEventListener('click', () => {
                    showToast('info', 'å·²é‡ç½®', 'è¯„åˆ†è®¾ç½®å·²æ¢å¤åˆ°é»˜è®¤çŠ¶æ€');
                    closeDrawer();
                });
            }
            if (saveBtn) {
                saveBtn.addEventListener('click', () => {
                    showToast('success', 'ä¿å­˜æˆåŠŸ', 'è¯„åˆ†è®¾ç½®å·²æ›´æ–°å¹¶åº”ç”¨åˆ°å½“å‰é˜…å·');
                    closeDrawer();
                });
            }

            // ==================== AIæ™ºèƒ½ä¼˜åŒ–åŠŸèƒ½ ====================

            // AIä¼˜åŒ–æŒ‰é’®äº‹ä»¶
            const aiOptimizeBtn = document.getElementById('ai-optimize-btn');
            if (aiOptimizeBtn) {
                aiOptimizeBtn.addEventListener('click', async () => {
                    const question = document.getElementById('ai-question').value;
                    const answer = document.getElementById('ai-answer').value;

                    if (!question || !answer) {
                        showToast('warning', 'è¯·å¡«å†™å†…å®¹', 'è¯·è¾“å…¥é¢˜ç›®å†…å®¹å’Œå‚è€ƒç­”æ¡ˆ');
                        return;
                    }

                    // æ˜¾ç¤ºAIåˆ†æè¿›åº¦
                    showAIAnalysisProgress();

                    try {
                        // è°ƒç”¨AIåˆ†æ
                        const result = await runAIAnalysis(question, answer);

                        // åº”ç”¨åˆ†æç»“æœ
                        applyAIAnalysisResult(result);

                        showToast('success', 'AIä¼˜åŒ–å®Œæˆ', 'å·²æ ¹æ®è¯•é¢˜è‡ªåŠ¨ç”Ÿæˆè¯„åˆ†ç»†åˆ™');
                    } catch (error) {
                        showToast('error', 'åˆ†æå¤±è´¥', error.message);
                    }
                });
            }

            // ==================== é¢˜ç›®/ç­”æ¡ˆå¯¼å…¥åŠŸèƒ½ ====================

            // å¯¼å…¥é¢˜ç›®å†…å®¹æŒ‰é’®
            const importQuestionBtn = document.getElementById('import-question-btn');
            const importQuestionFile = document.getElementById('import-question-file');
            if (importQuestionBtn && importQuestionFile) {
                importQuestionBtn.addEventListener('click', () => {
                    importQuestionFile.click();
                });
                importQuestionFile.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    try {
                        const extractedText = await parseFileToText(file, 'é¢˜ç›®');
                        fillTextarea('ai-question', extractedText);
                        showToast('success', 'å¯¼å…¥æˆåŠŸ', `å·²æå–${extractedText.length}ä¸ªå­—ç¬¦åˆ°é¢˜ç›®å†…å®¹æ¡†`);
                    } catch (error) {
                        showToast('error', 'å¯¼å…¥å¤±è´¥', error.message);
                    } finally {
                        e.target.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                    }
                });
            }

            // å¯¼å…¥å‚è€ƒç­”æ¡ˆæŒ‰é’®
            const importAnswerBtn = document.getElementById('import-answer-btn');
            const importAnswerFile = document.getElementById('import-answer-file');
            if (importAnswerBtn && importAnswerFile) {
                importAnswerBtn.addEventListener('click', () => {
                    importAnswerFile.click();
                });
                importAnswerFile.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    try {
                        const extractedText = await parseFileToText(file, 'ç­”æ¡ˆ');
                        fillTextarea('ai-answer', extractedText);
                        showToast('success', 'å¯¼å…¥æˆåŠŸ', `å·²æå–${extractedText.length}ä¸ªå­—ç¬¦åˆ°å‚è€ƒç­”æ¡ˆæ¡†`);
                    } catch (error) {
                        showToast('error', 'å¯¼å…¥å¤±è´¥', error.message);
                    } finally {
                        e.target.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                    }
                });
            }

            // è§£ææ–‡ä»¶ä¸ºæ–‡æœ¬
            async function parseFileToText(file, type) {
                const fileName = file.name;
                const fileExt = fileName.split('.').pop().toLowerCase();

                // æ˜¾ç¤ºè§£æè¿›åº¦
                const progressId = showImportProgress(`æ­£åœ¨è§£æ${type}æ–‡ä»¶...`);

                try {
                    let extractedText = '';

                    if (fileExt === 'pdf') {
                        // PDFè§£æ
                        updateImportProgress(progressId, 'è¯»å–PDFæ–‡ä»¶...', 20);

                        const arrayBuffer = await file.arrayBuffer();
                        updateImportProgress(progressId, 'è§£æPDFå†…å®¹...', 50);

                        // ä½¿ç”¨PDF.jsè§£æ
                        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                        const numPages = pdf.numPages;
                        let fullText = '';

                        for (let i = 1; i <= numPages; i++) {
                            updateImportProgress(progressId, `æå–ç¬¬${i}/${numPages}é¡µ...`, 50 + (i / numPages) * 40);
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            const pageText = textContent.items.map(item => item.str).join(' ');
                            fullText += pageText + '\n\n';
                        }

                        extractedText = fullText.trim();
                        updateImportProgress(progressId, 'PDFè§£æå®Œæˆ', 100);
                    } else if (['png', 'jpg', 'jpeg', 'bmp', 'tiff'].includes(fileExt)) {
                        // å›¾ç‰‡OCR
                        updateImportProgress(progressId, 'è¯»å–å›¾ç‰‡æ–‡ä»¶...', 20);

                        const imageUrl = URL.createObjectURL(file);
                        updateImportProgress(progressId, 'OCRè¯†åˆ«ä¸­...', 50);

                        // ä½¿ç”¨Tesseract.jsè¿›è¡ŒOCR
                        const { data: { text } } = await Tesseract.recognize(
                            imageUrl,
                            'chi_sim+eng', // æ”¯æŒä¸­æ–‡å’Œè‹±æ–‡
                            {
                                logger: m => {
                                    if (m.status === 'recognizing text') {
                                        const progress = Math.round(m.progress * 100);
                                        updateImportProgress(progressId, `OCRè¯†åˆ«ä¸­... ${progress}%`, 50 + progress * 0.4);
                                    }
                                }
                            }
                        );

                        extractedText = text.trim();
                        URL.revokeObjectURL(imageUrl);
                        updateImportProgress(progressId, 'OCRè¯†åˆ«å®Œæˆ', 100);
                    } else {
                        throw new Error(`ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: ${fileExt}`);
                    }

                    hideImportProgress(progressId);
                    return extractedText;

                } catch (error) {
                    hideImportProgress(progressId);
                    throw error;
                }
            }

            // å¡«å…¥æ–‡æœ¬æ¡†
            function fillTextarea(textareaId, text) {
                const textarea = document.getElementById(textareaId);
                if (textarea) {
                    textarea.value = text;
                    textarea.dispatchEvent(new Event('input', { bubbles: true }));
                }
            }

            // å¯¼å…¥è¿›åº¦æ˜¾ç¤º
            function showImportProgress(message) {
                const progressId = 'import-progress-' + Date.now();
                const progressHTML = `
                    <div id="${progressId}" class="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center">
                        <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                            <div class="text-center mb-4">
                                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i data-lucide="file-text" class="w-8 h-8 text-purple-600 animate-pulse"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900">æ–‡ä»¶è§£æä¸­</h3>
                                <p class="text-sm text-gray-500 mt-1">${message}</p>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-purple-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', progressHTML);
                lucide.createIcons();
                return progressId;
            }

            function updateImportProgress(progressId, message, progress) {
                const progressEl = document.getElementById(progressId);
                if (!progressEl) return;
                const textEl = progressEl.querySelector('.text-sm.text-gray-500');
                const barEl = progressEl.querySelector('.bg-purple-500');
                if (textEl) textEl.textContent = message;
                if (barEl) barEl.style.width = progress + '%';
            }

            function hideImportProgress(progressId) {
                const progressEl = document.getElementById(progressId);
                if (progressEl) {
                    setTimeout(() => progressEl.remove(), 500);
                }
            }

            // AIåˆ†æè¿›åº¦æ˜¾ç¤º
            function showAIAnalysisProgress() {
                const progressHTML = `
                    <div id="ai-progress-modal" class="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center">
                        <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4 animate-scale-in">
                            <div class="text-center mb-4">
                                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i data-lucide="brain" class="w-8 h-8 text-purple-600 animate-pulse"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900">AIæ­£åœ¨åˆ†æ...</h3>
                                <p class="text-sm text-gray-500 mt-1">è¯·ç¨å€™ï¼Œæ­£åœ¨æå–è¯„åˆ†è¦ç‚¹</p>
                            </div>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-2">
                                    <div class="w-4 h-4 bg-purple-600 rounded-full animate-pulse"></div>
                                    <div class="text-sm text-gray-700">å…³é”®è¯æå–</div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-4 h-4 bg-purple-300 rounded-full"></div>
                                    <div class="text-sm text-gray-700">ç»´åº¦ç”Ÿæˆ</div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-4 h-4 bg-gray-300 rounded-full"></div>
                                    <div class="text-sm text-gray-700">æƒé‡ä¼˜åŒ–</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', progressHTML);
                lucide.createIcons();
            }

            // æ¨¡æ‹ŸAIåˆ†æè¿‡ç¨‹
            async function runAIAnalysis(question, answer) {
                // æ¨¡æ‹Ÿåˆ†æå»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 2000));

                // åŸºäºé¢˜ç›®å†…å®¹çš„æ™ºèƒ½åˆ†æ
                const isEssay = question.includes('åˆ†æ') || question.includes('è®ºè¿°') || question.includes('è¯„ä»·');
                const isShort = question.includes('ç®€ç­”') || answer.length < 200;
                const isAnalysis = question.includes('åˆ†æ') && !isEssay;

                let result;

                if (isEssay) {
                    result = {
                        dimensions: [
                            { name: 'è§‚ç‚¹æ˜ç¡®æ€§', weight: 35, items: ['è§‚ç‚¹æ¸…æ™°ä¸”å‡†ç¡®', 'è§‚ç‚¹æœ‰åˆ›æ–°æ€§', 'ç¬¦åˆé¢˜ç›®è¦æ±‚'] },
                            { name: 'å²å®å‡†ç¡®æ€§', weight: 25, items: ['å²å®å¼•ç”¨å‡†ç¡®', 'å²å®ä¸°å¯Œå……å®', 'æ— å†å²é”™è¯¯'] },
                            { name: 'è®ºè¯é€»è¾‘æ€§', weight: 30, items: ['è®ºè¯é€»è¾‘æ¸…æ™°', 'è®ºæ®æ”¯æ’‘æœ‰åŠ›', 'æ¨ç†è¿‡ç¨‹å®Œæ•´'] },
                            { name: 'è¯­è¨€è§„èŒƒæ€§', weight: 10, items: ['è¯­è¨€è¡¨è¾¾è§„èŒƒ', 'æ— é”™åˆ«å­—', 'è¡Œæ–‡æµç•…'] }
                        ],
                        confidence: 0.92,
                        difficulty: 'ä¸­ç­‰'
                    };
                } else if (isAnalysis) {
                    result = {
                        dimensions: [
                            { name: 'é—®é¢˜ç†è§£', weight: 30, items: ['é—®é¢˜ç†è§£å‡†ç¡®', 'æŠ“ä½æ ¸å¿ƒè¦ç‚¹', 'åˆ†ææ–¹å‘æ­£ç¡®'] },
                            { name: 'åˆ†ææ–¹æ³•', weight: 40, items: ['æ–¹æ³•ç§‘å­¦åˆç†', 'åˆ†æè¿‡ç¨‹å®Œæ•´', 'é€»è¾‘æ¸…æ™°'] },
                            { name: 'ç»“è®ºéªŒè¯', weight: 30, items: ['ç»“è®ºåˆç†å¯é ', 'éªŒè¯è¿‡ç¨‹å……åˆ†', 'ç»“æœæ­£ç¡®'] }
                        ],
                        confidence: 0.89,
                        difficulty: 'ä¸­ç­‰åä¸Š'
                    };
                } else if (isShort) {
                    result = {
                        dimensions: [
                            { name: 'ç­”æ¡ˆå®Œæ•´æ€§', weight: 50, items: ['å›ç­”è¦ç‚¹å…¨é¢', 'æ— é—æ¼å…³é”®ä¿¡æ¯', 'å†…å®¹å……å®'] },
                            { name: 'å‡†ç¡®æ€§', weight: 50, items: ['ç­”æ¡ˆå‡†ç¡®æ— è¯¯', 'ç†è§£æ­£ç¡®æ·±å…¥', 'è¡¨è¿°æ¸…æ™°'] }
                        ],
                        confidence: 0.95,
                        difficulty: 'ç®€å•'
                    };
                } else {
                    // é»˜è®¤æ ‡å‡†è®ºè¿°é¢˜
                    result = {
                        dimensions: [
                            { name: 'æ ¸å¿ƒè¦ç‚¹', weight: 40, items: ['å›ç­”å‡†ç¡®', 'è¦ç‚¹æ¸…æ™°', 'ç¬¦åˆé¢˜æ„'] },
                            { name: 'é€»è¾‘ç»“æ„', weight: 30, items: ['é€»è¾‘åˆç†', 'ç»“æ„å®Œæ•´', 'æ¡ç†æ¸…æ™°'] },
                            { name: 'è¡¨è¾¾è§„èŒƒ', weight: 20, items: ['è¡¨è¿°è§„èŒƒ', 'æ— æ˜æ˜¾é”™è¯¯', 'è¯­è¨€æµç•…'] },
                            { name: 'åˆ›æ–°æ€§', weight: 10, items: ['æœ‰ç‹¬ç‰¹è§è§£', 'æ€è€ƒæ·±å…¥', 'è§‚ç‚¹æ–°é¢–'] }
                        ],
                        confidence: 0.87,
                        difficulty: 'ä¸­ç­‰'
                    };
                }

                // æ¨¡æ‹Ÿç½®ä¿¡åº¦è°ƒæ•´
                if (question.length > 500 || answer.length > 800) {
                    result.confidence -= 0.05;
                }
                if (question.includes('å¤æ‚') || question.includes('ç»¼åˆ')) {
                    result.difficulty = 'å›°éš¾';
                    result.confidence -= 0.03;
                }

                return result;
            }

            // åº”ç”¨AIåˆ†æç»“æœ
            function applyAIAnalysisResult(result) {
                // å…³é—­è¿›åº¦æ¨¡æ€æ¡†
                const progressModal = document.getElementById('ai-progress-modal');
                if (progressModal) {
                    progressModal.remove();
                }

                // è®°å½•AIåˆ†æç»“æœåˆ°æ§åˆ¶å°
                console.log('AIåˆ†æç»“æœ:', result);

                // æ˜¾ç¤ºAIä¼˜åŒ–å®Œæˆæç¤º
                setTimeout(() => {
                    showToast('success', 'AIä¼˜åŒ–å®Œæˆ', `å·²ç”Ÿæˆ${result.dimensions.length}ä¸ªè¯„åˆ†ç»´åº¦ï¼Œç½®ä¿¡åº¦${(result.confidence * 100).toFixed(0)}%`);
                }, 300);
            }

            // ==================== æ–°å¢åŠŸèƒ½äº‹ä»¶ç»‘å®š ====================

            // 1. æ–‡ä»¶å¯¼å…¥äº‹ä»¶
            const importFile = document.getElementById('import-file');
            if (importFile) {
                importFile.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const fileName = file.name;
                    const fileExt = fileName.split('.').pop().toLowerCase();

                    // æ˜¾ç¤ºè§£æè¿›åº¦
                    const progressId = showParsingProgress('å¼€å§‹è§£ææ–‡ä»¶...');

                    try {
                        if (fileExt === 'json' || fileExt === 'csv') {
                            // å¤„ç†JSON/CSVæ–‡ä»¶
                            const reader = new FileReader();
                            const content = await new Promise((resolve, reject) => {
                                reader.onload = (e) => resolve(e.target.result);
                                reader.onerror = reject;
                                reader.readAsText(file);
                            });

                            if (fileExt === 'json') {
                                const data = JSON.parse(content);
                                updateParsingProgress(progressId, 'è§£æJSONæ–‡ä»¶...', 50);
                                showToast('success', 'å¯¼å…¥æˆåŠŸ', `å·²ä»æ–‡ä»¶"${fileName}"å¯¼å…¥è¯„åˆ†ç»†åˆ™ï¼Œå…±${Object.keys(data).length}ä¸ªç»´åº¦`);
                            } else {
                                // è§£æCSV
                                const lines = content.split('\n').filter(line => line.trim());
                                const data = {};
                                for (let i = 1; i < lines.length; i++) {
                                    const values = lines[i].split(',').map(v => v.trim());
                                    if (values.length >= 2) {
                                        const key = values[0];
                                        const score = values[1];
                                        if (key && score) {
                                            data[key] = { score: parseFloat(score), description: values[2] || '' };
                                        }
                                    }
                                }
                                updateParsingProgress(progressId, 'è§£æCSVæ–‡ä»¶...', 50);
                                showToast('success', 'å¯¼å…¥æˆåŠŸ', `å·²ä»æ–‡ä»¶"${fileName}"å¯¼å…¥CSVæ ¼å¼è¯„åˆ†ç»†åˆ™ï¼Œå…±${Object.keys(data).length}ä¸ªç»´åº¦`);
                            }

                            hideParsingProgress(progressId);
                        } else {
                            hideParsingProgress(progressId);
                            showToast('error', 'æ–‡ä»¶æ ¼å¼é”™è¯¯', 'ä»…æ”¯æŒJSONå’ŒCSVæ ¼å¼æ–‡ä»¶');
                        }
                    } catch (error) {
                        hideParsingProgress(progressId);
                        console.error('æ–‡ä»¶è§£æé”™è¯¯:', error);
                        showToast('error', 'è§£æå¤±è´¥', error.message || 'æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
                    }

                    // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                    e.target.value = '';
                });
            }

            // æ–‡ä»¶è§£æè¿›åº¦æ˜¾ç¤º
            function showParsingProgress(message) {
                const progressId = 'progress-' + Date.now();
                const progressHTML = `
                    <div id="${progressId}" class="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center">
                        <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                            <div class="text-center mb-4">
                                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i data-lucide="file-text" class="w-8 h-8 text-blue-600 animate-pulse"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900">æ–‡ä»¶è§£æä¸­</h3>
                                <p class="text-sm text-gray-500 mt-1">${message}</p>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', progressHTML);
                lucide.createIcons();
                return progressId;
            }

            function updateParsingProgress(progressId, message, progress) {
                const progressEl = document.getElementById(progressId);
                if (!progressEl) return;
                const textEl = progressEl.querySelector('.text-sm.text-gray-500');
                const barEl = progressEl.querySelector('.bg-blue-500');
                if (textEl) textEl.textContent = message;
                if (barEl) barEl.style.width = progress + '%';
            }

            function hideParsingProgress(progressId) {
                const progressEl = document.getElementById(progressId);
                if (progressEl) {
                    setTimeout(() => progressEl.remove(), 500);
                }
            }

            // è‡ªåŠ¨å¡«å…¥AIè¾“å…¥æ¡†
            function fillAIInput(inputId, text) {
                const input = document.getElementById(inputId);
                if (input) {
                    input.value = text;
                    // è§¦å‘è¾“å…¥äº‹ä»¶
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                }
            }

            // ESCé”®å…³é—­
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && rubricDrawerOpen) {
                    closeDrawer();
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆ›å»ºæ»‘å‡ºé¢æ¿
        document.addEventListener('DOMContentLoaded', createRubricDrawer);
    </script>
</body>
</html>